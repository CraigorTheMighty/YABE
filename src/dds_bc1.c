// TODO: if two encodings have the same error, pick the encoding with more unique encoded colours by counting indexes

/*
#define DDS_GROUND_TRUTH	(1 && (block_x == 84/4) && (block_y == 32/4))
#define DDS_GROUND_TRUTH	(1 && (block_x == 100/4) && (block_y == 8/4))
#define DDS_GROUND_TRUTH	(1 && (block_x == 164/4) && (block_y == 32/4))
#define DDS_GROUND_TRUTH	(1 && (block_x == 184/4) && (block_y == 32/4))
#define DDS_GROUND_TRUTH	(1 && (block_x == 156/4) && (block_y == 28/4))
#define DDS_GROUND_TRUTH	(1 && (block_x == 148/4) && (block_y == 12/4))
#define DDS_GROUND_TRUTH	(1 && DDS_DEBUG_BLOCK)
*/
#define DEBUG_BLOCK (block_x == 159 && block_y == 97)
#define DEBUG_BLOCK (block_x == 143 && block_y == 34)
#define DEBUG_BLOCK (block_x == 147 && block_y == 163)
#define DEBUG_BLOCK (block_x == 117 && block_y == 119)
#define DEBUG_BLOCK (block_x == 111 && block_y == 43)
#define DEBUG_BLOCK (0)
#define DDS_GROUND_TRUTH	(0)
//#define NEW_EXTENDED_BC1
//#define SPHERE_TWIDDLE
//#define EXHAUSTIVE_EXTENDED
#define PREFIX_SUM_ERROR
float g_best_err_diff = 0.0f;
extern float errsum;

/*
#define VFLOAT4(a, b, c, d)     (float4)((float)a, (float)b, (float)c, (float)d)
#define VFLOAT3(a, b, c)        (float3)((float)a, (float)b, (float)c)
#define UCHAR3(a, b, c)         (uchar3)((uchar)a, (uchar)b, (uchar)c)
#define SHORT3(a, b, c)         (short3)((short)a, (short)b, (short)c)
#define INT3(a, b, c)           (int3)((int)a, (int)b, (int)c)
*/
/*

TODO: can calculate this as a summed-area-table and do a simple subtraction to find the minimum error possible between two planes

it won't be 100% accurate as the eigenvector in general doesn't align exactly with colour[1] - colour[2]

possibly don't do the check in those cases, as they're likely to be endpoints a few blocks apart, where the eigenvector will not align well at all

this could potentially speed up things by a LOT, as it only needs to be computed N times instead of N^2


for (i = 0; i < 16; i++)
{
if (interior_indexes_flag[i] && (!has_alpha || pixel4x4_rgba[i*4 + 3] >= alpha_cutoff))
{
vec3f32_t temp_vec = Vec3f32_Sub(original[i/4][i%4], colour[0]);
temp_vec = Vec3f32_Sub(temp_vec, Vec3f32_Scale(eigen, Vec3f32_Dot(temp_vec, eigen)));
min_err += Vec3f32_Dot(temp_vec, temp_vec);
}
}
if (plane0_error + plane1_error + min_err > best_error)
return DDS_MAX_INIT_ERROR;

*/

#include <smmintrin.h>
#include <xmmintrin.h>
#include <mmintrin.h>

#include <windows.h>
#include <stdint.h>
#include <stdio.h>
#include <stdint.h>
#include <inttypes.h>
#include <math.h>
#include <memory.h>
#define VEC_INLINE_DEF static __forceinline
#define MAT_INLINE_DEF static __forceinline
#define LIBVEC_INLINE_VEC
#define LIBVEC_INLINE_MAT

#define MATH_INLINE_DEF static __forceinline
#define MATH_INLINE_MATH

#include "../inc/memory.h"
#include "../inc/system.h"
#include "../inc/math.h"
#include "../inc/vecmat.h"
#include "../inc/dds_const.h"
#include "../inc/dds_util.h"
#include "../inc/dds.h"


#define MEMBER2X(a)             a.v[0]
#define MEMBER2Y(a)             a.v[1]
#define MEMBER2Z(a)             a.v[2]
#define MEMBER2W(a)             a.v[2]
#define MEMBER(a, b)            MEMBER2##b(a)

typedef vec3u8_t uchar3;
typedef vec3f32_t float3;

extern uint64_t g_ticks;

//#define DDS_DEBUG_BLOCK		((block_x == 240/4) && (block_y == 0/4))
//#define DDS_DEBUG_BLOCK		((block_x == 256/4) && (block_y == 44/4))
//#define DDS_DEBUG_BLOCK		(0)

//#define USE_OLD_TABLES

//#define COLOUR_QUANTISE

static int g_8bit_index_map[4][8][2][2] = 
{
	{
	{ {0, 0}, {0, 1}, },
	{ {0, 2}, {0, 3}, },
	{ {1, 0}, {1, 1}, },
	{ {1, 2}, {1, 3}, },
	{ {2, 0}, {2, 1}, },
	{ {2, 2}, {2, 3}, },
	{ {3, 0}, {3, 1}, },
	{ {3, 2}, {3, 3}, }
	},
	{
	{ {0, 0}, {1, 0}, },
	{ {0, 1}, {1, 1}, },
	{ {0, 2}, {1, 2}, },
	{ {0, 3}, {1, 3}, },
	{ {2, 0}, {3, 0}, },
	{ {2, 1}, {3, 1}, },
	{ {2, 2}, {3, 2}, },
	{ {2, 3}, {3, 3}, }
	},
	{
	{ {0, 0}, {0, 1}, },
	{ {1, 0}, {1, 1}, },
	{ {0, 2}, {1, 2}, },
	{ {0, 3}, {1, 3}, },
	{ {2, 0}, {3, 0}, },
	{ {2, 1}, {3, 1}, },
	{ {2, 2}, {2, 3}, },
	{ {3, 2}, {3, 3}, }
	},
	{
	{ {0, 0}, {1, 1}, },
	{ {1, 0}, {0, 1}, },
	{ {0, 2}, {1, 3}, },
	{ {1, 2}, {0, 3}, },
	{ {2, 0}, {3, 1}, },
	{ {3, 0}, {2, 1}, },
	{ {2, 2}, {3, 3}, },
	{ {3, 2}, {2, 3}, },
	},
};

static int g_dds_half_sphere_reverse_map[11*11*11][2] = 
{
	{ -1, -1}, // -5, -5, -5
	{ -1, -1}, // -5, -5, -4
	{ -1, -1}, // -5, -5, -3
	{ -1, -1}, // -5, -5, -2
	{ -1, -1}, // -5, -5, -1
	{ -1, -1}, // -5, -5,  0
	{ -1, -1}, // -5, -5,  1
	{ -1, -1}, // -5, -5,  2
	{ -1, -1}, // -5, -5,  3
	{ -1, -1}, // -5, -5,  4
	{ -1, -1}, // -5, -5,  5
	{ -1, -1}, // -5, -4, -5
	{ -1, -1}, // -5, -4, -4
	{ -1, -1}, // -5, -4, -3
	{ -1, -1}, // -5, -4, -2
	{ -1, -1}, // -5, -4, -1
	{ -1, -1}, // -5, -4,  0
	{ -1, -1}, // -5, -4,  1
	{ -1, -1}, // -5, -4,  2
	{ -1, -1}, // -5, -4,  3
	{ -1, -1}, // -5, -4,  4
	{ -1, -1}, // -5, -4,  5
	{ -1, -1}, // -5, -3, -5
	{ -1, -1}, // -5, -3, -4
	{ -1, -1}, // -5, -3, -3
	{ -1, -1}, // -5, -3, -2
	{ -1, -1}, // -5, -3, -1
	{ -1, -1}, // -5, -3,  0
	{ -1, -1}, // -5, -3,  1
	{ -1, -1}, // -5, -3,  2
	{ -1, -1}, // -5, -3,  3
	{ -1, -1}, // -5, -3,  4
	{ -1, -1}, // -5, -3,  5
	{ -1, -1}, // -5, -2, -5
	{ -1, -1}, // -5, -2, -4
	{ -1, -1}, // -5, -2, -3
	{ -1, -1}, // -5, -2, -2
	{ -1, -1}, // -5, -2, -1
	{ -1, -1}, // -5, -2,  0
	{ -1, -1}, // -5, -2,  1
	{ -1, -1}, // -5, -2,  2
	{ -1, -1}, // -5, -2,  3
	{ -1, -1}, // -5, -2,  4
	{ -1, -1}, // -5, -2,  5
	{ -1, -1}, // -5, -1, -5
	{ -1, -1}, // -5, -1, -4
	{ -1, -1}, // -5, -1, -3
	{ -1, -1}, // -5, -1, -2
	{ -1, -1}, // -5, -1, -1
	{ -1, -1}, // -5, -1,  0
	{ -1, -1}, // -5, -1,  1
	{ -1, -1}, // -5, -1,  2
	{ -1, -1}, // -5, -1,  3
	{ -1, -1}, // -5, -1,  4
	{ -1, -1}, // -5, -1,  5
	{ -1, -1}, // -5,  0, -5
	{ -1, -1}, // -5,  0, -4
	{ -1, -1}, // -5,  0, -3
	{ -1, -1}, // -5,  0, -2
	{ -1, -1}, // -5,  0, -1
	{255, 1}, // -5,  0,  0
	{ -1, -1}, // -5,  0,  1
	{ -1, -1}, // -5,  0,  2
	{ -1, -1}, // -5,  0,  3
	{ -1, -1}, // -5,  0,  4
	{ -1, -1}, // -5,  0,  5
	{ -1, -1}, // -5,  1, -5
	{ -1, -1}, // -5,  1, -4
	{ -1, -1}, // -5,  1, -3
	{ -1, -1}, // -5,  1, -2
	{ -1, -1}, // -5,  1, -1
	{ -1, -1}, // -5,  1,  0
	{ -1, -1}, // -5,  1,  1
	{ -1, -1}, // -5,  1,  2
	{ -1, -1}, // -5,  1,  3
	{ -1, -1}, // -5,  1,  4
	{ -1, -1}, // -5,  1,  5
	{ -1, -1}, // -5,  2, -5
	{ -1, -1}, // -5,  2, -4
	{ -1, -1}, // -5,  2, -3
	{ -1, -1}, // -5,  2, -2
	{ -1, -1}, // -5,  2, -1
	{ -1, -1}, // -5,  2,  0
	{ -1, -1}, // -5,  2,  1
	{ -1, -1}, // -5,  2,  2
	{ -1, -1}, // -5,  2,  3
	{ -1, -1}, // -5,  2,  4
	{ -1, -1}, // -5,  2,  5
	{ -1, -1}, // -5,  3, -5
	{ -1, -1}, // -5,  3, -4
	{ -1, -1}, // -5,  3, -3
	{ -1, -1}, // -5,  3, -2
	{ -1, -1}, // -5,  3, -1
	{ -1, -1}, // -5,  3,  0
	{ -1, -1}, // -5,  3,  1
	{ -1, -1}, // -5,  3,  2
	{ -1, -1}, // -5,  3,  3
	{ -1, -1}, // -5,  3,  4
	{ -1, -1}, // -5,  3,  5
	{ -1, -1}, // -5,  4, -5
	{ -1, -1}, // -5,  4, -4
	{ -1, -1}, // -5,  4, -3
	{ -1, -1}, // -5,  4, -2
	{ -1, -1}, // -5,  4, -1
	{ -1, -1}, // -5,  4,  0
	{ -1, -1}, // -5,  4,  1
	{ -1, -1}, // -5,  4,  2
	{ -1, -1}, // -5,  4,  3
	{ -1, -1}, // -5,  4,  4
	{ -1, -1}, // -5,  4,  5
	{ -1, -1}, // -5,  5, -5
	{ -1, -1}, // -5,  5, -4
	{ -1, -1}, // -5,  5, -3
	{ -1, -1}, // -5,  5, -2
	{ -1, -1}, // -5,  5, -1
	{ -1, -1}, // -5,  5,  0
	{ -1, -1}, // -5,  5,  1
	{ -1, -1}, // -5,  5,  2
	{ -1, -1}, // -5,  5,  3
	{ -1, -1}, // -5,  5,  4
	{ -1, -1}, // -5,  5,  5
	{ -1, -1}, // -4, -5, -5
	{ -1, -1}, // -4, -5, -4
	{ -1, -1}, // -4, -5, -3
	{ -1, -1}, // -4, -5, -2
	{ -1, -1}, // -4, -5, -1
	{ -1, -1}, // -4, -5,  0
	{ -1, -1}, // -4, -5,  1
	{ -1, -1}, // -4, -5,  2
	{ -1, -1}, // -4, -5,  3
	{ -1, -1}, // -4, -5,  4
	{ -1, -1}, // -4, -5,  5
	{ -1, -1}, // -4, -4, -5
	{ -1, -1}, // -4, -4, -4
	{ -1, -1}, // -4, -4, -3
	{ -1, -1}, // -4, -4, -2
	{ -1, -1}, // -4, -4, -1
	{ -1, -1}, // -4, -4,  0
	{ -1, -1}, // -4, -4,  1
	{ -1, -1}, // -4, -4,  2
	{ -1, -1}, // -4, -4,  3
	{ -1, -1}, // -4, -4,  4
	{ -1, -1}, // -4, -4,  5
	{ -1, -1}, // -4, -3, -5
	{ -1, -1}, // -4, -3, -4
	{ -1, -1}, // -4, -3, -3
	{ -1, -1}, // -4, -3, -2
	{ -1, -1}, // -4, -3, -1
	{247, 1}, // -4, -3,  0
	{ -1, -1}, // -4, -3,  1
	{ -1, -1}, // -4, -3,  2
	{ -1, -1}, // -4, -3,  3
	{ -1, -1}, // -4, -3,  4
	{ -1, -1}, // -4, -3,  5
	{ -1, -1}, // -4, -2, -5
	{ -1, -1}, // -4, -2, -4
	{ -1, -1}, // -4, -2, -3
	{253, 1}, // -4, -2, -2
	{250, 1}, // -4, -2, -1
	{246, 1}, // -4, -2,  0
	{243, 1}, // -4, -2,  1
	{240, 1}, // -4, -2,  2
	{ -1, -1}, // -4, -2,  3
	{ -1, -1}, // -4, -2,  4
	{ -1, -1}, // -4, -2,  5
	{ -1, -1}, // -4, -1, -5
	{ -1, -1}, // -4, -1, -4
	{ -1, -1}, // -4, -1, -3
	{252, 1}, // -4, -1, -2
	{249, 1}, // -4, -1, -1
	{245, 1}, // -4, -1,  0
	{242, 1}, // -4, -1,  1
	{239, 1}, // -4, -1,  2
	{ -1, -1}, // -4, -1,  3
	{ -1, -1}, // -4, -1,  4
	{ -1, -1}, // -4, -1,  5
	{ -1, -1}, // -4,  0, -5
	{ -1, -1}, // -4,  0, -4
	{254, 1}, // -4,  0, -3
	{251, 1}, // -4,  0, -2
	{248, 1}, // -4,  0, -1
	{244, 1}, // -4,  0,  0
	{241, 1}, // -4,  0,  1
	{238, 1}, // -4,  0,  2
	{237, 1}, // -4,  0,  3
	{ -1, -1}, // -4,  0,  4
	{ -1, -1}, // -4,  0,  5
	{ -1, -1}, // -4,  1, -5
	{ -1, -1}, // -4,  1, -4
	{ -1, -1}, // -4,  1, -3
	{  0, 0}, // -4,  1, -2
	{  2, 0}, // -4,  1, -1
	{  4, 0}, // -4,  1,  0
	{  7, 0}, // -4,  1,  1
	{  9, 0}, // -4,  1,  2
	{ -1, -1}, // -4,  1,  3
	{ -1, -1}, // -4,  1,  4
	{ -1, -1}, // -4,  1,  5
	{ -1, -1}, // -4,  2, -5
	{ -1, -1}, // -4,  2, -4
	{ -1, -1}, // -4,  2, -3
	{  1, 0}, // -4,  2, -2
	{  3, 0}, // -4,  2, -1
	{  5, 0}, // -4,  2,  0
	{  8, 0}, // -4,  2,  1
	{ 10, 0}, // -4,  2,  2
	{ -1, -1}, // -4,  2,  3
	{ -1, -1}, // -4,  2,  4
	{ -1, -1}, // -4,  2,  5
	{ -1, -1}, // -4,  3, -5
	{ -1, -1}, // -4,  3, -4
	{ -1, -1}, // -4,  3, -3
	{ -1, -1}, // -4,  3, -2
	{ -1, -1}, // -4,  3, -1
	{  6, 0}, // -4,  3,  0
	{ -1, -1}, // -4,  3,  1
	{ -1, -1}, // -4,  3,  2
	{ -1, -1}, // -4,  3,  3
	{ -1, -1}, // -4,  3,  4
	{ -1, -1}, // -4,  3,  5
	{ -1, -1}, // -4,  4, -5
	{ -1, -1}, // -4,  4, -4
	{ -1, -1}, // -4,  4, -3
	{ -1, -1}, // -4,  4, -2
	{ -1, -1}, // -4,  4, -1
	{ -1, -1}, // -4,  4,  0
	{ -1, -1}, // -4,  4,  1
	{ -1, -1}, // -4,  4,  2
	{ -1, -1}, // -4,  4,  3
	{ -1, -1}, // -4,  4,  4
	{ -1, -1}, // -4,  4,  5
	{ -1, -1}, // -4,  5, -5
	{ -1, -1}, // -4,  5, -4
	{ -1, -1}, // -4,  5, -3
	{ -1, -1}, // -4,  5, -2
	{ -1, -1}, // -4,  5, -1
	{ -1, -1}, // -4,  5,  0
	{ -1, -1}, // -4,  5,  1
	{ -1, -1}, // -4,  5,  2
	{ -1, -1}, // -4,  5,  3
	{ -1, -1}, // -4,  5,  4
	{ -1, -1}, // -4,  5,  5
	{ -1, -1}, // -3, -5, -5
	{ -1, -1}, // -3, -5, -4
	{ -1, -1}, // -3, -5, -3
	{ -1, -1}, // -3, -5, -2
	{ -1, -1}, // -3, -5, -1
	{ -1, -1}, // -3, -5,  0
	{ -1, -1}, // -3, -5,  1
	{ -1, -1}, // -3, -5,  2
	{ -1, -1}, // -3, -5,  3
	{ -1, -1}, // -3, -5,  4
	{ -1, -1}, // -3, -5,  5
	{ -1, -1}, // -3, -4, -5
	{ -1, -1}, // -3, -4, -4
	{ -1, -1}, // -3, -4, -3
	{ -1, -1}, // -3, -4, -2
	{ -1, -1}, // -3, -4, -1
	{225, 1}, // -3, -4,  0
	{ -1, -1}, // -3, -4,  1
	{ -1, -1}, // -3, -4,  2
	{ -1, -1}, // -3, -4,  3
	{ -1, -1}, // -3, -4,  4
	{ -1, -1}, // -3, -4,  5
	{ -1, -1}, // -3, -3, -5
	{ -1, -1}, // -3, -3, -4
	{ -1, -1}, // -3, -3, -3
	{233, 1}, // -3, -3, -2
	{229, 1}, // -3, -3, -1
	{224, 1}, // -3, -3,  0
	{220, 1}, // -3, -3,  1
	{216, 1}, // -3, -3,  2
	{ -1, -1}, // -3, -3,  3
	{ -1, -1}, // -3, -3,  4
	{ -1, -1}, // -3, -3,  5
	{ -1, -1}, // -3, -2, -5
	{ -1, -1}, // -3, -2, -4
	{ -1, -1}, // -3, -2, -3
	{232, 1}, // -3, -2, -2
	{228, 1}, // -3, -2, -1
	{223, 1}, // -3, -2,  0
	{219, 1}, // -3, -2,  1
	{215, 1}, // -3, -2,  2
	{212, 1}, // -3, -2,  3
	{ -1, -1}, // -3, -2,  4
	{ -1, -1}, // -3, -2,  5
	{ -1, -1}, // -3, -1, -5
	{ -1, -1}, // -3, -1, -4
	{235, 1}, // -3, -1, -3
	{231, 1}, // -3, -1, -2
	{227, 1}, // -3, -1, -1
	{222, 1}, // -3, -1,  0
	{218, 1}, // -3, -1,  1
	{214, 1}, // -3, -1,  2
	{211, 1}, // -3, -1,  3
	{ -1, -1}, // -3, -1,  4
	{ -1, -1}, // -3, -1,  5
	{ -1, -1}, // -3,  0, -5
	{236, 1}, // -3,  0, -4
	{234, 1}, // -3,  0, -3
	{230, 1}, // -3,  0, -2
	{226, 1}, // -3,  0, -1
	{221, 1}, // -3,  0,  0
	{217, 1}, // -3,  0,  1
	{213, 1}, // -3,  0,  2
	{210, 1}, // -3,  0,  3
	{209, 1}, // -3,  0,  4
	{ -1, -1}, // -3,  0,  5
	{ -1, -1}, // -3,  1, -5
	{ -1, -1}, // -3,  1, -4
	{ 11, 0}, // -3,  1, -3
	{ 12, 0}, // -3,  1, -2
	{ 15, 0}, // -3,  1, -1
	{ 18, 0}, // -3,  1,  0
	{ 22, 0}, // -3,  1,  1
	{ 25, 0}, // -3,  1,  2
	{ 28, 0}, // -3,  1,  3
	{ -1, -1}, // -3,  1,  4
	{ -1, -1}, // -3,  1,  5
	{ -1, -1}, // -3,  2, -5
	{ -1, -1}, // -3,  2, -4
	{ -1, -1}, // -3,  2, -3
	{ 13, 0}, // -3,  2, -2
	{ 16, 0}, // -3,  2, -1
	{ 19, 0}, // -3,  2,  0
	{ 23, 0}, // -3,  2,  1
	{ 26, 0}, // -3,  2,  2
	{ 29, 0}, // -3,  2,  3
	{ -1, -1}, // -3,  2,  4
	{ -1, -1}, // -3,  2,  5
	{ -1, -1}, // -3,  3, -5
	{ -1, -1}, // -3,  3, -4
	{ -1, -1}, // -3,  3, -3
	{ 14, 0}, // -3,  3, -2
	{ 17, 0}, // -3,  3, -1
	{ 20, 0}, // -3,  3,  0
	{ 24, 0}, // -3,  3,  1
	{ 27, 0}, // -3,  3,  2
	{ -1, -1}, // -3,  3,  3
	{ -1, -1}, // -3,  3,  4
	{ -1, -1}, // -3,  3,  5
	{ -1, -1}, // -3,  4, -5
	{ -1, -1}, // -3,  4, -4
	{ -1, -1}, // -3,  4, -3
	{ -1, -1}, // -3,  4, -2
	{ -1, -1}, // -3,  4, -1
	{ 21, 0}, // -3,  4,  0
	{ -1, -1}, // -3,  4,  1
	{ -1, -1}, // -3,  4,  2
	{ -1, -1}, // -3,  4,  3
	{ -1, -1}, // -3,  4,  4
	{ -1, -1}, // -3,  4,  5
	{ -1, -1}, // -3,  5, -5
	{ -1, -1}, // -3,  5, -4
	{ -1, -1}, // -3,  5, -3
	{ -1, -1}, // -3,  5, -2
	{ -1, -1}, // -3,  5, -1
	{ -1, -1}, // -3,  5,  0
	{ -1, -1}, // -3,  5,  1
	{ -1, -1}, // -3,  5,  2
	{ -1, -1}, // -3,  5,  3
	{ -1, -1}, // -3,  5,  4
	{ -1, -1}, // -3,  5,  5
	{ -1, -1}, // -2, -5, -5
	{ -1, -1}, // -2, -5, -4
	{ -1, -1}, // -2, -5, -3
	{ -1, -1}, // -2, -5, -2
	{ -1, -1}, // -2, -5, -1
	{ -1, -1}, // -2, -5,  0
	{ -1, -1}, // -2, -5,  1
	{ -1, -1}, // -2, -5,  2
	{ -1, -1}, // -2, -5,  3
	{ -1, -1}, // -2, -5,  4
	{ -1, -1}, // -2, -5,  5
	{ -1, -1}, // -2, -4, -5
	{ -1, -1}, // -2, -4, -4
	{ -1, -1}, // -2, -4, -3
	{201, 1}, // -2, -4, -2
	{196, 1}, // -2, -4, -1
	{191, 1}, // -2, -4,  0
	{186, 1}, // -2, -4,  1
	{181, 1}, // -2, -4,  2
	{ -1, -1}, // -2, -4,  3
	{ -1, -1}, // -2, -4,  4
	{ -1, -1}, // -2, -4,  5
	{ -1, -1}, // -2, -3, -5
	{ -1, -1}, // -2, -3, -4
	{205, 1}, // -2, -3, -3
	{200, 1}, // -2, -3, -2
	{195, 1}, // -2, -3, -1
	{190, 1}, // -2, -3,  0
	{185, 1}, // -2, -3,  1
	{180, 1}, // -2, -3,  2
	{176, 1}, // -2, -3,  3
	{ -1, -1}, // -2, -3,  4
	{ -1, -1}, // -2, -3,  5
	{ -1, -1}, // -2, -2, -5
	{208, 1}, // -2, -2, -4
	{204, 1}, // -2, -2, -3
	{199, 1}, // -2, -2, -2
	{194, 1}, // -2, -2, -1
	{189, 1}, // -2, -2,  0
	{184, 1}, // -2, -2,  1
	{179, 1}, // -2, -2,  2
	{175, 1}, // -2, -2,  3
	{172, 1}, // -2, -2,  4
	{ -1, -1}, // -2, -2,  5
	{ -1, -1}, // -2, -1, -5
	{207, 1}, // -2, -1, -4
	{203, 1}, // -2, -1, -3
	{198, 1}, // -2, -1, -2
	{193, 1}, // -2, -1, -1
	{188, 1}, // -2, -1,  0
	{183, 1}, // -2, -1,  1
	{178, 1}, // -2, -1,  2
	{174, 1}, // -2, -1,  3
	{171, 1}, // -2, -1,  4
	{ -1, -1}, // -2, -1,  5
	{ -1, -1}, // -2,  0, -5
	{206, 1}, // -2,  0, -4
	{202, 1}, // -2,  0, -3
	{197, 1}, // -2,  0, -2
	{192, 1}, // -2,  0, -1
	{187, 1}, // -2,  0,  0
	{182, 1}, // -2,  0,  1
	{177, 1}, // -2,  0,  2
	{173, 1}, // -2,  0,  3
	{170, 1}, // -2,  0,  4
	{ -1, -1}, // -2,  0,  5
	{ -1, -1}, // -2,  1, -5
	{ 30, 0}, // -2,  1, -4
	{ 32, 0}, // -2,  1, -3
	{ 35, 0}, // -2,  1, -2
	{ 39, 0}, // -2,  1, -1
	{ 43, 0}, // -2,  1,  0
	{ 47, 0}, // -2,  1,  1
	{ 51, 0}, // -2,  1,  2
	{ 55, 0}, // -2,  1,  3
	{ 58, 0}, // -2,  1,  4
	{ -1, -1}, // -2,  1,  5
	{ -1, -1}, // -2,  2, -5
	{ 31, 0}, // -2,  2, -4
	{ 33, 0}, // -2,  2, -3
	{ 36, 0}, // -2,  2, -2
	{ 40, 0}, // -2,  2, -1
	{ 44, 0}, // -2,  2,  0
	{ 48, 0}, // -2,  2,  1
	{ 52, 0}, // -2,  2,  2
	{ 56, 0}, // -2,  2,  3
	{ 59, 0}, // -2,  2,  4
	{ -1, -1}, // -2,  2,  5
	{ -1, -1}, // -2,  3, -5
	{ -1, -1}, // -2,  3, -4
	{ 34, 0}, // -2,  3, -3
	{ 37, 0}, // -2,  3, -2
	{ 41, 0}, // -2,  3, -1
	{ 45, 0}, // -2,  3,  0
	{ 49, 0}, // -2,  3,  1
	{ 53, 0}, // -2,  3,  2
	{ 57, 0}, // -2,  3,  3
	{ -1, -1}, // -2,  3,  4
	{ -1, -1}, // -2,  3,  5
	{ -1, -1}, // -2,  4, -5
	{ -1, -1}, // -2,  4, -4
	{ -1, -1}, // -2,  4, -3
	{ 38, 0}, // -2,  4, -2
	{ 42, 0}, // -2,  4, -1
	{ 46, 0}, // -2,  4,  0
	{ 50, 0}, // -2,  4,  1
	{ 54, 0}, // -2,  4,  2
	{ -1, -1}, // -2,  4,  3
	{ -1, -1}, // -2,  4,  4
	{ -1, -1}, // -2,  4,  5
	{ -1, -1}, // -2,  5, -5
	{ -1, -1}, // -2,  5, -4
	{ -1, -1}, // -2,  5, -3
	{ -1, -1}, // -2,  5, -2
	{ -1, -1}, // -2,  5, -1
	{ -1, -1}, // -2,  5,  0
	{ -1, -1}, // -2,  5,  1
	{ -1, -1}, // -2,  5,  2
	{ -1, -1}, // -2,  5,  3
	{ -1, -1}, // -2,  5,  4
	{ -1, -1}, // -2,  5,  5
	{ -1, -1}, // -1, -5, -5
	{ -1, -1}, // -1, -5, -4
	{ -1, -1}, // -1, -5, -3
	{ -1, -1}, // -1, -5, -2
	{ -1, -1}, // -1, -5, -1
	{ -1, -1}, // -1, -5,  0
	{ -1, -1}, // -1, -5,  1
	{ -1, -1}, // -1, -5,  2
	{ -1, -1}, // -1, -5,  3
	{ -1, -1}, // -1, -5,  4
	{ -1, -1}, // -1, -5,  5
	{ -1, -1}, // -1, -4, -5
	{ -1, -1}, // -1, -4, -4
	{ -1, -1}, // -1, -4, -3
	{162, 1}, // -1, -4, -2
	{157, 1}, // -1, -4, -1
	{152, 1}, // -1, -4,  0
	{147, 1}, // -1, -4,  1
	{142, 1}, // -1, -4,  2
	{ -1, -1}, // -1, -4,  3
	{ -1, -1}, // -1, -4,  4
	{ -1, -1}, // -1, -4,  5
	{ -1, -1}, // -1, -3, -5
	{ -1, -1}, // -1, -3, -4
	{166, 1}, // -1, -3, -3
	{161, 1}, // -1, -3, -2
	{156, 1}, // -1, -3, -1
	{151, 1}, // -1, -3,  0
	{146, 1}, // -1, -3,  1
	{141, 1}, // -1, -3,  2
	{137, 1}, // -1, -3,  3
	{ -1, -1}, // -1, -3,  4
	{ -1, -1}, // -1, -3,  5
	{ -1, -1}, // -1, -2, -5
	{169, 1}, // -1, -2, -4
	{165, 1}, // -1, -2, -3
	{160, 1}, // -1, -2, -2
	{155, 1}, // -1, -2, -1
	{150, 1}, // -1, -2,  0
	{145, 1}, // -1, -2,  1
	{140, 1}, // -1, -2,  2
	{136, 1}, // -1, -2,  3
	{133, 1}, // -1, -2,  4
	{ -1, -1}, // -1, -2,  5
	{ -1, -1}, // -1, -1, -5
	{168, 1}, // -1, -1, -4
	{164, 1}, // -1, -1, -3
	{159, 1}, // -1, -1, -2
	{154, 1}, // -1, -1, -1
	{149, 1}, // -1, -1,  0
	{144, 1}, // -1, -1,  1
	{139, 1}, // -1, -1,  2
	{135, 1}, // -1, -1,  3
	{132, 1}, // -1, -1,  4
	{ -1, -1}, // -1, -1,  5
	{ -1, -1}, // -1,  0, -5
	{167, 1}, // -1,  0, -4
	{163, 1}, // -1,  0, -3
	{158, 1}, // -1,  0, -2
	{153, 1}, // -1,  0, -1
	{148, 1}, // -1,  0,  0
	{143, 1}, // -1,  0,  1
	{138, 1}, // -1,  0,  2
	{134, 1}, // -1,  0,  3
	{131, 1}, // -1,  0,  4
	{ -1, -1}, // -1,  0,  5
	{ -1, -1}, // -1,  1, -5
	{ 60, 0}, // -1,  1, -4
	{ 62, 0}, // -1,  1, -3
	{ 65, 0}, // -1,  1, -2
	{ 69, 0}, // -1,  1, -1
	{ 73, 0}, // -1,  1,  0
	{ 77, 0}, // -1,  1,  1
	{ 81, 0}, // -1,  1,  2
	{ 85, 0}, // -1,  1,  3
	{ 88, 0}, // -1,  1,  4
	{ -1, -1}, // -1,  1,  5
	{ -1, -1}, // -1,  2, -5
	{ 61, 0}, // -1,  2, -4
	{ 63, 0}, // -1,  2, -3
	{ 66, 0}, // -1,  2, -2
	{ 70, 0}, // -1,  2, -1
	{ 74, 0}, // -1,  2,  0
	{ 78, 0}, // -1,  2,  1
	{ 82, 0}, // -1,  2,  2
	{ 86, 0}, // -1,  2,  3
	{ 89, 0}, // -1,  2,  4
	{ -1, -1}, // -1,  2,  5
	{ -1, -1}, // -1,  3, -5
	{ -1, -1}, // -1,  3, -4
	{ 64, 0}, // -1,  3, -3
	{ 67, 0}, // -1,  3, -2
	{ 71, 0}, // -1,  3, -1
	{ 75, 0}, // -1,  3,  0
	{ 79, 0}, // -1,  3,  1
	{ 83, 0}, // -1,  3,  2
	{ 87, 0}, // -1,  3,  3
	{ -1, -1}, // -1,  3,  4
	{ -1, -1}, // -1,  3,  5
	{ -1, -1}, // -1,  4, -5
	{ -1, -1}, // -1,  4, -4
	{ -1, -1}, // -1,  4, -3
	{ 68, 0}, // -1,  4, -2
	{ 72, 0}, // -1,  4, -1
	{ 76, 0}, // -1,  4,  0
	{ 80, 0}, // -1,  4,  1
	{ 84, 0}, // -1,  4,  2
	{ -1, -1}, // -1,  4,  3
	{ -1, -1}, // -1,  4,  4
	{ -1, -1}, // -1,  4,  5
	{ -1, -1}, // -1,  5, -5
	{ -1, -1}, // -1,  5, -4
	{ -1, -1}, // -1,  5, -3
	{ -1, -1}, // -1,  5, -2
	{ -1, -1}, // -1,  5, -1
	{ -1, -1}, // -1,  5,  0
	{ -1, -1}, // -1,  5,  1
	{ -1, -1}, // -1,  5,  2
	{ -1, -1}, // -1,  5,  3
	{ -1, -1}, // -1,  5,  4
	{ -1, -1}, // -1,  5,  5
	{ -1, -1}, //  0, -5, -5
	{ -1, -1}, //  0, -5, -4
	{ -1, -1}, //  0, -5, -3
	{ -1, -1}, //  0, -5, -2
	{ -1, -1}, //  0, -5, -1
	{110, 1}, //  0, -5,  0
	{ -1, -1}, //  0, -5,  1
	{ -1, -1}, //  0, -5,  2
	{ -1, -1}, //  0, -5,  3
	{ -1, -1}, //  0, -5,  4
	{ -1, -1}, //  0, -5,  5
	{ -1, -1}, //  0, -4, -5
	{ -1, -1}, //  0, -4, -4
	{125, 1}, //  0, -4, -3
	{120, 1}, //  0, -4, -2
	{115, 1}, //  0, -4, -1
	{109, 1}, //  0, -4,  0
	{104, 1}, //  0, -4,  1
	{100, 1}, //  0, -4,  2
	{ 96, 1}, //  0, -4,  3
	{ -1, -1}, //  0, -4,  4
	{ -1, -1}, //  0, -4,  5
	{ -1, -1}, //  0, -3, -5
	{129, 1}, //  0, -3, -4
	{124, 1}, //  0, -3, -3
	{119, 1}, //  0, -3, -2
	{114, 1}, //  0, -3, -1
	{108, 1}, //  0, -3,  0
	{103, 1}, //  0, -3,  1
	{ 99, 1}, //  0, -3,  2
	{ 95, 1}, //  0, -3,  3
	{ 92, 1}, //  0, -3,  4
	{ -1, -1}, //  0, -3,  5
	{ -1, -1}, //  0, -2, -5
	{128, 1}, //  0, -2, -4
	{123, 1}, //  0, -2, -3
	{118, 1}, //  0, -2, -2
	{113, 1}, //  0, -2, -1
	{107, 1}, //  0, -2,  0
	{102, 1}, //  0, -2,  1
	{ 98, 1}, //  0, -2,  2
	{ 94, 1}, //  0, -2,  3
	{ 91, 1}, //  0, -2,  4
	{ -1, -1}, //  0, -2,  5
	{ -1, -1}, //  0, -1, -5
	{127, 1}, //  0, -1, -4
	{122, 1}, //  0, -1, -3
	{117, 1}, //  0, -1, -2
	{112, 1}, //  0, -1, -1
	{106, 1}, //  0, -1,  0
	{101, 1}, //  0, -1,  1
	{ 97, 1}, //  0, -1,  2
	{ 93, 1}, //  0, -1,  3
	{ 90, 1}, //  0, -1,  4
	{ -1, -1}, //  0, -1,  5
	{130, 1}, //  0,  0, -5
	{126, 1}, //  0,  0, -4
	{121, 1}, //  0,  0, -3
	{116, 1}, //  0,  0, -2
	{111, 1}, //  0,  0, -1
	{105, 0}, //  0,  0,  0
	{111, 0}, //  0,  0,  1
	{116, 0}, //  0,  0,  2
	{121, 0}, //  0,  0,  3
	{126, 0}, //  0,  0,  4
	{130, 0}, //  0,  0,  5
	{ -1, -1}, //  0,  1, -5
	{ 90, 0}, //  0,  1, -4
	{ 93, 0}, //  0,  1, -3
	{ 97, 0}, //  0,  1, -2
	{101, 0}, //  0,  1, -1
	{106, 0}, //  0,  1,  0
	{112, 0}, //  0,  1,  1
	{117, 0}, //  0,  1,  2
	{122, 0}, //  0,  1,  3
	{127, 0}, //  0,  1,  4
	{ -1, -1}, //  0,  1,  5
	{ -1, -1}, //  0,  2, -5
	{ 91, 0}, //  0,  2, -4
	{ 94, 0}, //  0,  2, -3
	{ 98, 0}, //  0,  2, -2
	{102, 0}, //  0,  2, -1
	{107, 0}, //  0,  2,  0
	{113, 0}, //  0,  2,  1
	{118, 0}, //  0,  2,  2
	{123, 0}, //  0,  2,  3
	{128, 0}, //  0,  2,  4
	{ -1, -1}, //  0,  2,  5
	{ -1, -1}, //  0,  3, -5
	{ 92, 0}, //  0,  3, -4
	{ 95, 0}, //  0,  3, -3
	{ 99, 0}, //  0,  3, -2
	{103, 0}, //  0,  3, -1
	{108, 0}, //  0,  3,  0
	{114, 0}, //  0,  3,  1
	{119, 0}, //  0,  3,  2
	{124, 0}, //  0,  3,  3
	{129, 0}, //  0,  3,  4
	{ -1, -1}, //  0,  3,  5
	{ -1, -1}, //  0,  4, -5
	{ -1, -1}, //  0,  4, -4
	{ 96, 0}, //  0,  4, -3
	{100, 0}, //  0,  4, -2
	{104, 0}, //  0,  4, -1
	{109, 0}, //  0,  4,  0
	{115, 0}, //  0,  4,  1
	{120, 0}, //  0,  4,  2
	{125, 0}, //  0,  4,  3
	{ -1, -1}, //  0,  4,  4
	{ -1, -1}, //  0,  4,  5
	{ -1, -1}, //  0,  5, -5
	{ -1, -1}, //  0,  5, -4
	{ -1, -1}, //  0,  5, -3
	{ -1, -1}, //  0,  5, -2
	{ -1, -1}, //  0,  5, -1
	{110, 0}, //  0,  5,  0
	{ -1, -1}, //  0,  5,  1
	{ -1, -1}, //  0,  5,  2
	{ -1, -1}, //  0,  5,  3
	{ -1, -1}, //  0,  5,  4
	{ -1, -1}, //  0,  5,  5
	{ -1, -1}, //  1, -5, -5
	{ -1, -1}, //  1, -5, -4
	{ -1, -1}, //  1, -5, -3
	{ -1, -1}, //  1, -5, -2
	{ -1, -1}, //  1, -5, -1
	{ -1, -1}, //  1, -5,  0
	{ -1, -1}, //  1, -5,  1
	{ -1, -1}, //  1, -5,  2
	{ -1, -1}, //  1, -5,  3
	{ -1, -1}, //  1, -5,  4
	{ -1, -1}, //  1, -5,  5
	{ -1, -1}, //  1, -4, -5
	{ -1, -1}, //  1, -4, -4
	{ -1, -1}, //  1, -4, -3
	{ 84, 1}, //  1, -4, -2
	{ 80, 1}, //  1, -4, -1
	{ 76, 1}, //  1, -4,  0
	{ 72, 1}, //  1, -4,  1
	{ 68, 1}, //  1, -4,  2
	{ -1, -1}, //  1, -4,  3
	{ -1, -1}, //  1, -4,  4
	{ -1, -1}, //  1, -4,  5
	{ -1, -1}, //  1, -3, -5
	{ -1, -1}, //  1, -3, -4
	{ 87, 1}, //  1, -3, -3
	{ 83, 1}, //  1, -3, -2
	{ 79, 1}, //  1, -3, -1
	{ 75, 1}, //  1, -3,  0
	{ 71, 1}, //  1, -3,  1
	{ 67, 1}, //  1, -3,  2
	{ 64, 1}, //  1, -3,  3
	{ -1, -1}, //  1, -3,  4
	{ -1, -1}, //  1, -3,  5
	{ -1, -1}, //  1, -2, -5
	{ 89, 1}, //  1, -2, -4
	{ 86, 1}, //  1, -2, -3
	{ 82, 1}, //  1, -2, -2
	{ 78, 1}, //  1, -2, -1
	{ 74, 1}, //  1, -2,  0
	{ 70, 1}, //  1, -2,  1
	{ 66, 1}, //  1, -2,  2
	{ 63, 1}, //  1, -2,  3
	{ 61, 1}, //  1, -2,  4
	{ -1, -1}, //  1, -2,  5
	{ -1, -1}, //  1, -1, -5
	{ 88, 1}, //  1, -1, -4
	{ 85, 1}, //  1, -1, -3
	{ 81, 1}, //  1, -1, -2
	{ 77, 1}, //  1, -1, -1
	{ 73, 1}, //  1, -1,  0
	{ 69, 1}, //  1, -1,  1
	{ 65, 1}, //  1, -1,  2
	{ 62, 1}, //  1, -1,  3
	{ 60, 1}, //  1, -1,  4
	{ -1, -1}, //  1, -1,  5
	{ -1, -1}, //  1,  0, -5
	{131, 0}, //  1,  0, -4
	{134, 0}, //  1,  0, -3
	{138, 0}, //  1,  0, -2
	{143, 0}, //  1,  0, -1
	{148, 0}, //  1,  0,  0
	{153, 0}, //  1,  0,  1
	{158, 0}, //  1,  0,  2
	{163, 0}, //  1,  0,  3
	{167, 0}, //  1,  0,  4
	{ -1, -1}, //  1,  0,  5
	{ -1, -1}, //  1,  1, -5
	{132, 0}, //  1,  1, -4
	{135, 0}, //  1,  1, -3
	{139, 0}, //  1,  1, -2
	{144, 0}, //  1,  1, -1
	{149, 0}, //  1,  1,  0
	{154, 0}, //  1,  1,  1
	{159, 0}, //  1,  1,  2
	{164, 0}, //  1,  1,  3
	{168, 0}, //  1,  1,  4
	{ -1, -1}, //  1,  1,  5
	{ -1, -1}, //  1,  2, -5
	{133, 0}, //  1,  2, -4
	{136, 0}, //  1,  2, -3
	{140, 0}, //  1,  2, -2
	{145, 0}, //  1,  2, -1
	{150, 0}, //  1,  2,  0
	{155, 0}, //  1,  2,  1
	{160, 0}, //  1,  2,  2
	{165, 0}, //  1,  2,  3
	{169, 0}, //  1,  2,  4
	{ -1, -1}, //  1,  2,  5
	{ -1, -1}, //  1,  3, -5
	{ -1, -1}, //  1,  3, -4
	{137, 0}, //  1,  3, -3
	{141, 0}, //  1,  3, -2
	{146, 0}, //  1,  3, -1
	{151, 0}, //  1,  3,  0
	{156, 0}, //  1,  3,  1
	{161, 0}, //  1,  3,  2
	{166, 0}, //  1,  3,  3
	{ -1, -1}, //  1,  3,  4
	{ -1, -1}, //  1,  3,  5
	{ -1, -1}, //  1,  4, -5
	{ -1, -1}, //  1,  4, -4
	{ -1, -1}, //  1,  4, -3
	{142, 0}, //  1,  4, -2
	{147, 0}, //  1,  4, -1
	{152, 0}, //  1,  4,  0
	{157, 0}, //  1,  4,  1
	{162, 0}, //  1,  4,  2
	{ -1, -1}, //  1,  4,  3
	{ -1, -1}, //  1,  4,  4
	{ -1, -1}, //  1,  4,  5
	{ -1, -1}, //  1,  5, -5
	{ -1, -1}, //  1,  5, -4
	{ -1, -1}, //  1,  5, -3
	{ -1, -1}, //  1,  5, -2
	{ -1, -1}, //  1,  5, -1
	{ -1, -1}, //  1,  5,  0
	{ -1, -1}, //  1,  5,  1
	{ -1, -1}, //  1,  5,  2
	{ -1, -1}, //  1,  5,  3
	{ -1, -1}, //  1,  5,  4
	{ -1, -1}, //  1,  5,  5
	{ -1, -1}, //  2, -5, -5
	{ -1, -1}, //  2, -5, -4
	{ -1, -1}, //  2, -5, -3
	{ -1, -1}, //  2, -5, -2
	{ -1, -1}, //  2, -5, -1
	{ -1, -1}, //  2, -5,  0
	{ -1, -1}, //  2, -5,  1
	{ -1, -1}, //  2, -5,  2
	{ -1, -1}, //  2, -5,  3
	{ -1, -1}, //  2, -5,  4
	{ -1, -1}, //  2, -5,  5
	{ -1, -1}, //  2, -4, -5
	{ -1, -1}, //  2, -4, -4
	{ -1, -1}, //  2, -4, -3
	{ 54, 1}, //  2, -4, -2
	{ 50, 1}, //  2, -4, -1
	{ 46, 1}, //  2, -4,  0
	{ 42, 1}, //  2, -4,  1
	{ 38, 1}, //  2, -4,  2
	{ -1, -1}, //  2, -4,  3
	{ -1, -1}, //  2, -4,  4
	{ -1, -1}, //  2, -4,  5
	{ -1, -1}, //  2, -3, -5
	{ -1, -1}, //  2, -3, -4
	{ 57, 1}, //  2, -3, -3
	{ 53, 1}, //  2, -3, -2
	{ 49, 1}, //  2, -3, -1
	{ 45, 1}, //  2, -3,  0
	{ 41, 1}, //  2, -3,  1
	{ 37, 1}, //  2, -3,  2
	{ 34, 1}, //  2, -3,  3
	{ -1, -1}, //  2, -3,  4
	{ -1, -1}, //  2, -3,  5
	{ -1, -1}, //  2, -2, -5
	{ 59, 1}, //  2, -2, -4
	{ 56, 1}, //  2, -2, -3
	{ 52, 1}, //  2, -2, -2
	{ 48, 1}, //  2, -2, -1
	{ 44, 1}, //  2, -2,  0
	{ 40, 1}, //  2, -2,  1
	{ 36, 1}, //  2, -2,  2
	{ 33, 1}, //  2, -2,  3
	{ 31, 1}, //  2, -2,  4
	{ -1, -1}, //  2, -2,  5
	{ -1, -1}, //  2, -1, -5
	{ 58, 1}, //  2, -1, -4
	{ 55, 1}, //  2, -1, -3
	{ 51, 1}, //  2, -1, -2
	{ 47, 1}, //  2, -1, -1
	{ 43, 1}, //  2, -1,  0
	{ 39, 1}, //  2, -1,  1
	{ 35, 1}, //  2, -1,  2
	{ 32, 1}, //  2, -1,  3
	{ 30, 1}, //  2, -1,  4
	{ -1, -1}, //  2, -1,  5
	{ -1, -1}, //  2,  0, -5
	{170, 0}, //  2,  0, -4
	{173, 0}, //  2,  0, -3
	{177, 0}, //  2,  0, -2
	{182, 0}, //  2,  0, -1
	{187, 0}, //  2,  0,  0
	{192, 0}, //  2,  0,  1
	{197, 0}, //  2,  0,  2
	{202, 0}, //  2,  0,  3
	{206, 0}, //  2,  0,  4
	{ -1, -1}, //  2,  0,  5
	{ -1, -1}, //  2,  1, -5
	{171, 0}, //  2,  1, -4
	{174, 0}, //  2,  1, -3
	{178, 0}, //  2,  1, -2
	{183, 0}, //  2,  1, -1
	{188, 0}, //  2,  1,  0
	{193, 0}, //  2,  1,  1
	{198, 0}, //  2,  1,  2
	{203, 0}, //  2,  1,  3
	{207, 0}, //  2,  1,  4
	{ -1, -1}, //  2,  1,  5
	{ -1, -1}, //  2,  2, -5
	{172, 0}, //  2,  2, -4
	{175, 0}, //  2,  2, -3
	{179, 0}, //  2,  2, -2
	{184, 0}, //  2,  2, -1
	{189, 0}, //  2,  2,  0
	{194, 0}, //  2,  2,  1
	{199, 0}, //  2,  2,  2
	{204, 0}, //  2,  2,  3
	{208, 0}, //  2,  2,  4
	{ -1, -1}, //  2,  2,  5
	{ -1, -1}, //  2,  3, -5
	{ -1, -1}, //  2,  3, -4
	{176, 0}, //  2,  3, -3
	{180, 0}, //  2,  3, -2
	{185, 0}, //  2,  3, -1
	{190, 0}, //  2,  3,  0
	{195, 0}, //  2,  3,  1
	{200, 0}, //  2,  3,  2
	{205, 0}, //  2,  3,  3
	{ -1, -1}, //  2,  3,  4
	{ -1, -1}, //  2,  3,  5
	{ -1, -1}, //  2,  4, -5
	{ -1, -1}, //  2,  4, -4
	{ -1, -1}, //  2,  4, -3
	{181, 0}, //  2,  4, -2
	{186, 0}, //  2,  4, -1
	{191, 0}, //  2,  4,  0
	{196, 0}, //  2,  4,  1
	{201, 0}, //  2,  4,  2
	{ -1, -1}, //  2,  4,  3
	{ -1, -1}, //  2,  4,  4
	{ -1, -1}, //  2,  4,  5
	{ -1, -1}, //  2,  5, -5
	{ -1, -1}, //  2,  5, -4
	{ -1, -1}, //  2,  5, -3
	{ -1, -1}, //  2,  5, -2
	{ -1, -1}, //  2,  5, -1
	{ -1, -1}, //  2,  5,  0
	{ -1, -1}, //  2,  5,  1
	{ -1, -1}, //  2,  5,  2
	{ -1, -1}, //  2,  5,  3
	{ -1, -1}, //  2,  5,  4
	{ -1, -1}, //  2,  5,  5
	{ -1, -1}, //  3, -5, -5
	{ -1, -1}, //  3, -5, -4
	{ -1, -1}, //  3, -5, -3
	{ -1, -1}, //  3, -5, -2
	{ -1, -1}, //  3, -5, -1
	{ -1, -1}, //  3, -5,  0
	{ -1, -1}, //  3, -5,  1
	{ -1, -1}, //  3, -5,  2
	{ -1, -1}, //  3, -5,  3
	{ -1, -1}, //  3, -5,  4
	{ -1, -1}, //  3, -5,  5
	{ -1, -1}, //  3, -4, -5
	{ -1, -1}, //  3, -4, -4
	{ -1, -1}, //  3, -4, -3
	{ -1, -1}, //  3, -4, -2
	{ -1, -1}, //  3, -4, -1
	{ 21, 1}, //  3, -4,  0
	{ -1, -1}, //  3, -4,  1
	{ -1, -1}, //  3, -4,  2
	{ -1, -1}, //  3, -4,  3
	{ -1, -1}, //  3, -4,  4
	{ -1, -1}, //  3, -4,  5
	{ -1, -1}, //  3, -3, -5
	{ -1, -1}, //  3, -3, -4
	{ -1, -1}, //  3, -3, -3
	{ 27, 1}, //  3, -3, -2
	{ 24, 1}, //  3, -3, -1
	{ 20, 1}, //  3, -3,  0
	{ 17, 1}, //  3, -3,  1
	{ 14, 1}, //  3, -3,  2
	{ -1, -1}, //  3, -3,  3
	{ -1, -1}, //  3, -3,  4
	{ -1, -1}, //  3, -3,  5
	{ -1, -1}, //  3, -2, -5
	{ -1, -1}, //  3, -2, -4
	{ 29, 1}, //  3, -2, -3
	{ 26, 1}, //  3, -2, -2
	{ 23, 1}, //  3, -2, -1
	{ 19, 1}, //  3, -2,  0
	{ 16, 1}, //  3, -2,  1
	{ 13, 1}, //  3, -2,  2
	{ -1, -1}, //  3, -2,  3
	{ -1, -1}, //  3, -2,  4
	{ -1, -1}, //  3, -2,  5
	{ -1, -1}, //  3, -1, -5
	{ -1, -1}, //  3, -1, -4
	{ 28, 1}, //  3, -1, -3
	{ 25, 1}, //  3, -1, -2
	{ 22, 1}, //  3, -1, -1
	{ 18, 1}, //  3, -1,  0
	{ 15, 1}, //  3, -1,  1
	{ 12, 1}, //  3, -1,  2
	{ 11, 1}, //  3, -1,  3
	{ -1, -1}, //  3, -1,  4
	{ -1, -1}, //  3, -1,  5
	{ -1, -1}, //  3,  0, -5
	{209, 0}, //  3,  0, -4
	{210, 0}, //  3,  0, -3
	{213, 0}, //  3,  0, -2
	{217, 0}, //  3,  0, -1
	{221, 0}, //  3,  0,  0
	{226, 0}, //  3,  0,  1
	{230, 0}, //  3,  0,  2
	{234, 0}, //  3,  0,  3
	{236, 0}, //  3,  0,  4
	{ -1, -1}, //  3,  0,  5
	{ -1, -1}, //  3,  1, -5
	{ -1, -1}, //  3,  1, -4
	{211, 0}, //  3,  1, -3
	{214, 0}, //  3,  1, -2
	{218, 0}, //  3,  1, -1
	{222, 0}, //  3,  1,  0
	{227, 0}, //  3,  1,  1
	{231, 0}, //  3,  1,  2
	{235, 0}, //  3,  1,  3
	{ -1, -1}, //  3,  1,  4
	{ -1, -1}, //  3,  1,  5
	{ -1, -1}, //  3,  2, -5
	{ -1, -1}, //  3,  2, -4
	{212, 0}, //  3,  2, -3
	{215, 0}, //  3,  2, -2
	{219, 0}, //  3,  2, -1
	{223, 0}, //  3,  2,  0
	{228, 0}, //  3,  2,  1
	{232, 0}, //  3,  2,  2
	{ -1, -1}, //  3,  2,  3
	{ -1, -1}, //  3,  2,  4
	{ -1, -1}, //  3,  2,  5
	{ -1, -1}, //  3,  3, -5
	{ -1, -1}, //  3,  3, -4
	{ -1, -1}, //  3,  3, -3
	{216, 0}, //  3,  3, -2
	{220, 0}, //  3,  3, -1
	{224, 0}, //  3,  3,  0
	{229, 0}, //  3,  3,  1
	{233, 0}, //  3,  3,  2
	{ -1, -1}, //  3,  3,  3
	{ -1, -1}, //  3,  3,  4
	{ -1, -1}, //  3,  3,  5
	{ -1, -1}, //  3,  4, -5
	{ -1, -1}, //  3,  4, -4
	{ -1, -1}, //  3,  4, -3
	{ -1, -1}, //  3,  4, -2
	{ -1, -1}, //  3,  4, -1
	{225, 0}, //  3,  4,  0
	{ -1, -1}, //  3,  4,  1
	{ -1, -1}, //  3,  4,  2
	{ -1, -1}, //  3,  4,  3
	{ -1, -1}, //  3,  4,  4
	{ -1, -1}, //  3,  4,  5
	{ -1, -1}, //  3,  5, -5
	{ -1, -1}, //  3,  5, -4
	{ -1, -1}, //  3,  5, -3
	{ -1, -1}, //  3,  5, -2
	{ -1, -1}, //  3,  5, -1
	{ -1, -1}, //  3,  5,  0
	{ -1, -1}, //  3,  5,  1
	{ -1, -1}, //  3,  5,  2
	{ -1, -1}, //  3,  5,  3
	{ -1, -1}, //  3,  5,  4
	{ -1, -1}, //  3,  5,  5
	{ -1, -1}, //  4, -5, -5
	{ -1, -1}, //  4, -5, -4
	{ -1, -1}, //  4, -5, -3
	{ -1, -1}, //  4, -5, -2
	{ -1, -1}, //  4, -5, -1
	{ -1, -1}, //  4, -5,  0
	{ -1, -1}, //  4, -5,  1
	{ -1, -1}, //  4, -5,  2
	{ -1, -1}, //  4, -5,  3
	{ -1, -1}, //  4, -5,  4
	{ -1, -1}, //  4, -5,  5
	{ -1, -1}, //  4, -4, -5
	{ -1, -1}, //  4, -4, -4
	{ -1, -1}, //  4, -4, -3
	{ -1, -1}, //  4, -4, -2
	{ -1, -1}, //  4, -4, -1
	{ -1, -1}, //  4, -4,  0
	{ -1, -1}, //  4, -4,  1
	{ -1, -1}, //  4, -4,  2
	{ -1, -1}, //  4, -4,  3
	{ -1, -1}, //  4, -4,  4
	{ -1, -1}, //  4, -4,  5
	{ -1, -1}, //  4, -3, -5
	{ -1, -1}, //  4, -3, -4
	{ -1, -1}, //  4, -3, -3
	{ -1, -1}, //  4, -3, -2
	{ -1, -1}, //  4, -3, -1
	{  6, 1}, //  4, -3,  0
	{ -1, -1}, //  4, -3,  1
	{ -1, -1}, //  4, -3,  2
	{ -1, -1}, //  4, -3,  3
	{ -1, -1}, //  4, -3,  4
	{ -1, -1}, //  4, -3,  5
	{ -1, -1}, //  4, -2, -5
	{ -1, -1}, //  4, -2, -4
	{ -1, -1}, //  4, -2, -3
	{ 10, 1}, //  4, -2, -2
	{  8, 1}, //  4, -2, -1
	{  5, 1}, //  4, -2,  0
	{  3, 1}, //  4, -2,  1
	{  1, 1}, //  4, -2,  2
	{ -1, -1}, //  4, -2,  3
	{ -1, -1}, //  4, -2,  4
	{ -1, -1}, //  4, -2,  5
	{ -1, -1}, //  4, -1, -5
	{ -1, -1}, //  4, -1, -4
	{ -1, -1}, //  4, -1, -3
	{  9, 1}, //  4, -1, -2
	{  7, 1}, //  4, -1, -1
	{  4, 1}, //  4, -1,  0
	{  2, 1}, //  4, -1,  1
	{  0, 1}, //  4, -1,  2
	{ -1, -1}, //  4, -1,  3
	{ -1, -1}, //  4, -1,  4
	{ -1, -1}, //  4, -1,  5
	{ -1, -1}, //  4,  0, -5
	{ -1, -1}, //  4,  0, -4
	{237, 0}, //  4,  0, -3
	{238, 0}, //  4,  0, -2
	{241, 0}, //  4,  0, -1
	{244, 0}, //  4,  0,  0
	{248, 0}, //  4,  0,  1
	{251, 0}, //  4,  0,  2
	{254, 0}, //  4,  0,  3
	{ -1, -1}, //  4,  0,  4
	{ -1, -1}, //  4,  0,  5
	{ -1, -1}, //  4,  1, -5
	{ -1, -1}, //  4,  1, -4
	{ -1, -1}, //  4,  1, -3
	{239, 0}, //  4,  1, -2
	{242, 0}, //  4,  1, -1
	{245, 0}, //  4,  1,  0
	{249, 0}, //  4,  1,  1
	{252, 0}, //  4,  1,  2
	{ -1, -1}, //  4,  1,  3
	{ -1, -1}, //  4,  1,  4
	{ -1, -1}, //  4,  1,  5
	{ -1, -1}, //  4,  2, -5
	{ -1, -1}, //  4,  2, -4
	{ -1, -1}, //  4,  2, -3
	{240, 0}, //  4,  2, -2
	{243, 0}, //  4,  2, -1
	{246, 0}, //  4,  2,  0
	{250, 0}, //  4,  2,  1
	{253, 0}, //  4,  2,  2
	{ -1, -1}, //  4,  2,  3
	{ -1, -1}, //  4,  2,  4
	{ -1, -1}, //  4,  2,  5
	{ -1, -1}, //  4,  3, -5
	{ -1, -1}, //  4,  3, -4
	{ -1, -1}, //  4,  3, -3
	{ -1, -1}, //  4,  3, -2
	{ -1, -1}, //  4,  3, -1
	{247, 0}, //  4,  3,  0
	{ -1, -1}, //  4,  3,  1
	{ -1, -1}, //  4,  3,  2
	{ -1, -1}, //  4,  3,  3
	{ -1, -1}, //  4,  3,  4
	{ -1, -1}, //  4,  3,  5
	{ -1, -1}, //  4,  4, -5
	{ -1, -1}, //  4,  4, -4
	{ -1, -1}, //  4,  4, -3
	{ -1, -1}, //  4,  4, -2
	{ -1, -1}, //  4,  4, -1
	{ -1, -1}, //  4,  4,  0
	{ -1, -1}, //  4,  4,  1
	{ -1, -1}, //  4,  4,  2
	{ -1, -1}, //  4,  4,  3
	{ -1, -1}, //  4,  4,  4
	{ -1, -1}, //  4,  4,  5
	{ -1, -1}, //  4,  5, -5
	{ -1, -1}, //  4,  5, -4
	{ -1, -1}, //  4,  5, -3
	{ -1, -1}, //  4,  5, -2
	{ -1, -1}, //  4,  5, -1
	{ -1, -1}, //  4,  5,  0
	{ -1, -1}, //  4,  5,  1
	{ -1, -1}, //  4,  5,  2
	{ -1, -1}, //  4,  5,  3
	{ -1, -1}, //  4,  5,  4
	{ -1, -1}, //  4,  5,  5
	{ -1, -1}, //  5, -5, -5
	{ -1, -1}, //  5, -5, -4
	{ -1, -1}, //  5, -5, -3
	{ -1, -1}, //  5, -5, -2
	{ -1, -1}, //  5, -5, -1
	{ -1, -1}, //  5, -5,  0
	{ -1, -1}, //  5, -5,  1
	{ -1, -1}, //  5, -5,  2
	{ -1, -1}, //  5, -5,  3
	{ -1, -1}, //  5, -5,  4
	{ -1, -1}, //  5, -5,  5
	{ -1, -1}, //  5, -4, -5
	{ -1, -1}, //  5, -4, -4
	{ -1, -1}, //  5, -4, -3
	{ -1, -1}, //  5, -4, -2
	{ -1, -1}, //  5, -4, -1
	{ -1, -1}, //  5, -4,  0
	{ -1, -1}, //  5, -4,  1
	{ -1, -1}, //  5, -4,  2
	{ -1, -1}, //  5, -4,  3
	{ -1, -1}, //  5, -4,  4
	{ -1, -1}, //  5, -4,  5
	{ -1, -1}, //  5, -3, -5
	{ -1, -1}, //  5, -3, -4
	{ -1, -1}, //  5, -3, -3
	{ -1, -1}, //  5, -3, -2
	{ -1, -1}, //  5, -3, -1
	{ -1, -1}, //  5, -3,  0
	{ -1, -1}, //  5, -3,  1
	{ -1, -1}, //  5, -3,  2
	{ -1, -1}, //  5, -3,  3
	{ -1, -1}, //  5, -3,  4
	{ -1, -1}, //  5, -3,  5
	{ -1, -1}, //  5, -2, -5
	{ -1, -1}, //  5, -2, -4
	{ -1, -1}, //  5, -2, -3
	{ -1, -1}, //  5, -2, -2
	{ -1, -1}, //  5, -2, -1
	{ -1, -1}, //  5, -2,  0
	{ -1, -1}, //  5, -2,  1
	{ -1, -1}, //  5, -2,  2
	{ -1, -1}, //  5, -2,  3
	{ -1, -1}, //  5, -2,  4
	{ -1, -1}, //  5, -2,  5
	{ -1, -1}, //  5, -1, -5
	{ -1, -1}, //  5, -1, -4
	{ -1, -1}, //  5, -1, -3
	{ -1, -1}, //  5, -1, -2
	{ -1, -1}, //  5, -1, -1
	{ -1, -1}, //  5, -1,  0
	{ -1, -1}, //  5, -1,  1
	{ -1, -1}, //  5, -1,  2
	{ -1, -1}, //  5, -1,  3
	{ -1, -1}, //  5, -1,  4
	{ -1, -1}, //  5, -1,  5
	{ -1, -1}, //  5,  0, -5
	{ -1, -1}, //  5,  0, -4
	{ -1, -1}, //  5,  0, -3
	{ -1, -1}, //  5,  0, -2
	{ -1, -1}, //  5,  0, -1
	{255, 0}, //  5,  0,  0
	{ -1, -1}, //  5,  0,  1
	{ -1, -1}, //  5,  0,  2
	{ -1, -1}, //  5,  0,  3
	{ -1, -1}, //  5,  0,  4
	{ -1, -1}, //  5,  0,  5
	{ -1, -1}, //  5,  1, -5
	{ -1, -1}, //  5,  1, -4
	{ -1, -1}, //  5,  1, -3
	{ -1, -1}, //  5,  1, -2
	{ -1, -1}, //  5,  1, -1
	{ -1, -1}, //  5,  1,  0
	{ -1, -1}, //  5,  1,  1
	{ -1, -1}, //  5,  1,  2
	{ -1, -1}, //  5,  1,  3
	{ -1, -1}, //  5,  1,  4
	{ -1, -1}, //  5,  1,  5
	{ -1, -1}, //  5,  2, -5
	{ -1, -1}, //  5,  2, -4
	{ -1, -1}, //  5,  2, -3
	{ -1, -1}, //  5,  2, -2
	{ -1, -1}, //  5,  2, -1
	{ -1, -1}, //  5,  2,  0
	{ -1, -1}, //  5,  2,  1
	{ -1, -1}, //  5,  2,  2
	{ -1, -1}, //  5,  2,  3
	{ -1, -1}, //  5,  2,  4
	{ -1, -1}, //  5,  2,  5
	{ -1, -1}, //  5,  3, -5
	{ -1, -1}, //  5,  3, -4
	{ -1, -1}, //  5,  3, -3
	{ -1, -1}, //  5,  3, -2
	{ -1, -1}, //  5,  3, -1
	{ -1, -1}, //  5,  3,  0
	{ -1, -1}, //  5,  3,  1
	{ -1, -1}, //  5,  3,  2
	{ -1, -1}, //  5,  3,  3
	{ -1, -1}, //  5,  3,  4
	{ -1, -1}, //  5,  3,  5
	{ -1, -1}, //  5,  4, -5
	{ -1, -1}, //  5,  4, -4
	{ -1, -1}, //  5,  4, -3
	{ -1, -1}, //  5,  4, -2
	{ -1, -1}, //  5,  4, -1
	{ -1, -1}, //  5,  4,  0
	{ -1, -1}, //  5,  4,  1
	{ -1, -1}, //  5,  4,  2
	{ -1, -1}, //  5,  4,  3
	{ -1, -1}, //  5,  4,  4
	{ -1, -1}, //  5,  4,  5
	{ -1, -1}, //  5,  5, -5
	{ -1, -1}, //  5,  5, -4
	{ -1, -1}, //  5,  5, -3
	{ -1, -1}, //  5,  5, -2
	{ -1, -1}, //  5,  5, -1
	{ -1, -1}, //  5,  5,  0
	{ -1, -1}, //  5,  5,  1
	{ -1, -1}, //  5,  5,  2
	{ -1, -1}, //  5,  5,  3
	{ -1, -1}, //  5,  5,  4
	{ -1, -1}, //  5,  5,  5
};
#define DDS_HALF_SPHERE_MAP_NUM_INDEXES	(256)
static int g_dds_half_sphere_map[DDS_HALF_SPHERE_MAP_NUM_INDEXES][3] = 
{
	{-4, 1,-2},
	{-4, 2,-2},
	{-4, 1,-1},
	{-4, 2,-1},
	{-4, 1, 0},
	{-4, 2, 0},
	{-4, 3, 0},
	{-4, 1, 1},
	{-4, 2, 1},
	{-4, 1, 2},
	{-4, 2, 2},
	{-3, 1,-3},
	//{-3, 2,-3},
	{-3, 1,-2},
	{-3, 2,-2},
	{-3, 3,-2},
	{-3, 1,-1},
	{-3, 2,-1},
	{-3, 3,-1},
	{-3, 1, 0},
	{-3, 2, 0},
	{-3, 3, 0},
	{-3, 4, 0},
	{-3, 1, 1},
	{-3, 2, 1},
	{-3, 3, 1},
	{-3, 1, 2},
	{-3, 2, 2},
	{-3, 3, 2},
	{-3, 1, 3},
	{-3, 2, 3},
	{-2, 1,-4},
	{-2, 2,-4},
	{-2, 1,-3},
	{-2, 2,-3},
	{-2, 3,-3},
	{-2, 1,-2},
	{-2, 2,-2},
	{-2, 3,-2},
	{-2, 4,-2},
	{-2, 1,-1},
	{-2, 2,-1},
	{-2, 3,-1},
	{-2, 4,-1},
	{-2, 1, 0},
	{-2, 2, 0},
	{-2, 3, 0},
	{-2, 4, 0},
	{-2, 1, 1},
	{-2, 2, 1},
	{-2, 3, 1},
	{-2, 4, 1},
	{-2, 1, 2},
	{-2, 2, 2},
	{-2, 3, 2},
	{-2, 4, 2},
	{-2, 1, 3},
	{-2, 2, 3},
	{-2, 3, 3},
	{-2, 1, 4},
	{-2, 2, 4},
	{-1, 1,-4},
	{-1, 2,-4},
	{-1, 1,-3},
	{-1, 2,-3},
	{-1, 3,-3},
	{-1, 1,-2},
	{-1, 2,-2},
	{-1, 3,-2},
	{-1, 4,-2},
	{-1, 1,-1},
	{-1, 2,-1},
	{-1, 3,-1},
	{-1, 4,-1},
	{-1, 1, 0},
	{-1, 2, 0},
	{-1, 3, 0},
	{-1, 4, 0},
	{-1, 1, 1},
	{-1, 2, 1},
	{-1, 3, 1},
	{-1, 4, 1},
	{-1, 1, 2},
	{-1, 2, 2},
	{-1, 3, 2},
	{-1, 4, 2},
	{-1, 1, 3},
	{-1, 2, 3},
	{-1, 3, 3},
	{-1, 1, 4},
	{-1, 2, 4},
	{ 0, 1,-4},
	{ 0, 2,-4},
	{ 0, 3,-4},
	{ 0, 1,-3},
	{ 0, 2,-3},
	{ 0, 3,-3},
	{ 0, 4,-3},
	{ 0, 1,-2},
	{ 0, 2,-2},
	{ 0, 3,-2},
	{ 0, 4,-2},
	{ 0, 1,-1},
	{ 0, 2,-1},
	{ 0, 3,-1},
	{ 0, 4,-1},
	{ 0, 0, 0},
	{ 0, 1, 0},
	{ 0, 2, 0},
	{ 0, 3, 0},
	{ 0, 4, 0},
	{ 0, 5, 0},
	{ 0, 0, 1},
	{ 0, 1, 1},
	{ 0, 2, 1},
	{ 0, 3, 1},
	{ 0, 4, 1},
	{ 0, 0, 2},
	{ 0, 1, 2},
	{ 0, 2, 2},
	{ 0, 3, 2},
	{ 0, 4, 2},
	{ 0, 0, 3},
	{ 0, 1, 3},
	{ 0, 2, 3},
	{ 0, 3, 3},
	{ 0, 4, 3},
	{ 0, 0, 4},
	{ 0, 1, 4},
	{ 0, 2, 4},
	{ 0, 3, 4},
	{ 0, 0, 5},
	{ 1, 0,-4},
	{ 1, 1,-4},
	{ 1, 2,-4},
	{ 1, 0,-3},
	{ 1, 1,-3},
	{ 1, 2,-3},
	{ 1, 3,-3},
	{ 1, 0,-2},
	{ 1, 1,-2},
	{ 1, 2,-2},
	{ 1, 3,-2},
	{ 1, 4,-2},
	{ 1, 0,-1},
	{ 1, 1,-1},
	{ 1, 2,-1},
	{ 1, 3,-1},
	{ 1, 4,-1},
	{ 1, 0, 0},
	{ 1, 1, 0},
	{ 1, 2, 0},
	{ 1, 3, 0},
	{ 1, 4, 0},
	{ 1, 0, 1},
	{ 1, 1, 1},
	{ 1, 2, 1},
	{ 1, 3, 1},
	{ 1, 4, 1},
	{ 1, 0, 2},
	{ 1, 1, 2},
	{ 1, 2, 2},
	{ 1, 3, 2},
	{ 1, 4, 2},
	{ 1, 0, 3},
	{ 1, 1, 3},
	{ 1, 2, 3},
	{ 1, 3, 3},
	{ 1, 0, 4},
	{ 1, 1, 4},
	{ 1, 2, 4},
	{ 2, 0,-4},
	{ 2, 1,-4},
	{ 2, 2,-4},
	{ 2, 0,-3},
	{ 2, 1,-3},
	{ 2, 2,-3},
	{ 2, 3,-3},
	{ 2, 0,-2},
	{ 2, 1,-2},
	{ 2, 2,-2},
	{ 2, 3,-2},
	{ 2, 4,-2},
	{ 2, 0,-1},
	{ 2, 1,-1},
	{ 2, 2,-1},
	{ 2, 3,-1},
	{ 2, 4,-1},
	{ 2, 0, 0},
	{ 2, 1, 0},
	{ 2, 2, 0},
	{ 2, 3, 0},
	{ 2, 4, 0},
	{ 2, 0, 1},
	{ 2, 1, 1},
	{ 2, 2, 1},
	{ 2, 3, 1},
	{ 2, 4, 1},
	{ 2, 0, 2},
	{ 2, 1, 2},
	{ 2, 2, 2},
	{ 2, 3, 2},
	{ 2, 4, 2},
	{ 2, 0, 3},
	{ 2, 1, 3},
	{ 2, 2, 3},
	{ 2, 3, 3},
	{ 2, 0, 4},
	{ 2, 1, 4},
	{ 2, 2, 4},
	{ 3, 0,-4},
	{ 3, 0,-3},
	{ 3, 1,-3},
	{ 3, 2,-3},
	{ 3, 0,-2},
	{ 3, 1,-2},
	{ 3, 2,-2},
	{ 3, 3,-2},
	{ 3, 0,-1},
	{ 3, 1,-1},
	{ 3, 2,-1},
	{ 3, 3,-1},
	{ 3, 0, 0},
	{ 3, 1, 0},
	{ 3, 2, 0},
	{ 3, 3, 0},
	{ 3, 4, 0},
	{ 3, 0, 1},
	{ 3, 1, 1},
	{ 3, 2, 1},
	{ 3, 3, 1},
	{ 3, 0, 2},
	{ 3, 1, 2},
	{ 3, 2, 2},
	{ 3, 3, 2},
	{ 3, 0, 3},
	{ 3, 1, 3},
	//{ 3, 2, 3},
	{ 3, 0, 4},
	{ 4, 0,-3},
	{ 4, 0,-2},
	{ 4, 1,-2},
	{ 4, 2,-2},
	{ 4, 0,-1},
	{ 4, 1,-1},
	{ 4, 2,-1},
	{ 4, 0, 0},
	{ 4, 1, 0},
	{ 4, 2, 0},
	{ 4, 3, 0},
	{ 4, 0, 1},
	{ 4, 1, 1},
	{ 4, 2, 1},
	{ 4, 0, 2},
	{ 4, 1, 2},
	{ 4, 2, 2},
	{ 4, 0, 3},
	{ 5, 0, 0}
};
// endpoint pairs to colour map assuming index 2. For index 3, flip order of the endpoints.
// entry 0 is endpoint 0.
// entry 1 is endpoint 1.
// entry 2 is the index of the next closest colour < the current colour. If there is no colour < the current colour, this will equal the current index.
// entry 3 is the index of the next closest colour > the current colour. If there is no colour > the current colour, this will equal the current index.
static int g_dds_bestfitmap5[256][2][4] =
{
	{{ 0,  0,   0,   2} /* colour   0, closest below   0, closest above   3 */, { 0,  0,   0,   3}  /* colour   0, closest below   0, closest above   4 */}, // index   0
	{{ 0,  0,   1,   2} /* colour   0, closest below   0, closest above   3 */, { 0,  0,   1,   3}  /* colour   0, closest below   0, closest above   4 */}, // index   1
	{{ 0,  1,   1,   5} /* colour   3, closest below   0, closest above   5 */, { 0,  0,   2,   3}  /* colour   0, closest below   0, closest above   4 */}, // index   2
	{{ 0,  1,   1,   5} /* colour   3, closest below   0, closest above   5 */, { 0,  1,   2,   7}  /* colour   4, closest below   0, closest above   8 */}, // index   3
	{{ 0,  1,   1,   5} /* colour   3, closest below   0, closest above   5 */, { 0,  1,   2,   7}  /* colour   4, closest below   0, closest above   8 */}, // index   4
	{{ 1,  0,   4,   7} /* colour   5, closest below   3, closest above   8 */, { 0,  1,   2,   7}  /* colour   4, closest below   0, closest above   8 */}, // index   5
	{{ 1,  0,   4,   7} /* colour   5, closest below   3, closest above   8 */, { 0,  1,   2,   7}  /* colour   4, closest below   0, closest above   8 */}, // index   6
	{{ 1,  1,   6,  10} /* colour   8, closest below   5, closest above  11 */, { 1,  1,   6,  11}  /* colour   8, closest below   4, closest above  12 */}, // index   7
	{{ 1,  1,   6,  10} /* colour   8, closest below   5, closest above  11 */, { 1,  1,   6,  11}  /* colour   8, closest below   4, closest above  12 */}, // index   8
	{{ 1,  1,   6,  10} /* colour   8, closest below   5, closest above  11 */, { 1,  1,   6,  11}  /* colour   8, closest below   4, closest above  12 */}, // index   9
	{{ 1,  2,   9,  13} /* colour  11, closest below   8, closest above  13 */, { 1,  1,   6,  11}  /* colour   8, closest below   4, closest above  12 */}, // index  10
	{{ 1,  2,   9,  13} /* colour  11, closest below   8, closest above  13 */, { 1,  2,  10,  15}  /* colour  12, closest below   8, closest above  16 */}, // index  11
	{{ 1,  2,   9,  13} /* colour  11, closest below   8, closest above  13 */, { 1,  2,  10,  15}  /* colour  12, closest below   8, closest above  16 */}, // index  12
	{{ 2,  1,  12,  14} /* colour  13, closest below  11, closest above  14 */, { 1,  2,  10,  15}  /* colour  12, closest below   8, closest above  16 */}, // index  13
	{{ 0,  5,  13,  16} /* colour  14, closest below  13, closest above  16 */, { 1,  2,  10,  15}  /* colour  12, closest below   8, closest above  16 */}, // index  14
	{{ 0,  5,  13,  16} /* colour  14, closest below  13, closest above  16 */, { 2,  2,  14,  17}  /* colour  16, closest below  12, closest above  17 */}, // index  15
	{{ 2,  2,  15,  18} /* colour  16, closest below  14, closest above  19 */, { 2,  2,  14,  17}  /* colour  16, closest below  12, closest above  17 */}, // index  16
	{{ 2,  2,  15,  18} /* colour  16, closest below  14, closest above  19 */, { 0,  4,  16,  19}  /* colour  17, closest below  16, closest above  20 */}, // index  17
	{{ 2,  3,  17,  21} /* colour  19, closest below  16, closest above  21 */, { 0,  4,  16,  19}  /* colour  17, closest below  16, closest above  20 */}, // index  18
	{{ 2,  3,  17,  21} /* colour  19, closest below  16, closest above  21 */, { 2,  3,  18,  21}  /* colour  20, closest below  17, closest above  21 */}, // index  19
	{{ 2,  3,  17,  21} /* colour  19, closest below  16, closest above  21 */, { 2,  3,  18,  21}  /* colour  20, closest below  17, closest above  21 */}, // index  20
	{{ 3,  2,  20,  22} /* colour  21, closest below  19, closest above  22 */, { 1,  4,  20,  23}  /* colour  21, closest below  20, closest above  24 */}, // index  21
	{{ 2,  4,  21,  24} /* colour  22, closest below  21, closest above  24 */, { 1,  4,  20,  23}  /* colour  21, closest below  20, closest above  24 */}, // index  22
	{{ 2,  4,  21,  24} /* colour  22, closest below  21, closest above  24 */, { 3,  3,  22,  25}  /* colour  24, closest below  21, closest above  25 */}, // index  23
	{{ 3,  3,  23,  25} /* colour  24, closest below  22, closest above  25 */, { 3,  3,  22,  25}  /* colour  24, closest below  21, closest above  25 */}, // index  24
	{{ 4,  1,  24,  27} /* colour  25, closest below  24, closest above  27 */, { 2,  4,  24,  28}  /* colour  25, closest below  24, closest above  29 */}, // index  25
	{{ 4,  1,  24,  27} /* colour  25, closest below  24, closest above  27 */, { 2,  4,  24,  28}  /* colour  25, closest below  24, closest above  29 */}, // index  26
	{{ 3,  4,  26,  29} /* colour  27, closest below  25, closest above  30 */, { 2,  4,  24,  28}  /* colour  25, closest below  24, closest above  29 */}, // index  27
	{{ 3,  4,  26,  29} /* colour  27, closest below  25, closest above  30 */, { 3,  4,  27,  32}  /* colour  29, closest below  25, closest above  33 */}, // index  28
	{{ 4,  3,  28,  32} /* colour  30, closest below  27, closest above  32 */, { 3,  4,  27,  32}  /* colour  29, closest below  25, closest above  33 */}, // index  29
	{{ 4,  3,  28,  32} /* colour  30, closest below  27, closest above  32 */, { 3,  4,  27,  32}  /* colour  29, closest below  25, closest above  33 */}, // index  30
	{{ 4,  3,  28,  32} /* colour  30, closest below  27, closest above  32 */, { 3,  4,  27,  32}  /* colour  29, closest below  25, closest above  33 */}, // index  31
	{{ 3,  6,  31,  33} /* colour  32, closest below  30, closest above  33 */, { 4,  4,  31,  36}  /* colour  33, closest below  29, closest above  37 */}, // index  32
	{{ 4,  4,  32,  35} /* colour  33, closest below  32, closest above  35 */, { 4,  4,  31,  36}  /* colour  33, closest below  29, closest above  37 */}, // index  33
	{{ 4,  4,  32,  35} /* colour  33, closest below  32, closest above  35 */, { 4,  4,  31,  36}  /* colour  33, closest below  29, closest above  37 */}, // index  34
	{{ 5,  3,  34,  36} /* colour  35, closest below  33, closest above  36 */, { 4,  4,  31,  36}  /* colour  33, closest below  29, closest above  37 */}, // index  35
	{{ 4,  5,  35,  38} /* colour  36, closest below  35, closest above  38 */, { 4,  5,  35,  40}  /* colour  37, closest below  33, closest above  41 */}, // index  36
	{{ 4,  5,  35,  38} /* colour  36, closest below  35, closest above  38 */, { 4,  5,  35,  40}  /* colour  37, closest below  33, closest above  41 */}, // index  37
	{{ 5,  4,  37,  40} /* colour  38, closest below  36, closest above  41 */, { 4,  5,  35,  40}  /* colour  37, closest below  33, closest above  41 */}, // index  38
	{{ 5,  4,  37,  40} /* colour  38, closest below  36, closest above  41 */, { 4,  5,  35,  40}  /* colour  37, closest below  33, closest above  41 */}, // index  39
	{{ 5,  5,  39,  43} /* colour  41, closest below  38, closest above  43 */, { 5,  5,  39,  44}  /* colour  41, closest below  37, closest above  45 */}, // index  40
	{{ 5,  5,  39,  43} /* colour  41, closest below  38, closest above  43 */, { 5,  5,  39,  44}  /* colour  41, closest below  37, closest above  45 */}, // index  41
	{{ 5,  5,  39,  43} /* colour  41, closest below  38, closest above  43 */, { 5,  5,  39,  44}  /* colour  41, closest below  37, closest above  45 */}, // index  42
	{{ 7,  2,  42,  44} /* colour  43, closest below  41, closest above  44 */, { 5,  5,  39,  44}  /* colour  41, closest below  37, closest above  45 */}, // index  43
	{{ 5,  6,  43,  46} /* colour  44, closest below  43, closest above  46 */, { 5,  6,  43,  48}  /* colour  45, closest below  41, closest above  49 */}, // index  44
	{{ 5,  6,  43,  46} /* colour  44, closest below  43, closest above  46 */, { 5,  6,  43,  48}  /* colour  45, closest below  41, closest above  49 */}, // index  45
	{{ 6,  5,  45,  47} /* colour  46, closest below  44, closest above  47 */, { 5,  6,  43,  48}  /* colour  45, closest below  41, closest above  49 */}, // index  46
	{{ 4,  9,  46,  49} /* colour  47, closest below  46, closest above  49 */, { 5,  6,  43,  48}  /* colour  45, closest below  41, closest above  49 */}, // index  47
	{{ 4,  9,  46,  49} /* colour  47, closest below  46, closest above  49 */, { 6,  6,  47,  50}  /* colour  49, closest below  45, closest above  50 */}, // index  48
	{{ 6,  6,  48,  51} /* colour  49, closest below  47, closest above  52 */, { 6,  6,  47,  50}  /* colour  49, closest below  45, closest above  50 */}, // index  49
	{{ 6,  6,  48,  51} /* colour  49, closest below  47, closest above  52 */, { 4,  8,  49,  52}  /* colour  50, closest below  49, closest above  53 */}, // index  50
	{{ 6,  7,  50,  54} /* colour  52, closest below  49, closest above  54 */, { 4,  8,  49,  52}  /* colour  50, closest below  49, closest above  53 */}, // index  51
	{{ 6,  7,  50,  54} /* colour  52, closest below  49, closest above  54 */, { 6,  7,  51,  54}  /* colour  53, closest below  50, closest above  54 */}, // index  52
	{{ 6,  7,  50,  54} /* colour  52, closest below  49, closest above  54 */, { 6,  7,  51,  54}  /* colour  53, closest below  50, closest above  54 */}, // index  53
	{{ 7,  6,  53,  55} /* colour  54, closest below  52, closest above  55 */, { 5,  8,  53,  56}  /* colour  54, closest below  53, closest above  57 */}, // index  54
	{{ 6,  8,  54,  57} /* colour  55, closest below  54, closest above  57 */, { 5,  8,  53,  56}  /* colour  54, closest below  53, closest above  57 */}, // index  55
	{{ 6,  8,  54,  57} /* colour  55, closest below  54, closest above  57 */, { 7,  7,  55,  58}  /* colour  57, closest below  54, closest above  58 */}, // index  56
	{{ 7,  7,  56,  58} /* colour  57, closest below  55, closest above  58 */, { 7,  7,  55,  58}  /* colour  57, closest below  54, closest above  58 */}, // index  57
	{{ 8,  5,  57,  60} /* colour  58, closest below  57, closest above  60 */, { 6,  8,  57,  61}  /* colour  58, closest below  57, closest above  62 */}, // index  58
	{{ 8,  5,  57,  60} /* colour  58, closest below  57, closest above  60 */, { 6,  8,  57,  61}  /* colour  58, closest below  57, closest above  62 */}, // index  59
	{{ 7,  8,  59,  62} /* colour  60, closest below  58, closest above  63 */, { 6,  8,  57,  61}  /* colour  58, closest below  57, closest above  62 */}, // index  60
	{{ 7,  8,  59,  62} /* colour  60, closest below  58, closest above  63 */, { 7,  8,  60,  65}  /* colour  62, closest below  58, closest above  66 */}, // index  61
	{{ 8,  7,  61,  65} /* colour  63, closest below  60, closest above  65 */, { 7,  8,  60,  65}  /* colour  62, closest below  58, closest above  66 */}, // index  62
	{{ 8,  7,  61,  65} /* colour  63, closest below  60, closest above  65 */, { 7,  8,  60,  65}  /* colour  62, closest below  58, closest above  66 */}, // index  63
	{{ 8,  7,  61,  65} /* colour  63, closest below  60, closest above  65 */, { 7,  8,  60,  65}  /* colour  62, closest below  58, closest above  66 */}, // index  64
	{{ 7, 10,  64,  66} /* colour  65, closest below  63, closest above  66 */, { 8,  8,  64,  69}  /* colour  66, closest below  62, closest above  70 */}, // index  65
	{{ 8,  8,  65,  68} /* colour  66, closest below  65, closest above  68 */, { 8,  8,  64,  69}  /* colour  66, closest below  62, closest above  70 */}, // index  66
	{{ 8,  8,  65,  68} /* colour  66, closest below  65, closest above  68 */, { 8,  8,  64,  69}  /* colour  66, closest below  62, closest above  70 */}, // index  67
	{{ 9,  7,  67,  69} /* colour  68, closest below  66, closest above  69 */, { 8,  8,  64,  69}  /* colour  66, closest below  62, closest above  70 */}, // index  68
	{{ 8,  9,  68,  71} /* colour  69, closest below  68, closest above  71 */, { 8,  9,  68,  73}  /* colour  70, closest below  66, closest above  74 */}, // index  69
	{{ 8,  9,  68,  71} /* colour  69, closest below  68, closest above  71 */, { 8,  9,  68,  73}  /* colour  70, closest below  66, closest above  74 */}, // index  70
	{{ 9,  8,  70,  73} /* colour  71, closest below  69, closest above  74 */, { 8,  9,  68,  73}  /* colour  70, closest below  66, closest above  74 */}, // index  71
	{{ 9,  8,  70,  73} /* colour  71, closest below  69, closest above  74 */, { 8,  9,  68,  73}  /* colour  70, closest below  66, closest above  74 */}, // index  72
	{{ 9,  9,  72,  76} /* colour  74, closest below  71, closest above  76 */, { 9,  9,  72,  77}  /* colour  74, closest below  70, closest above  78 */}, // index  73
	{{ 9,  9,  72,  76} /* colour  74, closest below  71, closest above  76 */, { 9,  9,  72,  77}  /* colour  74, closest below  70, closest above  78 */}, // index  74
	{{ 9,  9,  72,  76} /* colour  74, closest below  71, closest above  76 */, { 9,  9,  72,  77}  /* colour  74, closest below  70, closest above  78 */}, // index  75
	{{11,  6,  75,  77} /* colour  76, closest below  74, closest above  77 */, { 9,  9,  72,  77}  /* colour  74, closest below  70, closest above  78 */}, // index  76
	{{ 9, 10,  76,  79} /* colour  77, closest below  76, closest above  79 */, { 9, 10,  76,  81}  /* colour  78, closest below  74, closest above  82 */}, // index  77
	{{ 9, 10,  76,  79} /* colour  77, closest below  76, closest above  79 */, { 9, 10,  76,  81}  /* colour  78, closest below  74, closest above  82 */}, // index  78
	{{10,  9,  78,  80} /* colour  79, closest below  77, closest above  80 */, { 9, 10,  76,  81}  /* colour  78, closest below  74, closest above  82 */}, // index  79
	{{ 8, 13,  79,  82} /* colour  80, closest below  79, closest above  82 */, { 9, 10,  76,  81}  /* colour  78, closest below  74, closest above  82 */}, // index  80
	{{ 8, 13,  79,  82} /* colour  80, closest below  79, closest above  82 */, {10, 10,  80,  83}  /* colour  82, closest below  78, closest above  83 */}, // index  81
	{{10, 10,  81,  84} /* colour  82, closest below  80, closest above  85 */, {10, 10,  80,  83}  /* colour  82, closest below  78, closest above  83 */}, // index  82
	{{10, 10,  81,  84} /* colour  82, closest below  80, closest above  85 */, { 8, 12,  82,  85}  /* colour  83, closest below  82, closest above  86 */}, // index  83
	{{10, 11,  83,  87} /* colour  85, closest below  82, closest above  87 */, { 8, 12,  82,  85}  /* colour  83, closest below  82, closest above  86 */}, // index  84
	{{10, 11,  83,  87} /* colour  85, closest below  82, closest above  87 */, {10, 11,  84,  87}  /* colour  86, closest below  83, closest above  87 */}, // index  85
	{{10, 11,  83,  87} /* colour  85, closest below  82, closest above  87 */, {10, 11,  84,  87}  /* colour  86, closest below  83, closest above  87 */}, // index  86
	{{11, 10,  86,  88} /* colour  87, closest below  85, closest above  88 */, { 9, 12,  86,  89}  /* colour  87, closest below  86, closest above  90 */}, // index  87
	{{10, 12,  87,  90} /* colour  88, closest below  87, closest above  90 */, { 9, 12,  86,  89}  /* colour  87, closest below  86, closest above  90 */}, // index  88
	{{10, 12,  87,  90} /* colour  88, closest below  87, closest above  90 */, {11, 11,  88,  91}  /* colour  90, closest below  87, closest above  91 */}, // index  89
	{{11, 11,  89,  91} /* colour  90, closest below  88, closest above  91 */, {11, 11,  88,  91}  /* colour  90, closest below  87, closest above  91 */}, // index  90
	{{12,  9,  90,  93} /* colour  91, closest below  90, closest above  93 */, {10, 12,  90,  94}  /* colour  91, closest below  90, closest above  95 */}, // index  91
	{{12,  9,  90,  93} /* colour  91, closest below  90, closest above  93 */, {10, 12,  90,  94}  /* colour  91, closest below  90, closest above  95 */}, // index  92
	{{11, 12,  92,  95} /* colour  93, closest below  91, closest above  96 */, {10, 12,  90,  94}  /* colour  91, closest below  90, closest above  95 */}, // index  93
	{{11, 12,  92,  95} /* colour  93, closest below  91, closest above  96 */, {11, 12,  93,  98}  /* colour  95, closest below  91, closest above  99 */}, // index  94
	{{12, 11,  94,  98} /* colour  96, closest below  93, closest above  98 */, {11, 12,  93,  98}  /* colour  95, closest below  91, closest above  99 */}, // index  95
	{{12, 11,  94,  98} /* colour  96, closest below  93, closest above  98 */, {11, 12,  93,  98}  /* colour  95, closest below  91, closest above  99 */}, // index  96
	{{12, 11,  94,  98} /* colour  96, closest below  93, closest above  98 */, {11, 12,  93,  98}  /* colour  95, closest below  91, closest above  99 */}, // index  97
	{{11, 14,  97,  99} /* colour  98, closest below  96, closest above  99 */, {12, 12,  97, 102}  /* colour  99, closest below  95, closest above 103 */}, // index  98
	{{12, 12,  98, 101} /* colour  99, closest below  98, closest above 101 */, {12, 12,  97, 102}  /* colour  99, closest below  95, closest above 103 */}, // index  99
	{{12, 12,  98, 101} /* colour  99, closest below  98, closest above 101 */, {12, 12,  97, 102}  /* colour  99, closest below  95, closest above 103 */}, // index 100
	{{13, 11, 100, 102} /* colour 101, closest below  99, closest above 102 */, {12, 12,  97, 102}  /* colour  99, closest below  95, closest above 103 */}, // index 101
	{{12, 13, 101, 104} /* colour 102, closest below 101, closest above 104 */, {12, 13, 101, 106}  /* colour 103, closest below  99, closest above 107 */}, // index 102
	{{12, 13, 101, 104} /* colour 102, closest below 101, closest above 104 */, {12, 13, 101, 106}  /* colour 103, closest below  99, closest above 107 */}, // index 103
	{{13, 12, 103, 106} /* colour 104, closest below 102, closest above 107 */, {12, 13, 101, 106}  /* colour 103, closest below  99, closest above 107 */}, // index 104
	{{13, 12, 103, 106} /* colour 104, closest below 102, closest above 107 */, {12, 13, 101, 106}  /* colour 103, closest below  99, closest above 107 */}, // index 105
	{{13, 13, 105, 109} /* colour 107, closest below 104, closest above 109 */, {13, 13, 105, 110}  /* colour 107, closest below 103, closest above 111 */}, // index 106
	{{13, 13, 105, 109} /* colour 107, closest below 104, closest above 109 */, {13, 13, 105, 110}  /* colour 107, closest below 103, closest above 111 */}, // index 107
	{{13, 13, 105, 109} /* colour 107, closest below 104, closest above 109 */, {13, 13, 105, 110}  /* colour 107, closest below 103, closest above 111 */}, // index 108
	{{15, 10, 108, 110} /* colour 109, closest below 107, closest above 110 */, {13, 13, 105, 110}  /* colour 107, closest below 103, closest above 111 */}, // index 109
	{{13, 14, 109, 112} /* colour 110, closest below 109, closest above 112 */, {13, 14, 109, 114}  /* colour 111, closest below 107, closest above 115 */}, // index 110
	{{13, 14, 109, 112} /* colour 110, closest below 109, closest above 112 */, {13, 14, 109, 114}  /* colour 111, closest below 107, closest above 115 */}, // index 111
	{{14, 13, 111, 113} /* colour 112, closest below 110, closest above 113 */, {13, 14, 109, 114}  /* colour 111, closest below 107, closest above 115 */}, // index 112
	{{12, 17, 112, 115} /* colour 113, closest below 112, closest above 115 */, {13, 14, 109, 114}  /* colour 111, closest below 107, closest above 115 */}, // index 113
	{{12, 17, 112, 115} /* colour 113, closest below 112, closest above 115 */, {14, 14, 113, 116}  /* colour 115, closest below 111, closest above 116 */}, // index 114
	{{14, 14, 114, 117} /* colour 115, closest below 113, closest above 118 */, {14, 14, 113, 116}  /* colour 115, closest below 111, closest above 116 */}, // index 115
	{{14, 14, 114, 117} /* colour 115, closest below 113, closest above 118 */, {12, 16, 115, 118}  /* colour 116, closest below 115, closest above 119 */}, // index 116
	{{14, 15, 116, 120} /* colour 118, closest below 115, closest above 120 */, {12, 16, 115, 118}  /* colour 116, closest below 115, closest above 119 */}, // index 117
	{{14, 15, 116, 120} /* colour 118, closest below 115, closest above 120 */, {14, 15, 117, 120}  /* colour 119, closest below 116, closest above 120 */}, // index 118
	{{14, 15, 116, 120} /* colour 118, closest below 115, closest above 120 */, {14, 15, 117, 120}  /* colour 119, closest below 116, closest above 120 */}, // index 119
	{{15, 14, 119, 121} /* colour 120, closest below 118, closest above 121 */, {13, 16, 119, 122}  /* colour 120, closest below 119, closest above 123 */}, // index 120
	{{14, 16, 120, 123} /* colour 121, closest below 120, closest above 123 */, {13, 16, 119, 122}  /* colour 120, closest below 119, closest above 123 */}, // index 121
	{{14, 16, 120, 123} /* colour 121, closest below 120, closest above 123 */, {15, 15, 121, 124}  /* colour 123, closest below 120, closest above 124 */}, // index 122
	{{15, 15, 122, 124} /* colour 123, closest below 121, closest above 124 */, {15, 15, 121, 124}  /* colour 123, closest below 120, closest above 124 */}, // index 123
	{{16, 13, 123, 126} /* colour 124, closest below 123, closest above 126 */, {14, 16, 123, 127}  /* colour 124, closest below 123, closest above 128 */}, // index 124
	{{16, 13, 123, 126} /* colour 124, closest below 123, closest above 126 */, {14, 16, 123, 127}  /* colour 124, closest below 123, closest above 128 */}, // index 125
	{{15, 16, 125, 128} /* colour 126, closest below 124, closest above 129 */, {14, 16, 123, 127}  /* colour 124, closest below 123, closest above 128 */}, // index 126
	{{15, 16, 125, 128} /* colour 126, closest below 124, closest above 129 */, {15, 16, 126, 131}  /* colour 128, closest below 124, closest above 132 */}, // index 127
	{{16, 15, 127, 131} /* colour 129, closest below 126, closest above 131 */, {15, 16, 126, 131}  /* colour 128, closest below 124, closest above 132 */}, // index 128
	{{16, 15, 127, 131} /* colour 129, closest below 126, closest above 131 */, {15, 16, 126, 131}  /* colour 128, closest below 124, closest above 132 */}, // index 129
	{{16, 15, 127, 131} /* colour 129, closest below 126, closest above 131 */, {15, 16, 126, 131}  /* colour 128, closest below 124, closest above 132 */}, // index 130
	{{15, 18, 130, 132} /* colour 131, closest below 129, closest above 132 */, {16, 16, 130, 135}  /* colour 132, closest below 128, closest above 136 */}, // index 131
	{{16, 16, 131, 134} /* colour 132, closest below 131, closest above 134 */, {16, 16, 130, 135}  /* colour 132, closest below 128, closest above 136 */}, // index 132
	{{16, 16, 131, 134} /* colour 132, closest below 131, closest above 134 */, {16, 16, 130, 135}  /* colour 132, closest below 128, closest above 136 */}, // index 133
	{{17, 15, 133, 135} /* colour 134, closest below 132, closest above 135 */, {16, 16, 130, 135}  /* colour 132, closest below 128, closest above 136 */}, // index 134
	{{16, 17, 134, 137} /* colour 135, closest below 134, closest above 137 */, {16, 17, 134, 139}  /* colour 136, closest below 132, closest above 140 */}, // index 135
	{{16, 17, 134, 137} /* colour 135, closest below 134, closest above 137 */, {16, 17, 134, 139}  /* colour 136, closest below 132, closest above 140 */}, // index 136
	{{17, 16, 136, 139} /* colour 137, closest below 135, closest above 140 */, {16, 17, 134, 139}  /* colour 136, closest below 132, closest above 140 */}, // index 137
	{{17, 16, 136, 139} /* colour 137, closest below 135, closest above 140 */, {16, 17, 134, 139}  /* colour 136, closest below 132, closest above 140 */}, // index 138
	{{17, 17, 138, 142} /* colour 140, closest below 137, closest above 142 */, {17, 17, 138, 143}  /* colour 140, closest below 136, closest above 144 */}, // index 139
	{{17, 17, 138, 142} /* colour 140, closest below 137, closest above 142 */, {17, 17, 138, 143}  /* colour 140, closest below 136, closest above 144 */}, // index 140
	{{17, 17, 138, 142} /* colour 140, closest below 137, closest above 142 */, {17, 17, 138, 143}  /* colour 140, closest below 136, closest above 144 */}, // index 141
	{{19, 14, 141, 143} /* colour 142, closest below 140, closest above 143 */, {17, 17, 138, 143}  /* colour 140, closest below 136, closest above 144 */}, // index 142
	{{17, 18, 142, 145} /* colour 143, closest below 142, closest above 145 */, {17, 18, 142, 147}  /* colour 144, closest below 140, closest above 148 */}, // index 143
	{{17, 18, 142, 145} /* colour 143, closest below 142, closest above 145 */, {17, 18, 142, 147}  /* colour 144, closest below 140, closest above 148 */}, // index 144
	{{18, 17, 144, 146} /* colour 145, closest below 143, closest above 146 */, {17, 18, 142, 147}  /* colour 144, closest below 140, closest above 148 */}, // index 145
	{{16, 21, 145, 148} /* colour 146, closest below 145, closest above 148 */, {17, 18, 142, 147}  /* colour 144, closest below 140, closest above 148 */}, // index 146
	{{16, 21, 145, 148} /* colour 146, closest below 145, closest above 148 */, {18, 18, 146, 149}  /* colour 148, closest below 144, closest above 149 */}, // index 147
	{{18, 18, 147, 150} /* colour 148, closest below 146, closest above 151 */, {18, 18, 146, 149}  /* colour 148, closest below 144, closest above 149 */}, // index 148
	{{18, 18, 147, 150} /* colour 148, closest below 146, closest above 151 */, {16, 20, 148, 151}  /* colour 149, closest below 148, closest above 152 */}, // index 149
	{{18, 19, 149, 153} /* colour 151, closest below 148, closest above 153 */, {16, 20, 148, 151}  /* colour 149, closest below 148, closest above 152 */}, // index 150
	{{18, 19, 149, 153} /* colour 151, closest below 148, closest above 153 */, {18, 19, 150, 153}  /* colour 152, closest below 149, closest above 153 */}, // index 151
	{{18, 19, 149, 153} /* colour 151, closest below 148, closest above 153 */, {18, 19, 150, 153}  /* colour 152, closest below 149, closest above 153 */}, // index 152
	{{19, 18, 152, 154} /* colour 153, closest below 151, closest above 154 */, {17, 20, 152, 155}  /* colour 153, closest below 152, closest above 156 */}, // index 153
	{{18, 20, 153, 156} /* colour 154, closest below 153, closest above 156 */, {17, 20, 152, 155}  /* colour 153, closest below 152, closest above 156 */}, // index 154
	{{18, 20, 153, 156} /* colour 154, closest below 153, closest above 156 */, {19, 19, 154, 157}  /* colour 156, closest below 153, closest above 157 */}, // index 155
	{{19, 19, 155, 157} /* colour 156, closest below 154, closest above 157 */, {19, 19, 154, 157}  /* colour 156, closest below 153, closest above 157 */}, // index 156
	{{20, 17, 156, 159} /* colour 157, closest below 156, closest above 159 */, {18, 20, 156, 160}  /* colour 157, closest below 156, closest above 161 */}, // index 157
	{{20, 17, 156, 159} /* colour 157, closest below 156, closest above 159 */, {18, 20, 156, 160}  /* colour 157, closest below 156, closest above 161 */}, // index 158
	{{19, 20, 158, 161} /* colour 159, closest below 157, closest above 162 */, {18, 20, 156, 160}  /* colour 157, closest below 156, closest above 161 */}, // index 159
	{{19, 20, 158, 161} /* colour 159, closest below 157, closest above 162 */, {19, 20, 159, 164}  /* colour 161, closest below 157, closest above 165 */}, // index 160
	{{20, 19, 160, 164} /* colour 162, closest below 159, closest above 164 */, {19, 20, 159, 164}  /* colour 161, closest below 157, closest above 165 */}, // index 161
	{{20, 19, 160, 164} /* colour 162, closest below 159, closest above 164 */, {19, 20, 159, 164}  /* colour 161, closest below 157, closest above 165 */}, // index 162
	{{20, 19, 160, 164} /* colour 162, closest below 159, closest above 164 */, {19, 20, 159, 164}  /* colour 161, closest below 157, closest above 165 */}, // index 163
	{{19, 22, 163, 165} /* colour 164, closest below 162, closest above 165 */, {20, 20, 163, 168}  /* colour 165, closest below 161, closest above 169 */}, // index 164
	{{20, 20, 164, 167} /* colour 165, closest below 164, closest above 167 */, {20, 20, 163, 168}  /* colour 165, closest below 161, closest above 169 */}, // index 165
	{{20, 20, 164, 167} /* colour 165, closest below 164, closest above 167 */, {20, 20, 163, 168}  /* colour 165, closest below 161, closest above 169 */}, // index 166
	{{21, 19, 166, 168} /* colour 167, closest below 165, closest above 168 */, {20, 20, 163, 168}  /* colour 165, closest below 161, closest above 169 */}, // index 167
	{{20, 21, 167, 170} /* colour 168, closest below 167, closest above 170 */, {20, 21, 167, 172}  /* colour 169, closest below 165, closest above 173 */}, // index 168
	{{20, 21, 167, 170} /* colour 168, closest below 167, closest above 170 */, {20, 21, 167, 172}  /* colour 169, closest below 165, closest above 173 */}, // index 169
	{{21, 20, 169, 172} /* colour 170, closest below 168, closest above 173 */, {20, 21, 167, 172}  /* colour 169, closest below 165, closest above 173 */}, // index 170
	{{21, 20, 169, 172} /* colour 170, closest below 168, closest above 173 */, {20, 21, 167, 172}  /* colour 169, closest below 165, closest above 173 */}, // index 171
	{{21, 21, 171, 175} /* colour 173, closest below 170, closest above 175 */, {21, 21, 171, 176}  /* colour 173, closest below 169, closest above 177 */}, // index 172
	{{21, 21, 171, 175} /* colour 173, closest below 170, closest above 175 */, {21, 21, 171, 176}  /* colour 173, closest below 169, closest above 177 */}, // index 173
	{{21, 21, 171, 175} /* colour 173, closest below 170, closest above 175 */, {21, 21, 171, 176}  /* colour 173, closest below 169, closest above 177 */}, // index 174
	{{23, 18, 174, 176} /* colour 175, closest below 173, closest above 176 */, {21, 21, 171, 176}  /* colour 173, closest below 169, closest above 177 */}, // index 175
	{{21, 22, 175, 178} /* colour 176, closest below 175, closest above 178 */, {21, 22, 175, 180}  /* colour 177, closest below 173, closest above 181 */}, // index 176
	{{21, 22, 175, 178} /* colour 176, closest below 175, closest above 178 */, {21, 22, 175, 180}  /* colour 177, closest below 173, closest above 181 */}, // index 177
	{{22, 21, 177, 179} /* colour 178, closest below 176, closest above 179 */, {21, 22, 175, 180}  /* colour 177, closest below 173, closest above 181 */}, // index 178
	{{20, 25, 178, 181} /* colour 179, closest below 178, closest above 181 */, {21, 22, 175, 180}  /* colour 177, closest below 173, closest above 181 */}, // index 179
	{{20, 25, 178, 181} /* colour 179, closest below 178, closest above 181 */, {22, 22, 179, 182}  /* colour 181, closest below 177, closest above 182 */}, // index 180
	{{22, 22, 180, 183} /* colour 181, closest below 179, closest above 184 */, {22, 22, 179, 182}  /* colour 181, closest below 177, closest above 182 */}, // index 181
	{{22, 22, 180, 183} /* colour 181, closest below 179, closest above 184 */, {20, 24, 181, 184}  /* colour 182, closest below 181, closest above 185 */}, // index 182
	{{22, 23, 182, 186} /* colour 184, closest below 181, closest above 186 */, {20, 24, 181, 184}  /* colour 182, closest below 181, closest above 185 */}, // index 183
	{{22, 23, 182, 186} /* colour 184, closest below 181, closest above 186 */, {22, 23, 183, 186}  /* colour 185, closest below 182, closest above 186 */}, // index 184
	{{22, 23, 182, 186} /* colour 184, closest below 181, closest above 186 */, {22, 23, 183, 186}  /* colour 185, closest below 182, closest above 186 */}, // index 185
	{{23, 22, 185, 187} /* colour 186, closest below 184, closest above 187 */, {21, 24, 185, 188}  /* colour 186, closest below 185, closest above 189 */}, // index 186
	{{22, 24, 186, 189} /* colour 187, closest below 186, closest above 189 */, {21, 24, 185, 188}  /* colour 186, closest below 185, closest above 189 */}, // index 187
	{{22, 24, 186, 189} /* colour 187, closest below 186, closest above 189 */, {23, 23, 187, 190}  /* colour 189, closest below 186, closest above 190 */}, // index 188
	{{23, 23, 188, 190} /* colour 189, closest below 187, closest above 190 */, {23, 23, 187, 190}  /* colour 189, closest below 186, closest above 190 */}, // index 189
	{{24, 21, 189, 192} /* colour 190, closest below 189, closest above 192 */, {22, 24, 189, 193}  /* colour 190, closest below 189, closest above 194 */}, // index 190
	{{24, 21, 189, 192} /* colour 190, closest below 189, closest above 192 */, {22, 24, 189, 193}  /* colour 190, closest below 189, closest above 194 */}, // index 191
	{{23, 24, 191, 194} /* colour 192, closest below 190, closest above 195 */, {22, 24, 189, 193}  /* colour 190, closest below 189, closest above 194 */}, // index 192
	{{23, 24, 191, 194} /* colour 192, closest below 190, closest above 195 */, {23, 24, 192, 197}  /* colour 194, closest below 190, closest above 198 */}, // index 193
	{{24, 23, 193, 197} /* colour 195, closest below 192, closest above 197 */, {23, 24, 192, 197}  /* colour 194, closest below 190, closest above 198 */}, // index 194
	{{24, 23, 193, 197} /* colour 195, closest below 192, closest above 197 */, {23, 24, 192, 197}  /* colour 194, closest below 190, closest above 198 */}, // index 195
	{{24, 23, 193, 197} /* colour 195, closest below 192, closest above 197 */, {23, 24, 192, 197}  /* colour 194, closest below 190, closest above 198 */}, // index 196
	{{23, 26, 196, 198} /* colour 197, closest below 195, closest above 198 */, {24, 24, 196, 201}  /* colour 198, closest below 194, closest above 202 */}, // index 197
	{{24, 24, 197, 200} /* colour 198, closest below 197, closest above 200 */, {24, 24, 196, 201}  /* colour 198, closest below 194, closest above 202 */}, // index 198
	{{24, 24, 197, 200} /* colour 198, closest below 197, closest above 200 */, {24, 24, 196, 201}  /* colour 198, closest below 194, closest above 202 */}, // index 199
	{{25, 23, 199, 201} /* colour 200, closest below 198, closest above 201 */, {24, 24, 196, 201}  /* colour 198, closest below 194, closest above 202 */}, // index 200
	{{24, 25, 200, 203} /* colour 201, closest below 200, closest above 203 */, {24, 25, 200, 205}  /* colour 202, closest below 198, closest above 206 */}, // index 201
	{{24, 25, 200, 203} /* colour 201, closest below 200, closest above 203 */, {24, 25, 200, 205}  /* colour 202, closest below 198, closest above 206 */}, // index 202
	{{25, 24, 202, 205} /* colour 203, closest below 201, closest above 206 */, {24, 25, 200, 205}  /* colour 202, closest below 198, closest above 206 */}, // index 203
	{{25, 24, 202, 205} /* colour 203, closest below 201, closest above 206 */, {24, 25, 200, 205}  /* colour 202, closest below 198, closest above 206 */}, // index 204
	{{25, 25, 204, 208} /* colour 206, closest below 203, closest above 208 */, {25, 25, 204, 209}  /* colour 206, closest below 202, closest above 210 */}, // index 205
	{{25, 25, 204, 208} /* colour 206, closest below 203, closest above 208 */, {25, 25, 204, 209}  /* colour 206, closest below 202, closest above 210 */}, // index 206
	{{25, 25, 204, 208} /* colour 206, closest below 203, closest above 208 */, {25, 25, 204, 209}  /* colour 206, closest below 202, closest above 210 */}, // index 207
	{{27, 22, 207, 209} /* colour 208, closest below 206, closest above 209 */, {25, 25, 204, 209}  /* colour 206, closest below 202, closest above 210 */}, // index 208
	{{25, 26, 208, 211} /* colour 209, closest below 208, closest above 211 */, {25, 26, 208, 213}  /* colour 210, closest below 206, closest above 214 */}, // index 209
	{{25, 26, 208, 211} /* colour 209, closest below 208, closest above 211 */, {25, 26, 208, 213}  /* colour 210, closest below 206, closest above 214 */}, // index 210
	{{26, 25, 210, 212} /* colour 211, closest below 209, closest above 212 */, {25, 26, 208, 213}  /* colour 210, closest below 206, closest above 214 */}, // index 211
	{{24, 29, 211, 214} /* colour 212, closest below 211, closest above 214 */, {25, 26, 208, 213}  /* colour 210, closest below 206, closest above 214 */}, // index 212
	{{24, 29, 211, 214} /* colour 212, closest below 211, closest above 214 */, {26, 26, 212, 215}  /* colour 214, closest below 210, closest above 215 */}, // index 213
	{{26, 26, 213, 216} /* colour 214, closest below 212, closest above 217 */, {26, 26, 212, 215}  /* colour 214, closest below 210, closest above 215 */}, // index 214
	{{26, 26, 213, 216} /* colour 214, closest below 212, closest above 217 */, {24, 28, 214, 217}  /* colour 215, closest below 214, closest above 218 */}, // index 215
	{{26, 27, 215, 219} /* colour 217, closest below 214, closest above 219 */, {24, 28, 214, 217}  /* colour 215, closest below 214, closest above 218 */}, // index 216
	{{26, 27, 215, 219} /* colour 217, closest below 214, closest above 219 */, {26, 27, 216, 219}  /* colour 218, closest below 215, closest above 219 */}, // index 217
	{{26, 27, 215, 219} /* colour 217, closest below 214, closest above 219 */, {26, 27, 216, 219}  /* colour 218, closest below 215, closest above 219 */}, // index 218
	{{27, 26, 218, 220} /* colour 219, closest below 217, closest above 220 */, {25, 28, 218, 221}  /* colour 219, closest below 218, closest above 222 */}, // index 219
	{{26, 28, 219, 222} /* colour 220, closest below 219, closest above 222 */, {25, 28, 218, 221}  /* colour 219, closest below 218, closest above 222 */}, // index 220
	{{26, 28, 219, 222} /* colour 220, closest below 219, closest above 222 */, {27, 27, 220, 223}  /* colour 222, closest below 219, closest above 223 */}, // index 221
	{{27, 27, 221, 223} /* colour 222, closest below 220, closest above 223 */, {27, 27, 220, 223}  /* colour 222, closest below 219, closest above 223 */}, // index 222
	{{28, 25, 222, 225} /* colour 223, closest below 222, closest above 225 */, {26, 28, 222, 226}  /* colour 223, closest below 222, closest above 227 */}, // index 223
	{{28, 25, 222, 225} /* colour 223, closest below 222, closest above 225 */, {26, 28, 222, 226}  /* colour 223, closest below 222, closest above 227 */}, // index 224
	{{27, 28, 224, 227} /* colour 225, closest below 223, closest above 228 */, {26, 28, 222, 226}  /* colour 223, closest below 222, closest above 227 */}, // index 225
	{{27, 28, 224, 227} /* colour 225, closest below 223, closest above 228 */, {27, 28, 225, 230}  /* colour 227, closest below 223, closest above 231 */}, // index 226
	{{28, 27, 226, 230} /* colour 228, closest below 225, closest above 230 */, {27, 28, 225, 230}  /* colour 227, closest below 223, closest above 231 */}, // index 227
	{{28, 27, 226, 230} /* colour 228, closest below 225, closest above 230 */, {27, 28, 225, 230}  /* colour 227, closest below 223, closest above 231 */}, // index 228
	{{28, 27, 226, 230} /* colour 228, closest below 225, closest above 230 */, {27, 28, 225, 230}  /* colour 227, closest below 223, closest above 231 */}, // index 229
	{{27, 30, 229, 231} /* colour 230, closest below 228, closest above 231 */, {28, 28, 229, 234}  /* colour 231, closest below 227, closest above 235 */}, // index 230
	{{28, 28, 230, 233} /* colour 231, closest below 230, closest above 233 */, {28, 28, 229, 234}  /* colour 231, closest below 227, closest above 235 */}, // index 231
	{{28, 28, 230, 233} /* colour 231, closest below 230, closest above 233 */, {28, 28, 229, 234}  /* colour 231, closest below 227, closest above 235 */}, // index 232
	{{29, 27, 232, 234} /* colour 233, closest below 231, closest above 234 */, {28, 28, 229, 234}  /* colour 231, closest below 227, closest above 235 */}, // index 233
	{{28, 29, 233, 236} /* colour 234, closest below 233, closest above 236 */, {28, 29, 233, 238}  /* colour 235, closest below 231, closest above 239 */}, // index 234
	{{28, 29, 233, 236} /* colour 234, closest below 233, closest above 236 */, {28, 29, 233, 238}  /* colour 235, closest below 231, closest above 239 */}, // index 235
	{{29, 28, 235, 238} /* colour 236, closest below 234, closest above 239 */, {28, 29, 233, 238}  /* colour 235, closest below 231, closest above 239 */}, // index 236
	{{29, 28, 235, 238} /* colour 236, closest below 234, closest above 239 */, {28, 29, 233, 238}  /* colour 235, closest below 231, closest above 239 */}, // index 237
	{{29, 29, 237, 241} /* colour 239, closest below 236, closest above 241 */, {29, 29, 237, 242}  /* colour 239, closest below 235, closest above 243 */}, // index 238
	{{29, 29, 237, 241} /* colour 239, closest below 236, closest above 241 */, {29, 29, 237, 242}  /* colour 239, closest below 235, closest above 243 */}, // index 239
	{{29, 29, 237, 241} /* colour 239, closest below 236, closest above 241 */, {29, 29, 237, 242}  /* colour 239, closest below 235, closest above 243 */}, // index 240
	{{31, 26, 240, 242} /* colour 241, closest below 239, closest above 242 */, {29, 29, 237, 242}  /* colour 239, closest below 235, closest above 243 */}, // index 241
	{{29, 30, 241, 244} /* colour 242, closest below 241, closest above 244 */, {29, 30, 241, 246}  /* colour 243, closest below 239, closest above 247 */}, // index 242
	{{29, 30, 241, 244} /* colour 242, closest below 241, closest above 244 */, {29, 30, 241, 246}  /* colour 243, closest below 239, closest above 247 */}, // index 243
	{{30, 29, 243, 246} /* colour 244, closest below 242, closest above 247 */, {29, 30, 241, 246}  /* colour 243, closest below 239, closest above 247 */}, // index 244
	{{30, 29, 243, 246} /* colour 244, closest below 242, closest above 247 */, {29, 30, 241, 246}  /* colour 243, closest below 239, closest above 247 */}, // index 245
	{{30, 30, 245, 249} /* colour 247, closest below 244, closest above 250 */, {30, 30, 245, 250}  /* colour 247, closest below 243, closest above 251 */}, // index 246
	{{30, 30, 245, 249} /* colour 247, closest below 244, closest above 250 */, {30, 30, 245, 250}  /* colour 247, closest below 243, closest above 251 */}, // index 247
	{{30, 30, 245, 249} /* colour 247, closest below 244, closest above 250 */, {30, 30, 245, 250}  /* colour 247, closest below 243, closest above 251 */}, // index 248
	{{30, 31, 248, 252} /* colour 250, closest below 247, closest above 252 */, {30, 30, 245, 250}  /* colour 247, closest below 243, closest above 251 */}, // index 249
	{{30, 31, 248, 252} /* colour 250, closest below 247, closest above 252 */, {30, 31, 249, 254}  /* colour 251, closest below 247, closest above 255 */}, // index 250
	{{30, 31, 248, 252} /* colour 250, closest below 247, closest above 252 */, {30, 31, 249, 254}  /* colour 251, closest below 247, closest above 255 */}, // index 251
	{{31, 30, 251, 254} /* colour 252, closest below 250, closest above 255 */, {30, 31, 249, 254}  /* colour 251, closest below 247, closest above 255 */}, // index 252
	{{31, 30, 251, 254} /* colour 252, closest below 250, closest above 255 */, {30, 31, 249, 254}  /* colour 251, closest below 247, closest above 255 */}, // index 253
	{{31, 31, 253, 254} /* colour 255, closest below 252, closest above 255 */, {31, 31, 253, 254}  /* colour 255, closest below 251, closest above 255 */}, // index 254
	{{31, 31, 253, 255} /* colour 255, closest below 252, closest above 255 */, {31, 31, 253, 255}  /* colour 255, closest below 251, closest above 255 */}  // index 255
};
// endpoint pairs to colour map assuming index 2. For index 3, flip order of the endpoints.
// entry 0 is endpoint 0.
// entry 1 is endpoint 1.
// entry 2 is the index of the next closest colour < the current colour. If there is no colour < the current colour, this will equal the current index.
// entry 3 is the index of the next closest colour > the current colour. If there is no colour > the current colour, this will equal the current index.
static int g_dds_bestfitmap6[256][2][4] =
{
	{{ 0,  0,   0,   1} /* colour   0, closest below   0, closest above   1 */, { 0,  0,   0,   2}  /* colour   0, closest below   0, closest above   2 */}, // index   0
	{{ 0,  1,   0,   3} /* colour   1, closest below   0, closest above   3 */, { 0,  0,   1,   2}  /* colour   0, closest below   0, closest above   2 */}, // index   1
	{{ 0,  1,   0,   3} /* colour   1, closest below   0, closest above   3 */, { 0,  1,   1,   4}  /* colour   2, closest below   0, closest above   4 */}, // index   2
	{{ 1,  0,   2,   4} /* colour   3, closest below   1, closest above   4 */, { 0,  1,   1,   4}  /* colour   2, closest below   0, closest above   4 */}, // index   3
	{{ 1,  1,   3,   5} /* colour   4, closest below   3, closest above   5 */, { 1,  1,   3,   6}  /* colour   4, closest below   2, closest above   6 */}, // index   4
	{{ 1,  2,   4,   7} /* colour   5, closest below   4, closest above   7 */, { 1,  1,   3,   6}  /* colour   4, closest below   2, closest above   6 */}, // index   5
	{{ 1,  2,   4,   7} /* colour   5, closest below   4, closest above   7 */, { 1,  2,   5,   8}  /* colour   6, closest below   4, closest above   8 */}, // index   6
	{{ 2,  1,   6,   8} /* colour   7, closest below   5, closest above   8 */, { 1,  2,   5,   8}  /* colour   6, closest below   4, closest above   8 */}, // index   7
	{{ 2,  2,   7,   9} /* colour   8, closest below   7, closest above   9 */, { 2,  2,   7,  10}  /* colour   8, closest below   6, closest above  10 */}, // index   8
	{{ 2,  3,   8,  11} /* colour   9, closest below   8, closest above  11 */, { 2,  2,   7,  10}  /* colour   8, closest below   6, closest above  10 */}, // index   9
	{{ 2,  3,   8,  11} /* colour   9, closest below   8, closest above  11 */, { 2,  3,   9,  12}  /* colour  10, closest below   8, closest above  12 */}, // index  10
	{{ 3,  2,  10,  12} /* colour  11, closest below   9, closest above  12 */, { 2,  3,   9,  12}  /* colour  10, closest below   8, closest above  12 */}, // index  11
	{{ 3,  3,  11,  13} /* colour  12, closest below  11, closest above  13 */, { 3,  3,  11,  14}  /* colour  12, closest below  10, closest above  14 */}, // index  12
	{{ 3,  4,  12,  15} /* colour  13, closest below  12, closest above  15 */, { 3,  3,  11,  14}  /* colour  12, closest below  10, closest above  14 */}, // index  13
	{{ 3,  4,  12,  15} /* colour  13, closest below  12, closest above  15 */, { 3,  4,  13,  16}  /* colour  14, closest below  12, closest above  16 */}, // index  14
	{{ 4,  3,  14,  16} /* colour  15, closest below  13, closest above  16 */, { 3,  4,  13,  16}  /* colour  14, closest below  12, closest above  16 */}, // index  15
	{{ 4,  4,  15,  17} /* colour  16, closest below  15, closest above  17 */, { 4,  4,  15,  18}  /* colour  16, closest below  14, closest above  18 */}, // index  16
	{{ 4,  5,  16,  19} /* colour  17, closest below  16, closest above  19 */, { 4,  4,  15,  18}  /* colour  16, closest below  14, closest above  18 */}, // index  17
	{{ 4,  5,  16,  19} /* colour  17, closest below  16, closest above  19 */, { 4,  5,  17,  20}  /* colour  18, closest below  16, closest above  20 */}, // index  18
	{{ 5,  4,  18,  20} /* colour  19, closest below  17, closest above  20 */, { 4,  5,  17,  20}  /* colour  18, closest below  16, closest above  20 */}, // index  19
	{{ 5,  5,  19,  21} /* colour  20, closest below  19, closest above  21 */, { 5,  5,  19,  22}  /* colour  20, closest below  18, closest above  22 */}, // index  20
	{{ 5,  6,  20,  22} /* colour  21, closest below  20, closest above  22 */, { 5,  5,  19,  22}  /* colour  20, closest below  18, closest above  22 */}, // index  21
	{{ 0, 16,  21,  23} /* colour  22, closest below  21, closest above  23 */, { 5,  6,  21,  24}  /* colour  22, closest below  20, closest above  24 */}, // index  22
	{{ 6,  5,  22,  24} /* colour  23, closest below  22, closest above  24 */, { 5,  6,  21,  24}  /* colour  22, closest below  20, closest above  24 */}, // index  23
	{{ 6,  6,  23,  25} /* colour  24, closest below  23, closest above  25 */, { 6,  6,  23,  26}  /* colour  24, closest below  22, closest above  26 */}, // index  24
	{{ 6,  7,  24,  26} /* colour  25, closest below  24, closest above  26 */, { 6,  6,  23,  26}  /* colour  24, closest below  22, closest above  26 */}, // index  25
	{{ 1, 17,  25,  27} /* colour  26, closest below  25, closest above  27 */, { 6,  7,  25,  28}  /* colour  26, closest below  24, closest above  28 */}, // index  26
	{{ 7,  6,  26,  28} /* colour  27, closest below  26, closest above  28 */, { 6,  7,  25,  28}  /* colour  26, closest below  24, closest above  28 */}, // index  27
	{{ 7,  7,  27,  29} /* colour  28, closest below  27, closest above  29 */, { 7,  7,  27,  30}  /* colour  28, closest below  26, closest above  30 */}, // index  28
	{{ 7,  8,  28,  30} /* colour  29, closest below  28, closest above  30 */, { 7,  7,  27,  30}  /* colour  28, closest below  26, closest above  30 */}, // index  29
	{{ 3, 16,  29,  31} /* colour  30, closest below  29, closest above  31 */, { 7,  8,  29,  32}  /* colour  30, closest below  28, closest above  32 */}, // index  30
	{{ 8,  7,  30,  32} /* colour  31, closest below  30, closest above  32 */, { 7,  8,  29,  32}  /* colour  30, closest below  28, closest above  32 */}, // index  31
	{{ 8,  8,  31,  33} /* colour  32, closest below  31, closest above  33 */, { 8,  8,  31,  33}  /* colour  32, closest below  30, closest above  33 */}, // index  32
	{{ 8,  9,  32,  34} /* colour  33, closest below  32, closest above  34 */, { 0, 16,  32,  34}  /* colour  33, closest below  32, closest above  34 */}, // index  33
	{{ 4, 17,  33,  35} /* colour  34, closest below  33, closest above  35 */, { 8,  9,  33,  35}  /* colour  34, closest below  33, closest above  35 */}, // index  34
	{{ 9,  8,  34,  36} /* colour  35, closest below  34, closest above  36 */, { 1, 16,  34,  36}  /* colour  35, closest below  34, closest above  36 */}, // index  35
	{{ 9,  9,  35,  37} /* colour  36, closest below  35, closest above  37 */, { 9,  9,  35,  37}  /* colour  36, closest below  35, closest above  37 */}, // index  36
	{{ 9, 10,  36,  38} /* colour  37, closest below  36, closest above  38 */, { 2, 16,  36,  38}  /* colour  37, closest below  36, closest above  38 */}, // index  37
	{{ 6, 16,  37,  39} /* colour  38, closest below  37, closest above  39 */, { 9, 10,  37,  39}  /* colour  38, closest below  37, closest above  39 */}, // index  38
	{{10,  9,  38,  40} /* colour  39, closest below  38, closest above  40 */, { 3, 16,  38,  40}  /* colour  39, closest below  38, closest above  40 */}, // index  39
	{{10, 10,  39,  41} /* colour  40, closest below  39, closest above  41 */, {10, 10,  39,  41}  /* colour  40, closest below  39, closest above  41 */}, // index  40
	{{10, 11,  40,  42} /* colour  41, closest below  40, closest above  42 */, { 4, 16,  40,  42}  /* colour  41, closest below  40, closest above  42 */}, // index  41
	{{ 7, 17,  41,  43} /* colour  42, closest below  41, closest above  43 */, {10, 11,  41,  43}  /* colour  42, closest below  41, closest above  43 */}, // index  42
	{{11, 10,  42,  44} /* colour  43, closest below  42, closest above  44 */, { 5, 16,  42,  44}  /* colour  43, closest below  42, closest above  44 */}, // index  43
	{{11, 11,  43,  45} /* colour  44, closest below  43, closest above  45 */, {11, 11,  43,  45}  /* colour  44, closest below  43, closest above  45 */}, // index  44
	{{11, 12,  44,  46} /* colour  45, closest below  44, closest above  46 */, { 6, 16,  44,  46}  /* colour  45, closest below  44, closest above  46 */}, // index  45
	{{ 9, 16,  45,  47} /* colour  46, closest below  45, closest above  47 */, {11, 12,  45,  47}  /* colour  46, closest below  45, closest above  47 */}, // index  46
	{{12, 11,  46,  48} /* colour  47, closest below  46, closest above  48 */, { 7, 16,  46,  48}  /* colour  47, closest below  46, closest above  48 */}, // index  47
	{{12, 12,  47,  49} /* colour  48, closest below  47, closest above  49 */, {12, 12,  47,  49}  /* colour  48, closest below  47, closest above  49 */}, // index  48
	{{12, 13,  48,  50} /* colour  49, closest below  48, closest above  50 */, { 8, 16,  48,  50}  /* colour  49, closest below  48, closest above  50 */}, // index  49
	{{10, 17,  49,  51} /* colour  50, closest below  49, closest above  51 */, {12, 13,  49,  51}  /* colour  50, closest below  49, closest above  51 */}, // index  50
	{{13, 12,  50,  52} /* colour  51, closest below  50, closest above  52 */, { 9, 16,  50,  52}  /* colour  51, closest below  50, closest above  52 */}, // index  51
	{{13, 13,  51,  53} /* colour  52, closest below  51, closest above  53 */, {13, 13,  51,  53}  /* colour  52, closest below  51, closest above  53 */}, // index  52
	{{13, 14,  52,  54} /* colour  53, closest below  52, closest above  54 */, {10, 16,  52,  54}  /* colour  53, closest below  52, closest above  54 */}, // index  53
	{{12, 16,  53,  55} /* colour  54, closest below  53, closest above  55 */, {13, 14,  53,  55}  /* colour  54, closest below  53, closest above  55 */}, // index  54
	{{14, 13,  54,  56} /* colour  55, closest below  54, closest above  56 */, {11, 16,  54,  56}  /* colour  55, closest below  54, closest above  56 */}, // index  55
	{{14, 14,  55,  57} /* colour  56, closest below  55, closest above  57 */, {14, 14,  55,  57}  /* colour  56, closest below  55, closest above  57 */}, // index  56
	{{14, 15,  56,  58} /* colour  57, closest below  56, closest above  58 */, {12, 16,  56,  58}  /* colour  57, closest below  56, closest above  58 */}, // index  57
	{{13, 17,  57,  59} /* colour  58, closest below  57, closest above  59 */, {14, 15,  57,  59}  /* colour  58, closest below  57, closest above  59 */}, // index  58
	{{15, 14,  58,  60} /* colour  59, closest below  58, closest above  60 */, {13, 16,  58,  60}  /* colour  59, closest below  58, closest above  60 */}, // index  59
	{{15, 15,  59,  61} /* colour  60, closest below  59, closest above  61 */, {15, 15,  59,  61}  /* colour  60, closest below  59, closest above  61 */}, // index  60
	{{16, 13,  60,  62} /* colour  61, closest below  60, closest above  62 */, {14, 16,  60,  63}  /* colour  61, closest below  60, closest above  63 */}, // index  61
	{{15, 16,  61,  63} /* colour  62, closest below  61, closest above  63 */, {14, 16,  60,  63}  /* colour  61, closest below  60, closest above  63 */}, // index  62
	{{16, 15,  62,  64} /* colour  63, closest below  62, closest above  64 */, {15, 16,  62,  65}  /* colour  63, closest below  61, closest above  65 */}, // index  63
	{{15, 18,  63,  65} /* colour  64, closest below  63, closest above  65 */, {15, 16,  62,  65}  /* colour  63, closest below  61, closest above  65 */}, // index  64
	{{16, 16,  64,  66} /* colour  65, closest below  64, closest above  66 */, {16, 16,  64,  67}  /* colour  65, closest below  63, closest above  67 */}, // index  65
	{{16, 17,  65,  67} /* colour  66, closest below  65, closest above  67 */, {16, 16,  64,  67}  /* colour  65, closest below  63, closest above  67 */}, // index  66
	{{18, 14,  66,  68} /* colour  67, closest below  66, closest above  68 */, {16, 17,  66,  69}  /* colour  67, closest below  65, closest above  69 */}, // index  67
	{{17, 16,  67,  69} /* colour  68, closest below  67, closest above  69 */, {16, 17,  66,  69}  /* colour  67, closest below  65, closest above  69 */}, // index  68
	{{17, 17,  68,  70} /* colour  69, closest below  68, closest above  70 */, {17, 17,  68,  71}  /* colour  69, closest below  67, closest above  71 */}, // index  69
	{{17, 18,  69,  71} /* colour  70, closest below  69, closest above  71 */, {17, 17,  68,  71}  /* colour  69, closest below  67, closest above  71 */}, // index  70
	{{19, 15,  70,  72} /* colour  71, closest below  70, closest above  72 */, {17, 18,  70,  73}  /* colour  71, closest below  69, closest above  73 */}, // index  71
	{{18, 17,  71,  73} /* colour  72, closest below  71, closest above  73 */, {17, 18,  70,  73}  /* colour  71, closest below  69, closest above  73 */}, // index  72
	{{18, 18,  72,  74} /* colour  73, closest below  72, closest above  74 */, {18, 18,  72,  75}  /* colour  73, closest below  71, closest above  75 */}, // index  73
	{{18, 19,  73,  75} /* colour  74, closest below  73, closest above  75 */, {18, 18,  72,  75}  /* colour  73, closest below  71, closest above  75 */}, // index  74
	{{21, 14,  74,  76} /* colour  75, closest below  74, closest above  76 */, {18, 19,  74,  77}  /* colour  75, closest below  73, closest above  77 */}, // index  75
	{{19, 18,  75,  77} /* colour  76, closest below  75, closest above  77 */, {18, 19,  74,  77}  /* colour  75, closest below  73, closest above  77 */}, // index  76
	{{19, 19,  76,  78} /* colour  77, closest below  76, closest above  78 */, {19, 19,  76,  79}  /* colour  77, closest below  75, closest above  79 */}, // index  77
	{{19, 20,  77,  79} /* colour  78, closest below  77, closest above  79 */, {19, 19,  76,  79}  /* colour  77, closest below  75, closest above  79 */}, // index  78
	{{22, 15,  78,  80} /* colour  79, closest below  78, closest above  80 */, {19, 20,  78,  81}  /* colour  79, closest below  77, closest above  81 */}, // index  79
	{{20, 19,  79,  81} /* colour  80, closest below  79, closest above  81 */, {19, 20,  78,  81}  /* colour  79, closest below  77, closest above  81 */}, // index  80
	{{20, 20,  80,  82} /* colour  81, closest below  80, closest above  82 */, {20, 20,  80,  83}  /* colour  81, closest below  79, closest above  83 */}, // index  81
	{{20, 21,  81,  83} /* colour  82, closest below  81, closest above  83 */, {20, 20,  80,  83}  /* colour  81, closest below  79, closest above  83 */}, // index  82
	{{24, 14,  82,  84} /* colour  83, closest below  82, closest above  84 */, {20, 21,  82,  85}  /* colour  83, closest below  81, closest above  85 */}, // index  83
	{{21, 20,  83,  85} /* colour  84, closest below  83, closest above  85 */, {20, 21,  82,  85}  /* colour  83, closest below  81, closest above  85 */}, // index  84
	{{21, 21,  84,  86} /* colour  85, closest below  84, closest above  86 */, {21, 21,  84,  87}  /* colour  85, closest below  83, closest above  87 */}, // index  85
	{{21, 22,  85,  87} /* colour  86, closest below  85, closest above  87 */, {21, 21,  84,  87}  /* colour  85, closest below  83, closest above  87 */}, // index  86
	{{25, 15,  86,  88} /* colour  87, closest below  86, closest above  88 */, {21, 22,  86,  89}  /* colour  87, closest below  85, closest above  89 */}, // index  87
	{{22, 21,  87,  89} /* colour  88, closest below  87, closest above  89 */, {21, 22,  86,  89}  /* colour  87, closest below  85, closest above  89 */}, // index  88
	{{22, 22,  88,  90} /* colour  89, closest below  88, closest above  90 */, {22, 22,  88,  91}  /* colour  89, closest below  87, closest above  91 */}, // index  89
	{{22, 23,  89,  91} /* colour  90, closest below  89, closest above  91 */, {22, 22,  88,  91}  /* colour  89, closest below  87, closest above  91 */}, // index  90
	{{27, 14,  90,  92} /* colour  91, closest below  90, closest above  92 */, {22, 23,  90,  93}  /* colour  91, closest below  89, closest above  93 */}, // index  91
	{{23, 22,  91,  93} /* colour  92, closest below  91, closest above  93 */, {22, 23,  90,  93}  /* colour  91, closest below  89, closest above  93 */}, // index  92
	{{23, 23,  92,  94} /* colour  93, closest below  92, closest above  94 */, {23, 23,  92,  95}  /* colour  93, closest below  91, closest above  95 */}, // index  93
	{{23, 24,  93,  95} /* colour  94, closest below  93, closest above  95 */, {23, 23,  92,  95}  /* colour  93, closest below  91, closest above  95 */}, // index  94
	{{19, 32,  94,  96} /* colour  95, closest below  94, closest above  96 */, {23, 24,  94,  97}  /* colour  95, closest below  93, closest above  97 */}, // index  95
	{{24, 23,  95,  97} /* colour  96, closest below  95, closest above  97 */, {23, 24,  94,  97}  /* colour  95, closest below  93, closest above  97 */}, // index  96
	{{24, 24,  96,  98} /* colour  97, closest below  96, closest above  98 */, {24, 24,  96,  98}  /* colour  97, closest below  95, closest above  98 */}, // index  97
	{{24, 25,  97,  99} /* colour  98, closest below  97, closest above  99 */, {16, 32,  97,  99}  /* colour  98, closest below  97, closest above  99 */}, // index  98
	{{20, 33,  98, 100} /* colour  99, closest below  98, closest above 100 */, {24, 25,  98, 100}  /* colour  99, closest below  98, closest above 100 */}, // index  99
	{{25, 24,  99, 101} /* colour 100, closest below  99, closest above 101 */, {17, 32,  99, 101}  /* colour 100, closest below  99, closest above 101 */}, // index 100
	{{25, 25, 100, 102} /* colour 101, closest below 100, closest above 102 */, {25, 25, 100, 102}  /* colour 101, closest below 100, closest above 102 */}, // index 101
	{{25, 26, 101, 103} /* colour 102, closest below 101, closest above 103 */, {18, 32, 101, 103}  /* colour 102, closest below 101, closest above 103 */}, // index 102
	{{22, 32, 102, 104} /* colour 103, closest below 102, closest above 104 */, {25, 26, 102, 104}  /* colour 103, closest below 102, closest above 104 */}, // index 103
	{{26, 25, 103, 105} /* colour 104, closest below 103, closest above 105 */, {19, 32, 103, 105}  /* colour 104, closest below 103, closest above 105 */}, // index 104
	{{26, 26, 104, 106} /* colour 105, closest below 104, closest above 106 */, {26, 26, 104, 106}  /* colour 105, closest below 104, closest above 106 */}, // index 105
	{{26, 27, 105, 107} /* colour 106, closest below 105, closest above 107 */, {20, 32, 105, 107}  /* colour 106, closest below 105, closest above 107 */}, // index 106
	{{23, 33, 106, 108} /* colour 107, closest below 106, closest above 108 */, {26, 27, 106, 108}  /* colour 107, closest below 106, closest above 108 */}, // index 107
	{{27, 26, 107, 109} /* colour 108, closest below 107, closest above 109 */, {21, 32, 107, 109}  /* colour 108, closest below 107, closest above 109 */}, // index 108
	{{27, 27, 108, 110} /* colour 109, closest below 108, closest above 110 */, {27, 27, 108, 110}  /* colour 109, closest below 108, closest above 110 */}, // index 109
	{{27, 28, 109, 111} /* colour 110, closest below 109, closest above 111 */, {22, 32, 109, 111}  /* colour 110, closest below 109, closest above 111 */}, // index 110
	{{25, 32, 110, 112} /* colour 111, closest below 110, closest above 112 */, {27, 28, 110, 112}  /* colour 111, closest below 110, closest above 112 */}, // index 111
	{{28, 27, 111, 113} /* colour 112, closest below 111, closest above 113 */, {23, 32, 111, 113}  /* colour 112, closest below 111, closest above 113 */}, // index 112
	{{28, 28, 112, 114} /* colour 113, closest below 112, closest above 114 */, {28, 28, 112, 114}  /* colour 113, closest below 112, closest above 114 */}, // index 113
	{{28, 29, 113, 115} /* colour 114, closest below 113, closest above 115 */, {24, 32, 113, 115}  /* colour 114, closest below 113, closest above 115 */}, // index 114
	{{26, 33, 114, 116} /* colour 115, closest below 114, closest above 116 */, {28, 29, 114, 116}  /* colour 115, closest below 114, closest above 116 */}, // index 115
	{{29, 28, 115, 117} /* colour 116, closest below 115, closest above 117 */, {25, 32, 115, 117}  /* colour 116, closest below 115, closest above 117 */}, // index 116
	{{29, 29, 116, 118} /* colour 117, closest below 116, closest above 118 */, {29, 29, 116, 118}  /* colour 117, closest below 116, closest above 118 */}, // index 117
	{{29, 30, 117, 119} /* colour 118, closest below 117, closest above 119 */, {26, 32, 117, 119}  /* colour 118, closest below 117, closest above 119 */}, // index 118
	{{28, 32, 118, 120} /* colour 119, closest below 118, closest above 120 */, {29, 30, 118, 120}  /* colour 119, closest below 118, closest above 120 */}, // index 119
	{{30, 29, 119, 121} /* colour 120, closest below 119, closest above 121 */, {27, 32, 119, 121}  /* colour 120, closest below 119, closest above 121 */}, // index 120
	{{30, 30, 120, 122} /* colour 121, closest below 120, closest above 122 */, {30, 30, 120, 122}  /* colour 121, closest below 120, closest above 122 */}, // index 121
	{{30, 31, 121, 123} /* colour 122, closest below 121, closest above 123 */, {28, 32, 121, 123}  /* colour 122, closest below 121, closest above 123 */}, // index 122
	{{29, 33, 122, 124} /* colour 123, closest below 122, closest above 124 */, {30, 31, 122, 124}  /* colour 123, closest below 122, closest above 124 */}, // index 123
	{{31, 30, 123, 125} /* colour 124, closest below 123, closest above 125 */, {29, 32, 123, 125}  /* colour 124, closest below 123, closest above 125 */}, // index 124
	{{31, 31, 124, 126} /* colour 125, closest below 124, closest above 126 */, {31, 31, 124, 126}  /* colour 125, closest below 124, closest above 126 */}, // index 125
	{{32, 29, 125, 127} /* colour 126, closest below 125, closest above 127 */, {30, 32, 125, 128}  /* colour 126, closest below 125, closest above 128 */}, // index 126
	{{31, 32, 126, 128} /* colour 127, closest below 126, closest above 128 */, {30, 32, 125, 128}  /* colour 126, closest below 125, closest above 128 */}, // index 127
	{{32, 31, 127, 129} /* colour 128, closest below 127, closest above 129 */, {31, 32, 127, 130}  /* colour 128, closest below 126, closest above 130 */}, // index 128
	{{31, 34, 128, 130} /* colour 129, closest below 128, closest above 130 */, {31, 32, 127, 130}  /* colour 128, closest below 126, closest above 130 */}, // index 129
	{{32, 32, 129, 131} /* colour 130, closest below 129, closest above 131 */, {32, 32, 129, 132}  /* colour 130, closest below 128, closest above 132 */}, // index 130
	{{32, 33, 130, 132} /* colour 131, closest below 130, closest above 132 */, {32, 32, 129, 132}  /* colour 130, closest below 128, closest above 132 */}, // index 131
	{{34, 30, 131, 133} /* colour 132, closest below 131, closest above 133 */, {32, 33, 131, 134}  /* colour 132, closest below 130, closest above 134 */}, // index 132
	{{33, 32, 132, 134} /* colour 133, closest below 132, closest above 134 */, {32, 33, 131, 134}  /* colour 132, closest below 130, closest above 134 */}, // index 133
	{{33, 33, 133, 135} /* colour 134, closest below 133, closest above 135 */, {33, 33, 133, 136}  /* colour 134, closest below 132, closest above 136 */}, // index 134
	{{33, 34, 134, 136} /* colour 135, closest below 134, closest above 136 */, {33, 33, 133, 136}  /* colour 134, closest below 132, closest above 136 */}, // index 135
	{{35, 31, 135, 137} /* colour 136, closest below 135, closest above 137 */, {33, 34, 135, 138}  /* colour 136, closest below 134, closest above 138 */}, // index 136
	{{34, 33, 136, 138} /* colour 137, closest below 136, closest above 138 */, {33, 34, 135, 138}  /* colour 136, closest below 134, closest above 138 */}, // index 137
	{{34, 34, 137, 139} /* colour 138, closest below 137, closest above 139 */, {34, 34, 137, 140}  /* colour 138, closest below 136, closest above 140 */}, // index 138
	{{34, 35, 138, 140} /* colour 139, closest below 138, closest above 140 */, {34, 34, 137, 140}  /* colour 138, closest below 136, closest above 140 */}, // index 139
	{{37, 30, 139, 141} /* colour 140, closest below 139, closest above 141 */, {34, 35, 139, 142}  /* colour 140, closest below 138, closest above 142 */}, // index 140
	{{35, 34, 140, 142} /* colour 141, closest below 140, closest above 142 */, {34, 35, 139, 142}  /* colour 140, closest below 138, closest above 142 */}, // index 141
	{{35, 35, 141, 143} /* colour 142, closest below 141, closest above 143 */, {35, 35, 141, 144}  /* colour 142, closest below 140, closest above 144 */}, // index 142
	{{35, 36, 142, 144} /* colour 143, closest below 142, closest above 144 */, {35, 35, 141, 144}  /* colour 142, closest below 140, closest above 144 */}, // index 143
	{{38, 31, 143, 145} /* colour 144, closest below 143, closest above 145 */, {35, 36, 143, 146}  /* colour 144, closest below 142, closest above 146 */}, // index 144
	{{36, 35, 144, 146} /* colour 145, closest below 144, closest above 146 */, {35, 36, 143, 146}  /* colour 144, closest below 142, closest above 146 */}, // index 145
	{{36, 36, 145, 147} /* colour 146, closest below 145, closest above 147 */, {36, 36, 145, 148}  /* colour 146, closest below 144, closest above 148 */}, // index 146
	{{36, 37, 146, 148} /* colour 147, closest below 146, closest above 148 */, {36, 36, 145, 148}  /* colour 146, closest below 144, closest above 148 */}, // index 147
	{{40, 30, 147, 149} /* colour 148, closest below 147, closest above 149 */, {36, 37, 147, 150}  /* colour 148, closest below 146, closest above 150 */}, // index 148
	{{37, 36, 148, 150} /* colour 149, closest below 148, closest above 150 */, {36, 37, 147, 150}  /* colour 148, closest below 146, closest above 150 */}, // index 149
	{{37, 37, 149, 151} /* colour 150, closest below 149, closest above 151 */, {37, 37, 149, 152}  /* colour 150, closest below 148, closest above 152 */}, // index 150
	{{37, 38, 150, 152} /* colour 151, closest below 150, closest above 152 */, {37, 37, 149, 152}  /* colour 150, closest below 148, closest above 152 */}, // index 151
	{{41, 31, 151, 153} /* colour 152, closest below 151, closest above 153 */, {37, 38, 151, 154}  /* colour 152, closest below 150, closest above 154 */}, // index 152
	{{38, 37, 152, 154} /* colour 153, closest below 152, closest above 154 */, {37, 38, 151, 154}  /* colour 152, closest below 150, closest above 154 */}, // index 153
	{{38, 38, 153, 155} /* colour 154, closest below 153, closest above 155 */, {38, 38, 153, 156}  /* colour 154, closest below 152, closest above 156 */}, // index 154
	{{38, 39, 154, 156} /* colour 155, closest below 154, closest above 156 */, {38, 38, 153, 156}  /* colour 154, closest below 152, closest above 156 */}, // index 155
	{{43, 30, 155, 157} /* colour 156, closest below 155, closest above 157 */, {38, 39, 155, 158}  /* colour 156, closest below 154, closest above 158 */}, // index 156
	{{39, 38, 156, 158} /* colour 157, closest below 156, closest above 158 */, {38, 39, 155, 158}  /* colour 156, closest below 154, closest above 158 */}, // index 157
	{{39, 39, 157, 159} /* colour 158, closest below 157, closest above 159 */, {39, 39, 157, 160}  /* colour 158, closest below 156, closest above 160 */}, // index 158
	{{39, 40, 158, 160} /* colour 159, closest below 158, closest above 160 */, {39, 39, 157, 160}  /* colour 158, closest below 156, closest above 160 */}, // index 159
	{{35, 48, 159, 161} /* colour 160, closest below 159, closest above 161 */, {39, 40, 159, 162}  /* colour 160, closest below 158, closest above 162 */}, // index 160
	{{40, 39, 160, 162} /* colour 161, closest below 160, closest above 162 */, {39, 40, 159, 162}  /* colour 160, closest below 158, closest above 162 */}, // index 161
	{{40, 40, 161, 163} /* colour 162, closest below 161, closest above 163 */, {40, 40, 161, 163}  /* colour 162, closest below 160, closest above 163 */}, // index 162
	{{40, 41, 162, 164} /* colour 163, closest below 162, closest above 164 */, {32, 48, 162, 164}  /* colour 163, closest below 162, closest above 164 */}, // index 163
	{{36, 49, 163, 165} /* colour 164, closest below 163, closest above 165 */, {40, 41, 163, 165}  /* colour 164, closest below 163, closest above 165 */}, // index 164
	{{41, 40, 164, 166} /* colour 165, closest below 164, closest above 166 */, {33, 48, 164, 166}  /* colour 165, closest below 164, closest above 166 */}, // index 165
	{{41, 41, 165, 167} /* colour 166, closest below 165, closest above 167 */, {41, 41, 165, 167}  /* colour 166, closest below 165, closest above 167 */}, // index 166
	{{41, 42, 166, 168} /* colour 167, closest below 166, closest above 168 */, {34, 48, 166, 168}  /* colour 167, closest below 166, closest above 168 */}, // index 167
	{{38, 48, 167, 169} /* colour 168, closest below 167, closest above 169 */, {41, 42, 167, 169}  /* colour 168, closest below 167, closest above 169 */}, // index 168
	{{42, 41, 168, 170} /* colour 169, closest below 168, closest above 170 */, {35, 48, 168, 170}  /* colour 169, closest below 168, closest above 170 */}, // index 169
	{{42, 42, 169, 171} /* colour 170, closest below 169, closest above 171 */, {42, 42, 169, 171}  /* colour 170, closest below 169, closest above 171 */}, // index 170
	{{42, 43, 170, 172} /* colour 171, closest below 170, closest above 172 */, {36, 48, 170, 172}  /* colour 171, closest below 170, closest above 172 */}, // index 171
	{{39, 49, 171, 173} /* colour 172, closest below 171, closest above 173 */, {42, 43, 171, 173}  /* colour 172, closest below 171, closest above 173 */}, // index 172
	{{43, 42, 172, 174} /* colour 173, closest below 172, closest above 174 */, {37, 48, 172, 174}  /* colour 173, closest below 172, closest above 174 */}, // index 173
	{{43, 43, 173, 175} /* colour 174, closest below 173, closest above 175 */, {43, 43, 173, 175}  /* colour 174, closest below 173, closest above 175 */}, // index 174
	{{43, 44, 174, 176} /* colour 175, closest below 174, closest above 176 */, {38, 48, 174, 176}  /* colour 175, closest below 174, closest above 176 */}, // index 175
	{{41, 48, 175, 177} /* colour 176, closest below 175, closest above 177 */, {43, 44, 175, 177}  /* colour 176, closest below 175, closest above 177 */}, // index 176
	{{44, 43, 176, 178} /* colour 177, closest below 176, closest above 178 */, {39, 48, 176, 178}  /* colour 177, closest below 176, closest above 178 */}, // index 177
	{{44, 44, 177, 179} /* colour 178, closest below 177, closest above 179 */, {44, 44, 177, 179}  /* colour 178, closest below 177, closest above 179 */}, // index 178
	{{44, 45, 178, 180} /* colour 179, closest below 178, closest above 180 */, {40, 48, 178, 180}  /* colour 179, closest below 178, closest above 180 */}, // index 179
	{{42, 49, 179, 181} /* colour 180, closest below 179, closest above 181 */, {44, 45, 179, 181}  /* colour 180, closest below 179, closest above 181 */}, // index 180
	{{45, 44, 180, 182} /* colour 181, closest below 180, closest above 182 */, {41, 48, 180, 182}  /* colour 181, closest below 180, closest above 182 */}, // index 181
	{{45, 45, 181, 183} /* colour 182, closest below 181, closest above 183 */, {45, 45, 181, 183}  /* colour 182, closest below 181, closest above 183 */}, // index 182
	{{45, 46, 182, 184} /* colour 183, closest below 182, closest above 184 */, {42, 48, 182, 184}  /* colour 183, closest below 182, closest above 184 */}, // index 183
	{{44, 48, 183, 185} /* colour 184, closest below 183, closest above 185 */, {45, 46, 183, 185}  /* colour 184, closest below 183, closest above 185 */}, // index 184
	{{46, 45, 184, 186} /* colour 185, closest below 184, closest above 186 */, {43, 48, 184, 186}  /* colour 185, closest below 184, closest above 186 */}, // index 185
	{{46, 46, 185, 187} /* colour 186, closest below 185, closest above 187 */, {46, 46, 185, 187}  /* colour 186, closest below 185, closest above 187 */}, // index 186
	{{46, 47, 186, 188} /* colour 187, closest below 186, closest above 188 */, {44, 48, 186, 188}  /* colour 187, closest below 186, closest above 188 */}, // index 187
	{{45, 49, 187, 189} /* colour 188, closest below 187, closest above 189 */, {46, 47, 187, 189}  /* colour 188, closest below 187, closest above 189 */}, // index 188
	{{47, 46, 188, 190} /* colour 189, closest below 188, closest above 190 */, {45, 48, 188, 190}  /* colour 189, closest below 188, closest above 190 */}, // index 189
	{{47, 47, 189, 191} /* colour 190, closest below 189, closest above 191 */, {47, 47, 189, 191}  /* colour 190, closest below 189, closest above 191 */}, // index 190
	{{48, 45, 190, 192} /* colour 191, closest below 190, closest above 192 */, {46, 48, 190, 193}  /* colour 191, closest below 190, closest above 193 */}, // index 191
	{{47, 48, 191, 193} /* colour 192, closest below 191, closest above 193 */, {46, 48, 190, 193}  /* colour 191, closest below 190, closest above 193 */}, // index 192
	{{48, 47, 192, 194} /* colour 193, closest below 192, closest above 194 */, {47, 48, 192, 195}  /* colour 193, closest below 191, closest above 195 */}, // index 193
	{{47, 50, 193, 195} /* colour 194, closest below 193, closest above 195 */, {47, 48, 192, 195}  /* colour 193, closest below 191, closest above 195 */}, // index 194
	{{48, 48, 194, 196} /* colour 195, closest below 194, closest above 196 */, {48, 48, 194, 197}  /* colour 195, closest below 193, closest above 197 */}, // index 195
	{{48, 49, 195, 197} /* colour 196, closest below 195, closest above 197 */, {48, 48, 194, 197}  /* colour 195, closest below 193, closest above 197 */}, // index 196
	{{50, 46, 196, 198} /* colour 197, closest below 196, closest above 198 */, {48, 49, 196, 199}  /* colour 197, closest below 195, closest above 199 */}, // index 197
	{{49, 48, 197, 199} /* colour 198, closest below 197, closest above 199 */, {48, 49, 196, 199}  /* colour 197, closest below 195, closest above 199 */}, // index 198
	{{49, 49, 198, 200} /* colour 199, closest below 198, closest above 200 */, {49, 49, 198, 201}  /* colour 199, closest below 197, closest above 201 */}, // index 199
	{{49, 50, 199, 201} /* colour 200, closest below 199, closest above 201 */, {49, 49, 198, 201}  /* colour 199, closest below 197, closest above 201 */}, // index 200
	{{51, 47, 200, 202} /* colour 201, closest below 200, closest above 202 */, {49, 50, 200, 203}  /* colour 201, closest below 199, closest above 203 */}, // index 201
	{{50, 49, 201, 203} /* colour 202, closest below 201, closest above 203 */, {49, 50, 200, 203}  /* colour 201, closest below 199, closest above 203 */}, // index 202
	{{50, 50, 202, 204} /* colour 203, closest below 202, closest above 204 */, {50, 50, 202, 205}  /* colour 203, closest below 201, closest above 205 */}, // index 203
	{{50, 51, 203, 205} /* colour 204, closest below 203, closest above 205 */, {50, 50, 202, 205}  /* colour 203, closest below 201, closest above 205 */}, // index 204
	{{53, 46, 204, 206} /* colour 205, closest below 204, closest above 206 */, {50, 51, 204, 207}  /* colour 205, closest below 203, closest above 207 */}, // index 205
	{{51, 50, 205, 207} /* colour 206, closest below 205, closest above 207 */, {50, 51, 204, 207}  /* colour 205, closest below 203, closest above 207 */}, // index 206
	{{51, 51, 206, 208} /* colour 207, closest below 206, closest above 208 */, {51, 51, 206, 209}  /* colour 207, closest below 205, closest above 209 */}, // index 207
	{{51, 52, 207, 209} /* colour 208, closest below 207, closest above 209 */, {51, 51, 206, 209}  /* colour 207, closest below 205, closest above 209 */}, // index 208
	{{54, 47, 208, 210} /* colour 209, closest below 208, closest above 210 */, {51, 52, 208, 211}  /* colour 209, closest below 207, closest above 211 */}, // index 209
	{{52, 51, 209, 211} /* colour 210, closest below 209, closest above 211 */, {51, 52, 208, 211}  /* colour 209, closest below 207, closest above 211 */}, // index 210
	{{52, 52, 210, 212} /* colour 211, closest below 210, closest above 212 */, {52, 52, 210, 213}  /* colour 211, closest below 209, closest above 213 */}, // index 211
	{{52, 53, 211, 213} /* colour 212, closest below 211, closest above 213 */, {52, 52, 210, 213}  /* colour 211, closest below 209, closest above 213 */}, // index 212
	{{56, 46, 212, 214} /* colour 213, closest below 212, closest above 214 */, {52, 53, 212, 215}  /* colour 213, closest below 211, closest above 215 */}, // index 213
	{{53, 52, 213, 215} /* colour 214, closest below 213, closest above 215 */, {52, 53, 212, 215}  /* colour 213, closest below 211, closest above 215 */}, // index 214
	{{53, 53, 214, 216} /* colour 215, closest below 214, closest above 216 */, {53, 53, 214, 217}  /* colour 215, closest below 213, closest above 217 */}, // index 215
	{{53, 54, 215, 217} /* colour 216, closest below 215, closest above 217 */, {53, 53, 214, 217}  /* colour 215, closest below 213, closest above 217 */}, // index 216
	{{57, 47, 216, 218} /* colour 217, closest below 216, closest above 218 */, {53, 54, 216, 219}  /* colour 217, closest below 215, closest above 219 */}, // index 217
	{{54, 53, 217, 219} /* colour 218, closest below 217, closest above 219 */, {53, 54, 216, 219}  /* colour 217, closest below 215, closest above 219 */}, // index 218
	{{54, 54, 218, 220} /* colour 219, closest below 218, closest above 220 */, {54, 54, 218, 221}  /* colour 219, closest below 217, closest above 221 */}, // index 219
	{{54, 55, 219, 221} /* colour 220, closest below 219, closest above 221 */, {54, 54, 218, 221}  /* colour 219, closest below 217, closest above 221 */}, // index 220
	{{59, 46, 220, 222} /* colour 221, closest below 220, closest above 222 */, {54, 55, 220, 223}  /* colour 221, closest below 219, closest above 223 */}, // index 221
	{{55, 54, 221, 223} /* colour 222, closest below 221, closest above 223 */, {54, 55, 220, 223}  /* colour 221, closest below 219, closest above 223 */}, // index 222
	{{55, 55, 222, 224} /* colour 223, closest below 222, closest above 224 */, {55, 55, 222, 225}  /* colour 223, closest below 221, closest above 225 */}, // index 223
	{{55, 56, 223, 225} /* colour 224, closest below 223, closest above 225 */, {55, 55, 222, 225}  /* colour 223, closest below 221, closest above 225 */}, // index 224
	{{60, 47, 224, 226} /* colour 225, closest below 224, closest above 226 */, {55, 56, 224, 227}  /* colour 225, closest below 223, closest above 227 */}, // index 225
	{{56, 55, 225, 227} /* colour 226, closest below 225, closest above 227 */, {55, 56, 224, 227}  /* colour 225, closest below 223, closest above 227 */}, // index 226
	{{56, 56, 226, 228} /* colour 227, closest below 226, closest above 228 */, {56, 56, 226, 229}  /* colour 227, closest below 225, closest above 229 */}, // index 227
	{{56, 57, 227, 229} /* colour 228, closest below 227, closest above 229 */, {56, 56, 226, 229}  /* colour 227, closest below 225, closest above 229 */}, // index 228
	{{62, 46, 228, 230} /* colour 229, closest below 228, closest above 230 */, {56, 57, 228, 231}  /* colour 229, closest below 227, closest above 231 */}, // index 229
	{{57, 56, 229, 231} /* colour 230, closest below 229, closest above 231 */, {56, 57, 228, 231}  /* colour 229, closest below 227, closest above 231 */}, // index 230
	{{57, 57, 230, 232} /* colour 231, closest below 230, closest above 232 */, {57, 57, 230, 233}  /* colour 231, closest below 229, closest above 233 */}, // index 231
	{{57, 58, 231, 233} /* colour 232, closest below 231, closest above 233 */, {57, 57, 230, 233}  /* colour 231, closest below 229, closest above 233 */}, // index 232
	{{63, 47, 232, 234} /* colour 233, closest below 232, closest above 234 */, {57, 58, 232, 235}  /* colour 233, closest below 231, closest above 235 */}, // index 233
	{{58, 57, 233, 235} /* colour 234, closest below 233, closest above 235 */, {57, 58, 232, 235}  /* colour 233, closest below 231, closest above 235 */}, // index 234
	{{58, 58, 234, 236} /* colour 235, closest below 234, closest above 236 */, {58, 58, 234, 237}  /* colour 235, closest below 233, closest above 237 */}, // index 235
	{{58, 59, 235, 238} /* colour 236, closest below 235, closest above 238 */, {58, 58, 234, 237}  /* colour 235, closest below 233, closest above 237 */}, // index 236
	{{58, 59, 235, 238} /* colour 236, closest below 235, closest above 238 */, {58, 59, 236, 239}  /* colour 237, closest below 235, closest above 239 */}, // index 237
	{{59, 58, 237, 239} /* colour 238, closest below 236, closest above 239 */, {58, 59, 236, 239}  /* colour 237, closest below 235, closest above 239 */}, // index 238
	{{59, 59, 238, 240} /* colour 239, closest below 238, closest above 240 */, {59, 59, 238, 241}  /* colour 239, closest below 237, closest above 241 */}, // index 239
	{{59, 60, 239, 242} /* colour 240, closest below 239, closest above 242 */, {59, 59, 238, 241}  /* colour 239, closest below 237, closest above 241 */}, // index 240
	{{59, 60, 239, 242} /* colour 240, closest below 239, closest above 242 */, {59, 60, 240, 243}  /* colour 241, closest below 239, closest above 243 */}, // index 241
	{{60, 59, 241, 243} /* colour 242, closest below 240, closest above 243 */, {59, 60, 240, 243}  /* colour 241, closest below 239, closest above 243 */}, // index 242
	{{60, 60, 242, 244} /* colour 243, closest below 242, closest above 244 */, {60, 60, 242, 245}  /* colour 243, closest below 241, closest above 245 */}, // index 243
	{{60, 61, 243, 246} /* colour 244, closest below 243, closest above 246 */, {60, 60, 242, 245}  /* colour 243, closest below 241, closest above 245 */}, // index 244
	{{60, 61, 243, 246} /* colour 244, closest below 243, closest above 246 */, {60, 61, 244, 247}  /* colour 245, closest below 243, closest above 247 */}, // index 245
	{{61, 60, 245, 247} /* colour 246, closest below 244, closest above 247 */, {60, 61, 244, 247}  /* colour 245, closest below 243, closest above 247 */}, // index 246
	{{61, 61, 246, 248} /* colour 247, closest below 246, closest above 248 */, {61, 61, 246, 249}  /* colour 247, closest below 245, closest above 249 */}, // index 247
	{{61, 62, 247, 250} /* colour 248, closest below 247, closest above 250 */, {61, 61, 246, 249}  /* colour 247, closest below 245, closest above 249 */}, // index 248
	{{61, 62, 247, 250} /* colour 248, closest below 247, closest above 250 */, {61, 62, 248, 251}  /* colour 249, closest below 247, closest above 251 */}, // index 249
	{{62, 61, 249, 251} /* colour 250, closest below 248, closest above 251 */, {61, 62, 248, 251}  /* colour 249, closest below 247, closest above 251 */}, // index 250
	{{62, 62, 250, 252} /* colour 251, closest below 250, closest above 252 */, {62, 62, 250, 253}  /* colour 251, closest below 249, closest above 253 */}, // index 251
	{{62, 63, 251, 254} /* colour 252, closest below 251, closest above 254 */, {62, 62, 250, 253}  /* colour 251, closest below 249, closest above 253 */}, // index 252
	{{62, 63, 251, 254} /* colour 252, closest below 251, closest above 254 */, {62, 63, 252, 255}  /* colour 253, closest below 251, closest above 255 */}, // index 253
	{{63, 62, 253, 255} /* colour 254, closest below 252, closest above 255 */, {62, 63, 252, 255}  /* colour 253, closest below 251, closest above 255 */}, // index 254
	{{63, 63, 254, 255} /* colour 255, closest below 254, closest above 255 */, {63, 63, 254, 255}  /* colour 255, closest below 253, closest above 255 */}  // index 255
};
static int g_dds_round5[256][2] = 
{
	{0, 0},
	{-1, -1},
	{-1, -1},
	{0, 1},
	{-1, -1},
	{0,   2},
	{-1, -1},
	{-1, -1},
	{1, 1},
	{-1, -1},
	{-1, -1},
	{1,   2},
	{-1, -1},
	{1, 3},
	{0, 5},
	{-1, -1},
	{2,   2},
	{-1, -1},
	{-1, -1},
	{2, 3},
	{-1, -1},
	{-1, -1},
	{2,   4},
	{-1, -1},
	{3, 3},
	{0, 9},
	{-1, -1},
	{3,   4},
	{-1, -1},
	{-1, -1},
	{3, 5},
	{-1, -1},
	{3, 6},
	{4,   4},
	{-1, -1},
	{3, 7},
	{4, 5},
	{-1, -1},
	{4,   6},
	{-1, -1},
	{-1, -1},
	{5, 5},
	{-1, -1},
	{3, 10},
	{5,   6},
	{-1, -1},
	{5, 7},
	{4, 9},
	{-1, -1},
	{6,   6},
	{-1, -1},
	{-1, -1},
	{6, 7},
	{-1, -1},
	{3, 14},
	{6,   8},
	{-1, -1},
	{7, 7},
	{4, 13},
	{-1, -1},
	{7,   8},
	{-1, -1},
	{-1, -1},
	{7, 9},
	{-1, -1},
	{7, 10},
	{8,   8},
	{-1, -1},
	{7, 11},
	{8, 9},
	{-1, -1},
	{8,   10},
	{-1, -1},
	{-1, -1},
	{9, 9},
	{-1, -1},
	{7, 14},
	{9,   10},
	{-1, -1},
	{9, 11},
	{8, 13},
	{-1, -1},
	{10,   10},
	{-1, -1},
	{-1, -1},
	{10, 11},
	{-1, -1},
	{7, 18},
	{10,   12},
	{-1, -1},
	{11, 11},
	{8, 17},
	{-1, -1},
	{11,   12},
	{-1, -1},
	{-1, -1},
	{11, 13},
	{-1, -1},
	{11, 14},
	{12,   12},
	{-1, -1},
	{11, 15},
	{12, 13},
	{-1, -1},
	{12,   14},
	{-1, -1},
	{-1, -1},
	{13, 13},
	{-1, -1},
	{11, 18},
	{13,   14},
	{-1, -1},
	{13, 15},
	{12, 17},
	{-1, -1},
	{14,   14},
	{-1, -1},
	{-1, -1},
	{14, 15},
	{-1, -1},
	{11, 22},
	{14,   16},
	{-1, -1},
	{15, 15},
	{12, 21},
	{-1, -1},
	{15,   16},
	{-1, -1},
	{-1, -1},
	{15, 17},
	{-1, -1},
	{15, 18},
	{16,   16},
	{-1, -1},
	{15, 19},
	{16, 17},
	{-1, -1},
	{16,   18},
	{-1, -1},
	{-1, -1},
	{17, 17},
	{-1, -1},
	{15, 22},
	{17,   18},
	{-1, -1},
	{17, 19},
	{16, 21},
	{-1, -1},
	{18,   18},
	{-1, -1},
	{-1, -1},
	{18, 19},
	{-1, -1},
	{15, 26},
	{18,   20},
	{-1, -1},
	{19, 19},
	{16, 25},
	{-1, -1},
	{19,   20},
	{-1, -1},
	{-1, -1},
	{19, 21},
	{-1, -1},
	{19, 22},
	{20,   20},
	{-1, -1},
	{19, 23},
	{20, 21},
	{-1, -1},
	{20,   22},
	{-1, -1},
	{-1, -1},
	{21, 21},
	{-1, -1},
	{19, 26},
	{21,   22},
	{-1, -1},
	{21, 23},
	{20, 25},
	{-1, -1},
	{22,   22},
	{-1, -1},
	{-1, -1},
	{22, 23},
	{-1, -1},
	{19, 30},
	{22,   24},
	{-1, -1},
	{23, 23},
	{20, 29},
	{-1, -1},
	{23,   24},
	{-1, -1},
	{-1, -1},
	{23, 25},
	{-1, -1},
	{23, 26},
	{24,   24},
	{-1, -1},
	{23, 27},
	{24, 25},
	{-1, -1},
	{24,   26},
	{-1, -1},
	{-1, -1},
	{25, 25},
	{-1, -1},
	{23, 30},
	{25,   26},
	{-1, -1},
	{25, 27},
	{24, 29},
	{-1, -1},
	{26,   26},
	{-1, -1},
	{-1, -1},
	{26, 27},
	{-1, -1},
	{-1, -1},
	{26,   28},
	{-1, -1},
	{27, 27},
	{-1, -1},
	{-1, -1},
	{27,   28},
	{-1, -1},
	{-1, -1},
	{27, 29},
	{-1, -1},
	{27, 30},
	{28,   28},
	{-1, -1},
	{27, 31},
	{28, 29},
	{-1, -1},
	{28,   30},
	{-1, -1},
	{-1, -1},
	{29, 29},
	{-1, -1},
	{-1, -1},
	{29,   30},
	{-1, -1},
	{29, 31},
	{-1, -1},
	{-1, -1},
	{30,   30},
	{-1, -1},
	{-1, -1},
	{30,   31},
	{-1, -1},
	{-1, -1},
	{-1, -1},
	{-1, -1},
	{31, 31}
};
static int g_dds_round6[256][2] = 
{
	{0, 0},
	{0, 1},
	{-1, -1},
	{0, 2},
	{1, 1},
	{1, 2},
	{-1, -1},
	{1,   3},
	{2, 2},
	{2, 3},
	{-1, -1},
	{2, 4},
	{3, 3},
	{3, 4},
	{-1, -1},
	{3,   5},
	{4, 4},
	{4, 5},
	{-1, -1},
	{4, 6},
	{5, 5},
	{5, 6},
	{0, 16},
	{5,   7},
	{6, 6},
	{6, 7},
	{1, 17},
	{6, 8},
	{7, 7},
	{7, 8},
	{3, 16},
	{7,   9},
	{8, 8},
	{8, 9},
	{4, 17},
	{8, 10},
	{9, 9},
	{9, 10},
	{6, 16},
	{9,   11},
	{10, 10},
	{10, 11},
	{7, 17},
	{10, 12},
	{11, 11},
	{11, 12},
	{9,   16},
	{11, 13},
	{12, 12},
	{12, 13},
	{10, 17},
	{12, 14},
	{13,   13},
	{13, 14},
	{12, 16},
	{13, 15},
	{14, 14},
	{14, 15},
	{13,   17},
	{14, 16},
	{15, 15},
	{6, 33},
	{15, 16},
	{15, 17},
	{15, 18},
	{16,   16},
	{16, 17},
	{15, 20},
	{16, 18},
	{17, 17},
	{17, 18},
	{15,   23},
	{17, 19},
	{18, 18},
	{18, 19},
	{15, 26},
	{18, 20},
	{19,   19},
	{19, 20},
	{15, 29},
	{19, 21},
	{20, 20},
	{20, 21},
	{15,   32},
	{20, 22},
	{21, 21},
	{21, 22},
	{16, 32},
	{21, 23},
	{22,   22},
	{22, 23},
	{17, 33},
	{22, 24},
	{23, 23},
	{23, 24},
	{19,   32},
	{23, 25},
	{24, 24},
	{24, 25},
	{20, 33},
	{24, 26},
	{25,   25},
	{25, 26},
	{22, 32},
	{25, 27},
	{26, 26},
	{26, 27},
	{23,   33},
	{26, 28},
	{27, 27},
	{27, 28},
	{25, 32},
	{27, 29},
	{28,   28},
	{28, 29},
	{26, 33},
	{28, 30},
	{29, 29},
	{29, 30},
	{28,   32},
	{29, 31},
	{30, 30},
	{30, 31},
	{29, 33},
	{30, 32},
	{31,   31},
	{22, 49},
	{31, 32},
	{31, 33},
	{31, 34},
	{32, 32},
	{32,   33},
	{31, 36},
	{32, 34},
	{33, 33},
	{33, 34},
	{31, 39},
	{33,   35},
	{34, 34},
	{34, 35},
	{31, 42},
	{34, 36},
	{35, 35},
	{35,   36},
	{31, 45},
	{35, 37},
	{36, 36},
	{36, 37},
	{31, 48},
	{36,   38},
	{37, 37},
	{37, 38},
	{32, 48},
	{37, 39},
	{38, 38},
	{38,   39},
	{33, 49},
	{38, 40},
	{39, 39},
	{39, 40},
	{35, 48},
	{39,   41},
	{40, 40},
	{40, 41},
	{36, 49},
	{40, 42},
	{41, 41},
	{41,   42},
	{38, 48},
	{41, 43},
	{42, 42},
	{42, 43},
	{39, 49},
	{42,   44},
	{43, 43},
	{43, 44},
	{41, 48},
	{43, 45},
	{44, 44},
	{44,   45},
	{42, 49},
	{44, 46},
	{45, 45},
	{45, 46},
	{44, 48},
	{45,   47},
	{46, 46},
	{46, 47},
	{45, 49},
	{46, 48},
	{47,   47},
	{-1, -1},
	{47, 48},
	{47, 49},
	{47, 50},
	{48, 48},
	{48,   49},
	{47, 52},
	{48, 50},
	{49, 49},
	{49, 50},
	{47, 55},
	{49,   51},
	{50, 50},
	{50, 51},
	{47, 58},
	{50, 52},
	{51, 51},
	{51,   52},
	{47, 61},
	{51, 53},
	{52, 52},
	{52, 53},
	{-1, -1},
	{52,   54},
	{53, 53},
	{53, 54},
	{-1, -1},
	{53, 55},
	{54, 54},
	{54,   55},
	{-1, -1},
	{54, 56},
	{55, 55},
	{55, 56},
	{-1, -1},
	{55,   57},
	{56, 56},
	{56, 57},
	{-1, -1},
	{56, 58},
	{57, 57},
	{57,   58},
	{-1, -1},
	{57, 59},
	{58, 58},
	{58, 59},
	{-1, -1},
	{58,   60},
	{59, 59},
	{59, 60},
	{-1, -1},
	{59, 61},
	{60, 60},
	{60,   61},
	{-1, -1},
	{60, 62},
	{61, 61},
	{61, 62},
	{-1, -1},
	{61,   63},
	{62, 62},
	{62, 63},
	{-1, -1},
	{-1, -1},
	{63, 63}
};

__forceinline vec3f32_t DDS_UnpackVec3u8QuantisedToVec3f32(vec3u8_t x)
{
	vec3f32_t vec;

	vec.v[0] = (float)(((x.v[0] << 3) | (x.v[0] >> 2)));
	vec.v[1] = (float)(((x.v[1] << 2) | (x.v[1] >> 4)));
	vec.v[2] = (float)(((x.v[2] << 3) | (x.v[2] >> 2)));

	return vec;
}

__forceinline void DDS_BC1GeneratePalette(vec3f32_t *colour, int has_alpha, uint16_t *packed_colour_out, int force_alpha, int is_bc23)
{
	uint16_t packed_colour[2];
	vec3u8_t rgbu8[2];

	rgbu8[0] = Vec3f32_ToVec3u8(colour[0]);
	rgbu8[1] = Vec3f32_ToVec3u8(colour[1]);

	packed_colour[0] = ((Vec3u8_GetComponent(rgbu8[0], 0) >> 3) << 11) | ((Vec3u8_GetComponent(rgbu8[0], 1) >> 2) << 5) | ((Vec3u8_GetComponent(rgbu8[0], 2) >> 3) << 0);
	packed_colour[1] = ((Vec3u8_GetComponent(rgbu8[1], 0) >> 3) << 11) | ((Vec3u8_GetComponent(rgbu8[1], 1) >> 2) << 5) | ((Vec3u8_GetComponent(rgbu8[1], 2) >> 3) << 0);

	// TODO: handle BC2/3 properly, this is wrong, BC2/3 doesn't care about endpoint ordering
	if ((has_alpha || force_alpha) && !is_bc23)
	{
		if (packed_colour[0] == packed_colour[1])
			packed_colour[1]++;	// TODO: fixme
		if (packed_colour[0] > packed_colour[1])
		{
			uint16_t temp = packed_colour[0];
			packed_colour[0] = packed_colour[1];
			packed_colour[1] = temp;

			colour[2] = colour[0];
			colour[0] = colour[1];
			colour[1] = colour[2];
		}
	}
	else
	{
		if (packed_colour[0] == packed_colour[1])
			packed_colour[1]++;	// TODO: fixme
		if (packed_colour[0] < packed_colour[1])
		{
			uint16_t temp = packed_colour[0];
			packed_colour[0] = packed_colour[1];
			packed_colour[1] = temp;

			colour[2] = colour[0];
			colour[0] = colour[1];
			colour[1] = colour[2];
		}
	}
	DDS_UnpackTof32(packed_colour[0], 5, 6, 5, 0, colour[0].v);
	DDS_UnpackTof32(packed_colour[1], 5, 6, 5, 0, colour[1].v);

	if ((has_alpha || force_alpha) && !is_bc23)
	{
		colour[2] = Vec3f32_Add(Vec3f32_Scale(colour[0], 1.0/2.0), Vec3f32_Scale(colour[1], 1.0/2.0));
		colour[3] = Vec3f32_Vec(DDS_MAX_INIT_ERROR, DDS_MAX_INIT_ERROR, DDS_MAX_INIT_ERROR);
	}
	else
	{
		colour[2] = Vec3f32_Add(Vec3f32_Scale(colour[0], 2.0f/3.0f), Vec3f32_Scale(colour[1], 1.0f/3.0f));
		colour[3] = Vec3f32_Add(Vec3f32_Scale(colour[0], 1.0f/3.0f), Vec3f32_Scale(colour[1], 2.0f/3.0f));
	}
	colour[2] = Vec3f32_Floor(Vec3f32_Add(colour[2], Vec3f32_Vec(0.5f, 0.5f, 0.5f)));
	colour[3] = Vec3f32_Floor(Vec3f32_Add(colour[3], Vec3f32_Vec(0.5f, 0.5f, 0.5f)));

	if (packed_colour_out)
	{
		packed_colour_out[0] = packed_colour[0];
		packed_colour_out[1] = packed_colour[1];
	}
}

__forceinline float DDS_BC1FindBestIndexesSphere(
	vec3f32_t original[4][4],
	vec3f32_t *colour,
	int index[16])
{
	int i;
	int j;
	float err = 0.0f;
	for (i = 0; i < 4; i++)
	{
		for (j = 0; j < 4; j++)
		{
			vec3f32_t tvec = Vec3f32_Sub(original[i][j], colour[0]);
			vec3f32_t tvecl = Vec3f32_Sub(original[i][j], colour[1]);
			float len = Vec3f32_LenSq(tvec);
			float lenl = Vec3f32_LenSq(tvecl);

			if (len < lenl)
			{
				err += len;
				index[i*4 + j] = 0;
			}
			else
			{
				err += lenl;
				index[i*4 + j] = 1;
			}
		}
	}
	return err;
}

__forceinline float DDS_BC1FindBestIndexes(
	float *pixel4x4_rgba,
	vec3f32_t original[4][4],
	int has_alpha,
	float alpha_cutoff,
	vec3f32_t *colour,
	int index[4][4])
{
	int i;
	int j;
	int k;
	float err = 0.0f;
	for (i = 0; i < 4; i++)
	{
		for (j = 0; j < 4; j++)
		{
			if (has_alpha && (pixel4x4_rgba[(i*4 + j)*4 + 3] < alpha_cutoff))
			{
				index[i][j] = 3;
			}
			else
			{
				int indexl = 0;
				vec3f32_t tvec = Vec3f32_Sub(original[i][j], colour[0]);
				float len = Vec3f32_LenSq(tvec);

				for (k = 1; k < 4; k++)
				{
					vec3f32_t tvecl = Vec3f32_Sub(original[i][j], colour[k]);
					float lenl = Vec3f32_LenSq(tvecl);
					if (lenl < len)
					{
						len = lenl;
						indexl = k;
					}
				}
				err += len;
				index[i][j] = indexl;
			}
		}
	}
	return err;
}

__forceinline float DDS_BC1FindBestIndexesLimited(
	float *pixel4x4_rgba,
	vec3f32_t original[4][4],
	float alpha_cutoff,
	int has_alpha, 
	vec3f32_t eigen,
	float best_error, 
	float plane0_error, 
	float plane1_error, 
	int plane0_count,
	int plane1_count,
	int *plane0_indexes, 
	int *plane1_indexes, 
	vec3u8_t path_quantised0,
	vec3u8_t path_quantised1,
	vec3f32_t *endpoint0,
	vec3f32_t *endpoint1,
	int *force_alpha,
	int block_x,
	int block_y,
	int is_bc23)
{
	float min_err = 0.0f;
	float err_endpoint[2] = {DDS_MAX_INIT_ERROR, DDS_MAX_INIT_ERROR};
	int interior_indexes_flag[16];
	int i;
	vec3f32_t colour[4];
	int endpoint_type;
	int max_index;
	int index[4][4];

	for (i = 0; i < 16; i++)
		interior_indexes_flag[i] = 1;
	for (i = 0; i < plane0_count; i++)
		interior_indexes_flag[plane0_indexes[i]] = 0;
	for (i = 0; i < plane1_count; i++)
		interior_indexes_flag[plane1_indexes[i]] = 0;

	colour[0] = DDS_UnpackVec3u8QuantisedToVec3f32(path_quantised0);
	colour[1] = DDS_UnpackVec3u8QuantisedToVec3f32(path_quantised1);

#if 1
	for (i = 0; i < 16; i++)
	{
		if (interior_indexes_flag[i] && (!has_alpha || pixel4x4_rgba[i*4 + 3] >= alpha_cutoff))
		{
			vec3f32_t temp_vec = Vec3f32_Sub(original[i/4][i%4], colour[0]);
			temp_vec = Vec3f32_Sub(temp_vec, Vec3f32_Scale(eigen, Vec3f32_Dot(temp_vec, eigen)));
			min_err += Vec3f32_Dot(temp_vec, temp_vec);
		}
	}
	//if (plane0_error + plane1_error + min_err > best_error)
		//return DDS_MAX_INIT_ERROR;
#endif
	//for (endpoint_type = 0; endpoint_type < (has_alpha ? 1 : 2); endpoint_type++)

	if (is_bc23 || has_alpha)
		max_index = 1;
	else
		max_index = 2;

	for (endpoint_type = 0; endpoint_type < max_index; endpoint_type++)
	{
		float err = 0.0f;
		vec3f32_t colour_dir;
		float invlen;

		DDS_BC1GeneratePalette(colour, (has_alpha + endpoint_type) % 2, 0, 0, is_bc23);

		colour_dir = Vec3f32_Normalise(Vec3f32_Sub(colour[1], colour[0]));
		invlen = Vec3f32_Len(Vec3f32_Sub(colour[1], colour[0]));
		invlen = invlen != 0.0f ? 1.0f / Vec3f32_Len(Vec3f32_Sub(colour[1], colour[0])) : 1.0f;
#if 0
		for (i = 0; i < 4; i++)
		{
			int j;
			int k;
			int indexl;
			for (j = 0; j < 4; j++)
			{
				if (pixel4x4_rgba[(i*4 + j)*4 + 3] < alpha_cutoff)
				{
					index[i][j] = 3;
				}
				else
				{
					int indexl = 0;
					vec3f32_t tvec = Vec3f32_Sub(original[i][j], colour[0]);
					float len = Vec3f32_LenSq(tvec);

					for (k = 1; k < 4; k++)
					{
						vec3f32_t tvecl = Vec3f32_Sub(original[i][j], colour[k]);
						float lenl = Vec3f32_LenSq(tvecl);
						if (lenl < len)
						{
							len = lenl;
							indexl = k;
						}
					}
					err += len;
					index[i][j] = indexl;
				}
			}
		}
		return err;
#else
		{
			const int base_index_map[2][4] = {{0, 2, 3, 1}, {0, 2, 1, 0}};
			const float scale = ((endpoint_type + has_alpha) % 2) ? 2.0f : 3.0f;
			const int *index_map = base_index_map[(endpoint_type + has_alpha) % 2];
			//const float scale = has_alpha ? 2.0f : 3.0f;
			const float offset = 0.5f;
			const float zero = 0.0f;
			//#define USE_SSE
#ifdef USE_SSE
			__declspec(align(16)) vec4f32_t original_v4[16];
			__declspec(align(16)) vec4f32_t colour_v4[4];
			__declspec(align(16)) vec4f32_t colour_dir_v4;
			for (i = 0; i < 16; i++)
				original_v4[i] = Vec4f32_Vec(original[i/4][i%4].v[0], original[i/4][i%4].v[1], original[i/4][i%4].v[2], 0.0f);
			for (i = 0; i < 4; i++)
				colour_v4[i] = Vec4f32_Vec(colour[i].v[0], colour[i].v[1], colour[i].v[2], 0.0f);
			colour_dir_v4 = Vec4f32_Vec(colour_dir.v[0], colour_dir.v[1], colour_dir.v[2], 0.0f);
#endif

			for (i = 0; i < 4; i++)
			{
				int temp_index[4];
#ifdef USE_SSE
				__m128 temp_vec128[4];
				__m128 colour128[4];
				__m128 colour128_dir;
				__m128 invlen128;
				__m128 scale128;
				__m128 offset128;
				__m128 zero128;
				__m128i index128;
				__m128 dist128;

				temp_vec128[0] = _mm_load_ps(&original_v4[i*4 + 0]);
				temp_vec128[1] = _mm_load_ps(&original_v4[i*4 + 1]);
				temp_vec128[2] = _mm_load_ps(&original_v4[i*4 + 2]);
				temp_vec128[3] = _mm_load_ps(&original_v4[i*4 + 3]);

				colour128[0] = _mm_load_ps(&colour_v4[0]);
				colour128[1] = _mm_load_ps(&colour_v4[1]);
				colour128[2] = _mm_load_ps(&colour_v4[2]);
				colour128[3] = _mm_load_ps(&colour_v4[3]);

				temp_vec128[0] = _mm_sub_ps(temp_vec128[0], colour128[0]);
				temp_vec128[1] = _mm_sub_ps(temp_vec128[1], colour128[0]);
				temp_vec128[2] = _mm_sub_ps(temp_vec128[2], colour128[0]);
				temp_vec128[3] = _mm_sub_ps(temp_vec128[3], colour128[0]);

				colour128_dir = _mm_load_ps(&colour_dir_v4);
				invlen128 = _mm_load1_ps(&invlen);

				temp_vec128[0] = _mm_mul_ps(temp_vec128[0], colour128_dir);
				temp_vec128[0] = _mm_hadd_ps(temp_vec128[0], temp_vec128[0]);
				temp_vec128[1] = _mm_mul_ps(temp_vec128[1], colour128_dir);
				temp_vec128[1] = _mm_hadd_ps(temp_vec128[1], temp_vec128[1]);
				temp_vec128[0] = _mm_hadd_ps(temp_vec128[0], temp_vec128[0]);
				temp_vec128[1] = _mm_hadd_ps(temp_vec128[1], temp_vec128[1]);
				temp_vec128[0] = _mm_unpacklo_ps(temp_vec128[0], temp_vec128[1]);

				temp_vec128[2] = _mm_mul_ps(temp_vec128[2], colour128_dir);
				temp_vec128[2] = _mm_hadd_ps(temp_vec128[2], temp_vec128[2]);
				temp_vec128[3] = _mm_mul_ps(temp_vec128[3], colour128_dir);
				temp_vec128[3] = _mm_hadd_ps(temp_vec128[3], temp_vec128[3]);
				temp_vec128[2] = _mm_hadd_ps(temp_vec128[2], temp_vec128[2]);
				temp_vec128[3] = _mm_hadd_ps(temp_vec128[3], temp_vec128[3]);
				temp_vec128[2] = _mm_unpacklo_ps(temp_vec128[2], temp_vec128[3]);

				temp_vec128[0] = _mm_shuffle_ps(temp_vec128[0], temp_vec128[2], 0 | (1 << 2) | (1 << 6));
				dist128 = _mm_mul_ps(temp_vec128[0], invlen128);

				scale128 = _mm_load1_ps(&scale);
				offset128 = _mm_load1_ps(&offset);
				zero128 = _mm_load1_ps(&zero);

				dist128 = _mm_mul_ps(dist128, scale128);
				dist128 = _mm_add_ps(dist128, offset128);
				dist128 = _mm_min_ps(dist128, scale128);
				dist128 = _mm_max_ps(dist128, zero128);
				dist128 = _mm_floor_ps(dist128);
				index128 = _mm_cvtps_epi32(dist128);
				_mm_storeu_si128(temp_index, index128);
#else
				vec3f32_t temp_vec[4];
				float dist[4];

				temp_vec[0] = Vec3f32_Sub(original[i][0], colour[0]);
				temp_vec[1] = Vec3f32_Sub(original[i][1], colour[0]);
				temp_vec[2] = Vec3f32_Sub(original[i][2], colour[0]);
				temp_vec[3] = Vec3f32_Sub(original[i][3], colour[0]);

				dist[0] = Vec3f32_Dot(temp_vec[0], colour_dir) * invlen;
				dist[1] = Vec3f32_Dot(temp_vec[1], colour_dir) * invlen;
				dist[2] = Vec3f32_Dot(temp_vec[2], colour_dir) * invlen;
				dist[3] = Vec3f32_Dot(temp_vec[3], colour_dir) * invlen;

				temp_index[0] = (int)floorf(Math_Clampf32(dist[0] * scale + 0.5f, 0.0f, scale));
				temp_index[1] = (int)floorf(Math_Clampf32(dist[1] * scale + 0.5f, 0.0f, scale));
				temp_index[2] = (int)floorf(Math_Clampf32(dist[2] * scale + 0.5f, 0.0f, scale));
				temp_index[3] = (int)floorf(Math_Clampf32(dist[3] * scale + 0.5f, 0.0f, scale));
#endif
				temp_index[0] = index_map[temp_index[0]];
				temp_index[1] = index_map[temp_index[1]];
				temp_index[2] = index_map[temp_index[2]];
				temp_index[3] = index_map[temp_index[3]];

				index[i][0] = temp_index[0];
				index[i][1] = temp_index[1];
				index[i][2] = temp_index[2];
				index[i][3] = temp_index[3];
#ifdef USE_SSE
				temp_vec128[0] = _mm_load_ps(&original_v4[i*4 + 0]);
				temp_vec128[1] = _mm_load_ps(&original_v4[i*4 + 1]);
				temp_vec128[2] = _mm_load_ps(&original_v4[i*4 + 2]);
				temp_vec128[3] = _mm_load_ps(&original_v4[i*4 + 3]);

				temp_vec128[0] = _mm_sub_ps(temp_vec128[0], colour128[index[i][0]]);
				temp_vec128[1] = _mm_sub_ps(temp_vec128[1], colour128[index[i][1]]);
				temp_vec128[2] = _mm_sub_ps(temp_vec128[2], colour128[index[i][2]]);
				temp_vec128[3] = _mm_sub_ps(temp_vec128[3], colour128[index[i][3]]);

				temp_vec128[0] = _mm_mul_ps(temp_vec128[0], temp_vec128[0]);
				temp_vec128[1] = _mm_mul_ps(temp_vec128[1], temp_vec128[1]);
				temp_vec128[2] = _mm_mul_ps(temp_vec128[2], temp_vec128[2]);
				temp_vec128[3] = _mm_mul_ps(temp_vec128[3], temp_vec128[3]);

				temp_vec128[0] = _mm_hadd_ps(temp_vec128[0], temp_vec128[0]);
				temp_vec128[1] = _mm_hadd_ps(temp_vec128[1], temp_vec128[1]);
				temp_vec128[0] = _mm_hadd_ps(temp_vec128[0], temp_vec128[0]);
				temp_vec128[1] = _mm_hadd_ps(temp_vec128[1], temp_vec128[1]);
				temp_vec128[0] = _mm_unpacklo_ps(temp_vec128[0], temp_vec128[1]);

				temp_vec128[2] = _mm_hadd_ps(temp_vec128[2], temp_vec128[2]);
				temp_vec128[3] = _mm_hadd_ps(temp_vec128[3], temp_vec128[3]);
				temp_vec128[2] = _mm_hadd_ps(temp_vec128[2], temp_vec128[2]);
				temp_vec128[3] = _mm_hadd_ps(temp_vec128[3], temp_vec128[3]);
				temp_vec128[2] = _mm_unpacklo_ps(temp_vec128[2], temp_vec128[3]);

				temp_vec128[0] = _mm_shuffle_ps(temp_vec128[0], temp_vec128[2], 0 | (1 << 2) | (1 << 6));

				temp_vec128[0] = _mm_hadd_ps(temp_vec128[0], temp_vec128[0]);
				temp_vec128[0] = _mm_hadd_ps(temp_vec128[0], temp_vec128[0]);

				err += temp_vec128[0].m128_f32[0];
#else
				err += Vec3f32_LenSq(Vec3f32_Sub(colour[index[i][0]], original[i][0]));
				err += Vec3f32_LenSq(Vec3f32_Sub(colour[index[i][1]], original[i][1]));
				err += Vec3f32_LenSq(Vec3f32_Sub(colour[index[i][2]], original[i][2]));
				err += Vec3f32_LenSq(Vec3f32_Sub(colour[index[i][3]], original[i][3]));

#endif
				//if (err > best_error)
				//return err;
			}
		}
		err_endpoint[endpoint_type] = err;
#endif
	}
	if (err_endpoint[0] < err_endpoint[1])
	{
		DDS_BC1GeneratePalette(colour, has_alpha, 0, 0, is_bc23);
		*force_alpha = 0;
	}
	else
		*force_alpha = 1;

	*endpoint0 = colour[0];
	*endpoint1 = colour[1];

	//if (DEBUG_BLOCK)
		//printf("%5i %5i: best_err %f, colour %3.0f %3.0f %3.0f, %3.0f %3.0f %3.0f\n", (int)block_x, (int)block_y, err_endpoint[0] < err_endpoint[1] ? err_endpoint[0] : err_endpoint[1], colour[0].v[0], colour[0].v[1], colour[0].v[2], colour[1].v[0], colour[1].v[1], colour[1].v[2]);

	return err_endpoint[0] < err_endpoint[1] ? err_endpoint[0] : err_endpoint[1];
}

__forceinline int DDS_AreIndexesSame(int index[4][4])
{
	int same_count = 1;
	int i;
	for (i = 1; i < 16; i++)
		same_count += index[i/4][i%4] == index[0][0] ? 1 : 0;
	return same_count == 16 ? 1 : 0;
}

__forceinline int DDS_DoesCubeSphereIntersect(vec3f32_t C1, vec3f32_t C2, vec3f32_t S, float radius2)
{
	float dist_squared = radius2;

	if (S.v[0] < C1.v[0]) dist_squared -= (S.v[0] - C1.v[0])*(S.v[0] - C1.v[0]);
	else if (S.v[0] > C2.v[0]) dist_squared -= (S.v[0] - C2.v[0])*(S.v[0] - C2.v[0]);
	if (S.v[1] < C1.v[1]) dist_squared -= (S.v[1] - C1.v[1])*(S.v[1] - C1.v[1]);
	else if (S.v[1] > C2.v[1]) dist_squared -= (S.v[1] - C2.v[1])*(S.v[1] - C1.v[1]);
	if (S.v[2] < C1.v[2]) dist_squared -= (S.v[2] - C1.v[2])*(S.v[2] - C1.v[2]);
	else if (S.v[2] > C2.v[2]) dist_squared -= (S.v[2] - C2.v[2])*(S.v[2] - C1.v[2]);
	return dist_squared > 0;
}

__forceinline void DDS_ComputeBestEndpoints(int options, vec3f32_t eigen, float mins, float maxs, vec3f32_t mean, vec3f32_t *endpoints, vec3f32_t *endpoints_full_range)
{
	float distmin = -DDS_MAX_INIT_ERROR, distmax = DDS_MAX_INIT_ERROR;
	int i;
	for (i = 0; i < 3; i++)
	{
		if (eigen.v[i] != 0.0f)
			if (fabsf(-mean.v[i] / eigen.v[i]) < fabsf(distmin) && -mean.v[i] / eigen.v[i] <= 0.0f)
				distmin = -mean.v[i] / eigen.v[i];
		if (eigen.v[i] != 0.0f)
			if (fabsf((255.0f - mean.v[i]) / eigen.v[i]) < fabsf(distmax) && (255.0f - mean.v[i]) / eigen.v[i] >= 0.0f)
				distmax = (255.0f - mean.v[i]) / eigen.v[i];
	}
	for (i = 0; i < 3; i++)
	{
		if (eigen.v[i] != 0.0f)
			if (fabsf((255.0f - mean.v[i]) / eigen.v[i]) < fabsf(distmin) && (255.0f - mean.v[i]) / eigen.v[i] <= 0.0f)
				distmin = (255.0f - mean.v[i]) / eigen.v[i];
		if (eigen.v[i] != 0.0f)
			if (fabsf(-mean.v[i] / eigen.v[i]) < fabsf(distmax) && -mean.v[i] / eigen.v[i] >= 0.0f)
				distmax = -mean.v[i] / eigen.v[i];
	}
	// uber quality
	if (options & DDS_ENCODE_EXTEND_ENDPOINTS)
	{
		endpoints_full_range[0] = Vec3f32_Add(Vec3f32_Scale(eigen, distmin*5.0), mean);
		endpoints_full_range[1] = Vec3f32_Add(Vec3f32_Scale(eigen, distmax*5.0), mean);

		endpoints[0] = Vec3f32_ClampS(Vec3f32_Add(Vec3f32_Scale(eigen, distmin), mean), 0.0f, 255.0f);
		endpoints[1] = Vec3f32_ClampS(Vec3f32_Add(Vec3f32_Scale(eigen, distmax), mean), 0.0f, 255.0f);
	}
	else
	{
		endpoints_full_range[0] = Vec3f32_Add(Vec3f32_Scale(eigen, (distmin + mins * 3.0f) * 0.25f), mean);
		endpoints_full_range[1] = Vec3f32_Add(Vec3f32_Scale(eigen, (distmax + maxs * 3.0f) * 0.25f), mean);

		endpoints[0] = Vec3f32_ClampS(Vec3f32_Add(Vec3f32_Scale(eigen, (distmin + mins * 3.0f) * 0.25f), mean), 0.0f, 255.0f);
		endpoints[1] = Vec3f32_ClampS(Vec3f32_Add(Vec3f32_Scale(eigen, (distmax + maxs * 3.0f) * 0.25f), mean), 0.0f, 255.0f);
	}
}

__forceinline float DDS_RefineEndpoints(
	int options, 
	int is_single,
	uint8_t alpha_cutoff, 
	int is_bc23,
	int has_alpha,
	float *pixel4x4_rgba, 
	vec3f32_t original[4][4],
	float best_err,
	vec3f32_t eigen, 
	vec3f32_t *best_colour_base,
	vec3u8_t *best_endpoints_quantised,
	int *best_force_alpha,
	int index[4][4],
	int block_x, 
	int block_y)
{
	const int halfwidth_range = 1;
	int i;
	int j;
	int k;
	int i2;
	int j2;
	int k2;
	int mins[2][3];
	int maxs[2][3];
	int found_better;
	uchar3 pos[2];

	pos[0] = best_endpoints_quantised[0];
	pos[1] = best_endpoints_quantised[1];

	do
	{
		found_better = 0;

		mins[0][0] = MEMBER(pos[0], X) < halfwidth_range ? 0 : MEMBER(pos[0], X) - halfwidth_range;
		mins[0][1] = MEMBER(pos[0], Y) < halfwidth_range ? 0 : MEMBER(pos[0], Y) - halfwidth_range;
		mins[0][2] = MEMBER(pos[0], Z) < halfwidth_range ? 0 : MEMBER(pos[0], Z) - halfwidth_range;
		mins[1][0] = MEMBER(pos[1], X) < halfwidth_range ? 0 : MEMBER(pos[1], X) - halfwidth_range;
		mins[1][1] = MEMBER(pos[1], Y) < halfwidth_range ? 0 : MEMBER(pos[1], Y) - halfwidth_range;
		mins[1][2] = MEMBER(pos[1], Z) < halfwidth_range ? 0 : MEMBER(pos[1], Z) - halfwidth_range;

		maxs[0][0] = MEMBER(pos[0], X) + halfwidth_range > 31 ? 31 : MEMBER(pos[0], X) + halfwidth_range;
		maxs[0][1] = MEMBER(pos[0], Y) + halfwidth_range > 63 ? 63 : MEMBER(pos[0], Y) + halfwidth_range;
		maxs[0][2] = MEMBER(pos[0], Z) + halfwidth_range > 31 ? 31 : MEMBER(pos[0], Z) + halfwidth_range;
		maxs[1][0] = MEMBER(pos[1], X) + halfwidth_range > 31 ? 31 : MEMBER(pos[1], X) + halfwidth_range;
		maxs[1][1] = MEMBER(pos[1], Y) + halfwidth_range > 63 ? 63 : MEMBER(pos[1], Y) + halfwidth_range;
		maxs[1][2] = MEMBER(pos[1], Z) + halfwidth_range > 31 ? 31 : MEMBER(pos[1], Z) + halfwidth_range;

		if (DEBUG_BLOCK) printf("mins/maxs: (%i:%i %i:%i %i:%i) (%i:%i %i:%i %i:%i)\n", mins[0][0], maxs[0][0], mins[0][1], maxs[0][1], mins[0][2], maxs[0][2], mins[1][0], maxs[1][0], mins[1][1], maxs[1][1], mins[1][2], maxs[1][2]);
			
		for (i = mins[0][0]; i <= maxs[0][0]; i++)
			for (j = mins[0][1]; j <= maxs[0][1]; j++)
				for (k = mins[0][2]; k <= maxs[0][2]; k++)
					for (i2 = mins[1][0]; i2 <= maxs[1][0]; i2++)
						for (j2 = mins[1][1]; j2 <= maxs[1][1]; j2++)
							for (k2 = mins[1][2]; k2 <= maxs[1][2]; k2++)
							{
								uchar3 start;
								uchar3 end;
								float3 colour[4];

								start.v[0] = (uint8_t)i;
								start.v[1] = (uint8_t)j;
								start.v[2] = (uint8_t)k;
								end.v[0] = (uint8_t)i2;
								end.v[1] = (uint8_t)j2;
								end.v[2] = (uint8_t)k2;

								int local_force_alpha;
								float err = DDS_BC1FindBestIndexesLimited(pixel4x4_rgba, original, alpha_cutoff, has_alpha, eigen, best_err, 0.0f, 0.0f, 0, 0, 0, 0, start, end, &colour[0], &colour[1], &local_force_alpha, block_x, block_y, is_bc23);

								//if (DEBUG_BLOCK) printf("err %f (%2i %2i %2i, %2i %2i %2i) @ %3f %3f %3f, %3f %3f %3f\n", err, i, j, k, i2, j2, k2, MEMBER(colour[0], X), MEMBER(colour[0], Y), MEMBER(colour[0], Z), MEMBER(colour[1], X), MEMBER(colour[1], Y), MEMBER(colour[1], Z));
								if (err < best_err)
								{
									if (DEBUG_BLOCK) printf("best_err %f @ %3f %3f %3f, %3f %3f %3f\n", err, MEMBER(colour[0], X), MEMBER(colour[0], Y), MEMBER(colour[0], Z), MEMBER(colour[1], X), MEMBER(colour[1], Y), MEMBER(colour[1], Z));
									best_err = err;
									*best_force_alpha = local_force_alpha;
									best_colour_base[0] = colour[0];
									best_colour_base[1] = colour[1];
									best_endpoints_quantised[0] = start;
									best_endpoints_quantised[1] = end;
									found_better = 1;
									pos[0] = start;
									pos[1] = end;
								}
							}
		if (is_single)
			break;
	}while(found_better);
	return best_err;
}

__forceinline float DDS_WalkPath(
	int options, 
	uint8_t alpha_cutoff, 
	int is_bc23,
	int has_alpha,
	float *pixel4x4_rgba, 
	vec3f32_t original[4][4],
	float best_err,
	vec3f32_t eigen, 
	float mins, 
	float maxs, 
	vec3f32_t mean,
	vec3f32_t *best_colour_base,
	vec3u8_t *best_endpoints_quantised,
	int *best_force_alpha,
	int index[4][4],
	int block_x, 
	int block_y)
{
	vec3f32_t endpoints[2];
	vec3u8_t path_quantised[128];	// exhaustive searching gives a max count of 126 for 565
	vec3u8_t start_quantised;	
	vec3u8_t end_quantised;
	vec3f32_t colour[2];
	int i;
	int j;
	int di0;
	int di1;
	float minerr[2][128];
	float min_proj_err[128];
	int mincount[2][128];
	int minindexes[2][128][16];
	int line_count;
	vec3f32_t base_colour;
	vec3f32_t endpoints_full[2];
	int mode;
	vec3u8_t sample_pos[8][2];
	float sample_error[8];
	const int num_samples = 8;
	int max_samples = 0;
	int single_refine_step = 0;

	if ((options & ~DDS_ENCODE_TEST) == DDS_QUALITY_HIGH)
		max_samples = 3;
	else if ((options & ~DDS_ENCODE_TEST) == DDS_QUALITY_BEST)
		max_samples = 8;

	for (i = 0; i < num_samples; i++)
	{
		sample_error[i] = DDS_MAX_INIT_ERROR;
		sample_pos[i][0] = Vec3u8_Vec(0,0,0);
		sample_pos[i][1] = Vec3u8_Vec(0,0,0);
	}

	DDS_ComputeBestEndpoints(options, eigen, mins, maxs, mean, endpoints, endpoints_full);

	DDS_RoundEndpointsToRGB565(endpoints);

	endpoints_full[0].v[0] = (float)((int)(31 * (endpoints_full[0].v[0] + 4.0f)) / 255);
	endpoints_full[0].v[1] = (float)((int)(63 * (endpoints_full[0].v[1] + 2.0f)) / 255);
	endpoints_full[0].v[2] = (float)((int)(31 * (endpoints_full[0].v[2] + 4.0f)) / 255);

	endpoints_full[1].v[0] = (float)((int)(31 * (endpoints_full[1].v[0] + 4.0f)) / 255);
	endpoints_full[1].v[1] = (float)((int)(63 * (endpoints_full[1].v[1] + 2.0f)) / 255);
	endpoints_full[1].v[2] = (float)((int)(31 * (endpoints_full[1].v[2] + 4.0f)) / 255);

	//printf("%f %f %f -> %f %f %f\n", endpoints_full[0].v[0], endpoints_full[0].v[1], endpoints_full[0].v[2], endpoints_full[1].v[0], endpoints_full[1].v[1], endpoints_full[1].v[2]);

	start_quantised = Vec3f32_ToVec3u8(endpoints[0]);
	end_quantised = Vec3f32_ToVec3u8(endpoints[1]);

	if (DEBUG_BLOCK)
	{
		//printf("path from %3f %3f %3f to %3f %3f %3f\n", endpoints_full[0].v[0], endpoints_full[0].v[1], endpoints_full[0].v[2], endpoints_full[1].v[0], endpoints_full[1].v[1], endpoints_full[1].v[2]);
	}

	for (mode = 1; mode < 2; mode++)
	{
		// TODO: sort both of these and eliminate duplicates between the two sets
		if (mode == 0)
			line_count = DDS_BresenhamPath16BitVisitAllClamp(path_quantised, endpoints_full[0], endpoints_full[1]);
		else
			line_count = DDS_BresenhamPath16BitVisitAll(path_quantised, start_quantised, end_quantised);

		if (DEBUG_BLOCK)
		{
			for (i = 0; i < line_count; i++)
			{
				base_colour = DDS_UnpackVec3u8QuantisedToVec3f32(path_quantised[i]);
				printf("path %3i %3.0f %3.0f %3.0f\n", i, base_colour.v[0], base_colour.v[1], base_colour.v[2]);
			}
		}


		if (DEBUG_BLOCK)
		{
			//for (i = 0; i < line_count; i++)
			//	printf("[%3i]: %3u %3u %3u\n", i, path_quantised[i].v[0], path_quantised[i].v[1], path_quantised[i].v[2]);
		}

		base_colour = DDS_UnpackVec3u8QuantisedToVec3f32(path_quantised[0]);

		for (i = 0; i < line_count; i++)
		{
			float local_err = 0.0f;
			int count[2] = {0};
			int rcount[2] = {0};

			colour[0] = DDS_UnpackVec3u8QuantisedToVec3f32(path_quantised[i]);

			for (j = 0; j < 16; j++)
			{
				vec3f32_t tvec = Vec3f32_Sub(original[j/4][j%4], colour[0]);
				if (Vec3f32_Dot(tvec, eigen) < 0.0f)
				{
					if (pixel4x4_rgba[j*4 + 3] >= alpha_cutoff)
					{
						local_err += Vec3f32_Dot(tvec, tvec);
						minindexes[0][i][rcount[0]] = j;
						rcount[0]++;
					}
					count[0]++;
				}
			}

			minerr[0][i] = local_err;
			mincount[0][i] = rcount[0];

			local_err = 0.0f;

			for (j = 0; j < 16; j++)
			{
				vec3f32_t tvec = Vec3f32_Sub(original[j/4][j%4], colour[0]);
				if (Vec3f32_Dot(tvec, eigen) >= 0.0f)
				{
					if (pixel4x4_rgba[j*4 + 3] >= alpha_cutoff)
					{
						local_err += Vec3f32_Dot(tvec, tvec);
						minindexes[1][i][rcount[1]] = j;
						rcount[1]++;
					}
					count[1]++;
				}
			}

			minerr[1][i] = local_err;
			mincount[1][i] = rcount[1];

			local_err = 0.0f;

#ifdef PREFIX_SUM_ERROR
			for (j = 0; j < 16; j++)
			{
				vec3f32_t tvec = Vec3f32_Sub(original[j/4][j%4], colour[0]);
				if (Vec3f32_Dot(tvec, eigen) <= 0.0f)
				{
					if (!has_alpha || pixel4x4_rgba[j*4 + 3] >= alpha_cutoff)
					{
						vec3f32_t temp_vec = Vec3f32_Sub(original[j/4][j%4], base_colour);
						temp_vec = Vec3f32_Sub(temp_vec, Vec3f32_Scale(eigen, Vec3f32_Dot(temp_vec, eigen)));
						local_err += Vec3f32_Dot(temp_vec, temp_vec);
					}
				}
			}
			min_proj_err[i] = local_err;
#endif

			if (count[0] == 16)
				minerr[0][i] = DDS_MAX_INIT_ERROR;
			if (count[1] == 16)
				minerr[1][i] = DDS_MAX_INIT_ERROR;
		}

		for (di0 = 0; di0 < line_count; di0++)
		{
			float line_best_err = DDS_MAX_INIT_ERROR;
			int line_best_endpoint = 0;
#if 0
			if ((options & ~DDS_ENCODE_TEST) == options)
				if (minerr[0][di0] > best_err)
					break;
#endif
			for (di1 = di0; di1 < line_count; di1++)
				//for (di1 = line_count - 1; di1 >= di0; di1--) // this is actually slightly slower, even though it enables us to break instead of continue
			{
				int local_force_alpha = 0;
				float err;

				//if ((options & ~DDS_ENCODE_TEST) == options)
#if 0
#ifdef PREFIX_SUM_ERROR
					//if (minerr[0][di0] + minerr[1][di1] + min_proj_err[di1] - min_proj_err[di0] > best_err)
						//continue;
#else
					//if (minerr[0][di0] + minerr[1][di1] > best_err)
						//continue;
#endif
#endif
				//if (1)
					//err = DDS_BC1FindBestIndexesLimited(pixel4x4_rgba, original, alpha_cutoff, has_alpha,  eigen, best_err,  minerr[0][di0],  minerr[1][di1],  mincount[0][di0], mincount[1][di1], minindexes[0][di0],  minindexes[1][di1], path_quantised[di0], path_quantised[di1], &colour[0], &colour[1], &local_force_alpha, block_x, block_y, is_bc23);  
				if (1)
				{
					err = DDS_BC1FindBestIndexesLimited(pixel4x4_rgba, original, alpha_cutoff, has_alpha,  eigen, best_err,  0.0, 0.0,  0, 0, 0,  0, path_quantised[di0], path_quantised[di1], &colour[0], &colour[1], &local_force_alpha, block_x, block_y, is_bc23);  
					//if (DEBUG_BLOCK)
						//printf("path %3u %3u %3u, %3u %3u %3u, err: %f vs %f\n", path_quantised[di0].v[0], path_quantised[di0].v[1], path_quantised[di0].v[2], path_quantised[di1].v[0], path_quantised[di1].v[1], path_quantised[di1].v[2], err, best_err);
				}
				else // this is "extreme" mode and is VERY slow on problem images for only maybe 0.1% MSE reduction, approximately 100x slower than "best" mode
				{
					local_force_alpha = 0;
					vec3u8_t local_endpoints_quantised[2];

					local_endpoints_quantised[0] = path_quantised[di0];
					local_endpoints_quantised[1] = path_quantised[di1];

					err = DDS_RefineEndpoints(g_system.opts.dds_quality, 0, alpha_cutoff, is_bc23, has_alpha, pixel4x4_rgba, original, best_err, eigen, colour, local_endpoints_quantised, &local_force_alpha, index, block_x, block_y);
				}

				if (DEBUG_BLOCK && MEMBER(path_quantised[di1], X) == 15 && MEMBER(path_quantised[di1], Y) == 33 && MEMBER(path_quantised[di1], Z) == 16)printf("TEST SAMPLE ERR: %f\n", err);
				if (err < line_best_err)
				{
					line_best_err = err;
					line_best_endpoint = di1;
				}

				if (err < best_err)
				{
					if (DDS_GROUND_TRUTH)
					{
						printf("%5i: block %5i %5i, ************THIS SHOULD NOT HAPPEN************* %f vs %f\n", __LINE__, block_x, block_y, err, best_err);
						printf("%3.0f %3.0f %3.0f, %3.0f %3.0f %3.0f\n", colour[0].v[0], colour[0].v[1], colour[0].v[2], colour[1].v[0], colour[1].v[1], colour[1].v[2]);
					}
					best_err = err;
					best_colour_base[0] = colour[0];
					best_colour_base[1] = colour[1];
					best_endpoints_quantised[0] = path_quantised[di0];
					best_endpoints_quantised[1] = path_quantised[di1];
					*best_force_alpha = local_force_alpha;
				}
			}

			for (i = 0; i < num_samples; i++)
			{
				if (line_best_err < sample_error[i])
				{
					for (j = num_samples - 1; j > i; j--)
					{
						sample_error[j] = sample_error[j - 1];
						sample_pos[j][0] = sample_pos[j - 1][0];
						sample_pos[j][1] = sample_pos[j - 1][1];
					}
					sample_error[i] = line_best_err;
					sample_pos[i][0] = path_quantised[di0];
					sample_pos[i][1] = path_quantised[line_best_endpoint];
					break;
				}
			}
		}
	}
	for (i = 0; i < max_samples; i++)
	{
		int local_force_alpha;
		if (DEBUG_BLOCK)printf("sample pos: %2i %2i %2i, %2i %2i %2i, %f\n", MEMBER(sample_pos[i][0], X), MEMBER(sample_pos[i][0], Y), MEMBER(sample_pos[i][0], Z), MEMBER(sample_pos[i][1], X), MEMBER(sample_pos[i][1], Y), MEMBER(sample_pos[i][1], Z), sample_error[i]);
		float err = DDS_RefineEndpoints(g_system.opts.dds_quality, single_refine_step, alpha_cutoff, is_bc23, has_alpha, pixel4x4_rgba, original, best_err, eigen, colour, sample_pos[i], &local_force_alpha, index, block_x, block_y);
		//printf("\t%3.0f %3.0f %3.0f -> %3.0f %3.0f %3.0f = %f -> %f\n", base_colour.v[0], base_colour.v[1], base_colour.v[2], end_colour.v[0], end_colour.v[1], end_colour.v[2], sample_error[i], err);
		if (err < best_err)
		{
			best_err = err;
			best_colour_base[0] = colour[0];
			best_colour_base[1] = colour[1];
			best_endpoints_quantised[0] = sample_pos[i][0];
			best_endpoints_quantised[1] = sample_pos[i][1];
			*best_force_alpha = local_force_alpha;
		}
	}
	return best_err;
}

__forceinline void DDS_PrintEncoding(
	float *pixel4x4_rgba, 
	vec3f32_t original[4][4], 
	vec3f32_t *colour,
	uint8_t alpha_cutoff,
	int is_bc23,
	int has_alpha,
	int force_alpha,
	int block_x,
	int block_y)
{
	uint16_t packed_colour[2];
	vec3f32_t local_colour[4];
	int index[4][4];
	float err;

	local_colour[0] = colour[0];
	local_colour[1] = colour[1];

	DDS_BC1GeneratePalette(local_colour, has_alpha, packed_colour, force_alpha, is_bc23);

	err = DDS_BC1FindBestIndexes(
		pixel4x4_rgba,
		original,
		has_alpha,
		alpha_cutoff,
		local_colour,
		index);

	printf("block %5i %5i err: %f\n", block_x, block_y, err);
	printf("%3f %3f %3f\n", local_colour[0].v[0], local_colour[0].v[1], local_colour[0].v[2]);
	printf("%3f %3f %3f\n", local_colour[1].v[0], local_colour[1].v[1], local_colour[1].v[2]);
	printf("%3f %3f %3f\n", local_colour[2].v[0], local_colour[2].v[1], local_colour[2].v[2]);
	printf("%3f %3f %3f\n", local_colour[3].v[0], local_colour[3].v[1], local_colour[3].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[0][0]].v[0], (uint8_t)local_colour[index[0][0]].v[1], (uint8_t)local_colour[index[0][0]].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[0][1]].v[0], (uint8_t)local_colour[index[0][1]].v[1], (uint8_t)local_colour[index[0][1]].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[0][2]].v[0], (uint8_t)local_colour[index[0][2]].v[1], (uint8_t)local_colour[index[0][2]].v[2]);
	printf("%3u %3u %3u, %i %i %i %i\n", (uint8_t)local_colour[index[0][3]].v[0], (uint8_t)local_colour[index[0][3]].v[1], (uint8_t)local_colour[index[0][3]].v[2], index[0][0], index[0][1], index[0][2], index[0][3]);
	//printf("(%f %f %f %f)\n", Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[0][0]], original[0][0])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[0][1]], original[0][1])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[0][2]], original[0][2])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[0][3]], original[0][3])));
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[1][0]].v[0], (uint8_t)local_colour[index[1][0]].v[1], (uint8_t)local_colour[index[1][0]].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[1][1]].v[0], (uint8_t)local_colour[index[1][1]].v[1], (uint8_t)local_colour[index[1][1]].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[1][2]].v[0], (uint8_t)local_colour[index[1][2]].v[1], (uint8_t)local_colour[index[1][2]].v[2]);
	printf("%3u %3u %3u, %i %i %i %i\n", (uint8_t)local_colour[index[1][3]].v[0], (uint8_t)local_colour[index[1][3]].v[1], (uint8_t)local_colour[index[1][3]].v[2], index[1][0], index[1][1], index[1][2], index[1][3]);
	//printf("(%f %f %f %f)\n", Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[1][0]], original[1][0])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[1][1]], original[1][1])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[1][2]], original[1][2])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[0][3]], original[0][3])));
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[2][0]].v[0], (uint8_t)local_colour[index[2][0]].v[1], (uint8_t)local_colour[index[2][0]].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[2][1]].v[0], (uint8_t)local_colour[index[2][1]].v[1], (uint8_t)local_colour[index[2][1]].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[2][2]].v[0], (uint8_t)local_colour[index[2][2]].v[1], (uint8_t)local_colour[index[2][2]].v[2]);
	printf("%3u %3u %3u, %i %i %i %i\n", (uint8_t)local_colour[index[2][3]].v[0], (uint8_t)local_colour[index[2][3]].v[1], (uint8_t)local_colour[index[2][3]].v[2], index[2][0], index[2][1], index[2][2], index[2][3]);
	//printf("(%f %f %f %f)\n", Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[2][0]], original[2][0])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[2][1]], original[2][1])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[2][2]], original[2][2])), Vec3f32_LenSq(Vec3f32_Sub(local_colour[index[0][3]], original[0][3])));
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[3][0]].v[0], (uint8_t)local_colour[index[3][0]].v[1], (uint8_t)local_colour[index[3][0]].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[3][1]].v[0], (uint8_t)local_colour[index[3][1]].v[1], (uint8_t)local_colour[index[3][1]].v[2]);
	printf("%3u %3u %3u, ", (uint8_t)local_colour[index[3][2]].v[0], (uint8_t)local_colour[index[3][2]].v[1], (uint8_t)local_colour[index[3][2]].v[2]);
	printf("%3u %3u %3u, %i %i %i %i\n", (uint8_t)local_colour[index[3][3]].v[0], (uint8_t)local_colour[index[3][3]].v[1], (uint8_t)local_colour[index[3][3]].v[2], index[3][0], index[3][1], index[3][2], index[3][3]);
}

__forceinline float DDS_BestSolidColour(
	uint8_t alpha_cutoff, 
	int is_bc23,
	int has_alpha,
	float *pixel4x4_rgba, 
	vec3f32_t original[4][4],
	vec3f32_t mean,
	float best_err,
	vec3f32_t *best_colour_base,
	int *best_force_alpha,
	int index[4][4],
	int block_x, 
	int block_y)
{
	int (*map_ptr[2])[256][2][4];
	int map_count = (has_alpha || is_bc23) ? 1 : 2;
	int map_index[2];
	int index_range[3][3];
	int map_mode;
	int i;
	int j;
	int k;

	if (is_bc23)
	{
		map_index[0] = 0;
	}
	else
	{
		map_index[0] = 1;
		map_index[1] = 0;
	}

	map_ptr[0] = &g_dds_bestfitmap5;
	map_ptr[1] = &g_dds_bestfitmap6;

	for (map_mode = 0; map_mode < map_count; map_mode++)
	{
		index_range[0][1] = (int)floorf(mean.v[0] + 0.5f);
		index_range[1][1] = (int)floorf(mean.v[1] + 0.5f);
		index_range[2][1] = (int)floorf(mean.v[2] + 0.5f);

		index_range[0][0] = (*map_ptr[0])[index_range[0][1]][map_index[map_mode]][2];
		index_range[0][2] = (*map_ptr[0])[index_range[0][1]][map_index[map_mode]][3];

		index_range[1][0] = (*map_ptr[1])[index_range[1][1]][map_index[map_mode]][2];
		index_range[1][2] = (*map_ptr[1])[index_range[1][1]][map_index[map_mode]][3];

		index_range[2][0] = (*map_ptr[0])[index_range[2][1]][map_index[map_mode]][2];
		index_range[2][2] = (*map_ptr[0])[index_range[2][1]][map_index[map_mode]][3];

		if (DDS_DEBUG_BLOCK)
			printf("map indexes %i:\n     %3i %3i %3i\n     %3i %3i %3i\n     %3i %3i %3i\n", map_mode
				, index_range[0][0], index_range[0][1], index_range[0][2]
				, index_range[1][0], index_range[1][1], index_range[1][2]
				, index_range[2][0], index_range[2][1], index_range[2][2]);

		for (i = 0; i < 3; i++)
			for (j = 0; j < 3; j++)
				for (k = 0; k < 3; k++)
				{
					vec3u8_t endpointu8[2];
					vec3f32_t colour[4];
					uint16_t packed_colour[2];
					float err;

					endpointu8[0] = Vec3u8_Vec(	(uint8_t)(*map_ptr[0])[index_range[0][i]][map_index[map_mode]][0], 
						(uint8_t)(*map_ptr[1])[index_range[1][j]][map_index[map_mode]][0], 
						(uint8_t)(*map_ptr[0])[index_range[2][k]][map_index[map_mode]][0]);

					endpointu8[1] = Vec3u8_Vec(	(uint8_t)(*map_ptr[0])[index_range[0][i]][map_index[map_mode]][1], 
						(uint8_t)(*map_ptr[1])[index_range[1][j]][map_index[map_mode]][1], 
						(uint8_t)(*map_ptr[0])[index_range[2][k]][map_index[map_mode]][1]);

					colour[0] = DDS_UnpackVec3u8QuantisedToVec3f32(endpointu8[0]);
					colour[1] = DDS_UnpackVec3u8QuantisedToVec3f32(endpointu8[1]);

					DDS_BC1GeneratePalette(colour, has_alpha, packed_colour, map_index[map_mode], is_bc23);

					err = DDS_BC1FindBestIndexes(pixel4x4_rgba, original, has_alpha, alpha_cutoff, colour, index);

					if (DDS_DEBUG_BLOCK)
					{
						printf("solid colour %i %5i %5i, %i %i %i: %3u %3u %3u, %3u %3u %3u (%f vs %f = %f)\n", __LINE__, block_x, block_y, i, j, k, (int)colour[0].v[0], (int)colour[0].v[1], (int)colour[0].v[2], (int)colour[1].v[0], (int)colour[1].v[1], (int)colour[1].v[2], err, best_err, best_err - err);
						DDS_PrintEncoding(pixel4x4_rgba, original, colour,alpha_cutoff,is_bc23,has_alpha,0,block_x,block_y);
					}

					if (err < best_err)
					{
						best_err = err;

						best_colour_base[0] = colour[0];
						best_colour_base[1] = colour[1];
						*best_force_alpha = map_index[map_mode];
					}
				}
	}
	return best_err;
}

__forceinline float DDS_ComputeGlobalMinimum(	
	int options, 
	uint8_t alpha_cutoff, 
	int is_bc23,
	int has_alpha,
	float *pixel4x4_rgba, 
	vec3f32_t original[4][4],
	vec3f32_t mean,
	float best_err,
	vec3f32_t *best_colour_base,
	int *best_force_alpha,
	int block_x, 
	int block_y)
{
	int local_force_alpha = 0;
	int sx;
	int i;
	float radius2 = 0.0f;
	for (i = 0; i < 16; i++)
	{
		radius2 = Math_Maxf32(Math_Maxf32(Vec3f32_LenSq(Vec3f32_Sub(original[i/4][i%4], mean)), radius2), 48.0);
	}
	for (sx = 0; sx < 32; sx++)
	{
		int sy;

		//			printf("%2i / %2i\n", sx, 32);
		//#pragma omp parallel for private(sy) private(local_index) private(local_force_alpha)
		for (sy = 0; sy < 64; sy++)
		{
			for (int sz = 0; sz < 32; sz++)
				for (int ex = 0; ex < 32; ex++)
				{
					vec3f32_t C1;
					vec3f32_t C2;
					vec3f32_t start;
					vec3f32_t end;
					vec3u8_t start_quantised;
					vec3u8_t end_quantised;

					start_quantised = Vec3u8_Vec((uint8_t)sx, (uint8_t)sy, (uint8_t)sz);
					end_quantised = Vec3u8_Vec((uint8_t)ex, (uint8_t)0, (uint8_t)0);

					start = DDS_UnpackVec3u8QuantisedToVec3f32(start_quantised);
					end = DDS_UnpackVec3u8QuantisedToVec3f32(end_quantised);

					C1.v[0] = Math_Minf32(start.v[0], end.v[0]);
					C1.v[1] = 0;
					C1.v[2] = 0;
					C2.v[0] = Math_Maxf32(start.v[0], end.v[0]);
					C2.v[1] = 255;
					C2.v[2] = 255;
					if (!DDS_DoesCubeSphereIntersect(C1, C2, mean, radius2))
					{
						//InterlockedIncrement64(&n_skipped2048);
						continue;
					}

					for (int ey = 0; ey < 64; ey++)
					{
						vec3f32_t C1;
						vec3f32_t C2;
						vec3f32_t start;
						vec3f32_t end;
						vec3u8_t start_quantised;
						vec3u8_t end_quantised;

						start_quantised = Vec3u8_Vec((uint8_t)sx, (uint8_t)sy, (uint8_t)sz);
						end_quantised = Vec3u8_Vec((uint8_t)ex, (uint8_t)ey, (uint8_t)0);

						start = DDS_UnpackVec3u8QuantisedToVec3f32(start_quantised);
						end = DDS_UnpackVec3u8QuantisedToVec3f32(end_quantised);

						C1.v[0] = Math_Minf32(start.v[0], end.v[0]);
						C1.v[1] = Math_Minf32(start.v[1], end.v[1]);
						C1.v[2] = 0;
						C2.v[0] = Math_Maxf32(start.v[0], end.v[0]);
						C2.v[1] = Math_Maxf32(start.v[1], end.v[1]);
						C2.v[2] = 255;
						if (!DDS_DoesCubeSphereIntersect(C1, C2, mean, radius2))
						{
							//InterlockedIncrement64(&n_skipped32);
							continue;
						}

						for (int ez = 0; ez < 32; ez++)
						{
							start_quantised = Vec3u8_Vec((uint8_t)sx, (uint8_t)sy, (uint8_t)sz);
							end_quantised = Vec3u8_Vec((uint8_t)ex, (uint8_t)ey, (uint8_t)ez);

							vec3f32_t start;
							vec3f32_t end;
							vec3f32_t dir;
							float lensq = 0.0f;
							vec3f32_t colour[4];

							start = DDS_UnpackVec3u8QuantisedToVec3f32(start_quantised);
							end = DDS_UnpackVec3u8QuantisedToVec3f32(end_quantised);

							dir = Vec3f32_Sub(end, start);
							dir = Vec3f32_Normalise(dir);

							for (int i = 0; i < 16; i++)
							{
								vec3f32_t temp_vec = Vec3f32_Sub(original[i/4][i%4], start);
								temp_vec = Vec3f32_Sub(temp_vec, Vec3f32_Scale(dir, Vec3f32_Dot(temp_vec, dir)));
								//lensq += Vec3f32_Dot(temp_vec, temp_vec);
								lensq += Math_Maxf32(Vec3f32_Dot(temp_vec, temp_vec) - 0.75f, 0.0f);
							}
							if (lensq >= best_err)
							{
								//InterlockedIncrement64(&n_skipped);
								continue;
							}

							colour[0] = start;
							colour[1] = end;

							float err = DDS_BC1FindBestIndexesLimited(pixel4x4_rgba, original, alpha_cutoff, has_alpha, dir, best_err, 0.0f, 0.0f, 0, 0, 0, 0, start_quantised, end_quantised, &colour[0], &colour[1], &local_force_alpha, block_x, block_y, is_bc23);

							//if (err < local_best_err && !DDS_AreIndexesSame(local_index))
							if (err < best_err)
							{
								best_err = err;

								best_err = err;
								*best_force_alpha = local_force_alpha;
								best_colour_base[0] = colour[0];
								best_colour_base[1] = colour[1];
								if (DDS_DEBUG_BLOCK)
								{
									printf("Exhaustive results (err %f):\n", best_err);
									DDS_PrintEncoding(pixel4x4_rgba, original, colour,alpha_cutoff,is_bc23,has_alpha,*best_force_alpha,block_x,block_y);
								}
							}
						}
					}
				}
		}
	}
	return best_err;
}

__forceinline void DDS_UpdateParameters(
	float *pixel4x4_rgba, 
	vec3f32_t original[4][4], 
	uint8_t alpha_cutoff,
	int is_bc23,
	int has_alpha,
	char *name, 
	float *best_err, 
	int *best_force_alpha, 
	vec3f32_t *best_colour_base, 
	vec3u8_t *best_endpoints_quantised, 
	float err,
	vec3f32_t *colour, 
	vec3u8_t *local_endpoints_quantised, 
	int local_best_alpha,
	int block_x,
	int block_y)
{
	if (err < *best_err)
	{
		*best_err = err;
		best_colour_base[0] = colour[0];
		best_colour_base[1] = colour[1];
		if (best_endpoints_quantised && local_endpoints_quantised)
		{
			best_endpoints_quantised[0] = local_endpoints_quantised[0];
			best_endpoints_quantised[1] = local_endpoints_quantised[1];
		}
		*best_force_alpha = local_best_alpha;

		if (DEBUG_BLOCK)
		{
			printf("%s results (err %f):\n", name ? name : "<UNKNOWN>", *best_err);
			DDS_PrintEncoding(pixel4x4_rgba, original, colour,alpha_cutoff,is_bc23,has_alpha,*best_force_alpha,block_x,block_y);
		}
	}
}

__forceinline float DDS_BestFitAxes(
	uint8_t alpha_cutoff, 
	int is_bc23,
	int has_alpha,
	float *pixel4x4_rgba, 
	vec3f32_t original[4][4],
	vec3f32_t mean,
	float best_err,
	vec3f32_t *best_colour_base,
	int *best_force_alpha,
	vec3u8_t *best_endpoints_quantised,
	int block_x, 
	int block_y)
{
	int i;
	int j;
	int best_endpoint[3] = {0};
	int meansi[3];
	float best_index_err[3] = {DDS_MAX_INIT_ERROR, DDS_MAX_INIT_ERROR, DDS_MAX_INIT_ERROR};
	int index[4][4];
	int k;

	meansi[0] = (int)mean.v[0];
	meansi[1] = (int)mean.v[1];
	meansi[2] = (int)mean.v[2];

	for (i = 0; i < 3; i++)
	{
		// TODO: what does this do?
		for (j = (meansi[i] - 2 < 0 ? 0 : meansi[i] - 2); j < (meansi[i] + 2 > 255 ? 255 : meansi[i] + 2); j++) // less range gives better results
		{
			int m;
			float c[4];
			float err = 0.0f;

			if (i == 1)
			{
				if (g_dds_round6[j][0] == -1)
					continue;
				c[0] = (float)((g_dds_round6[j][0] << 2) | (g_dds_round6[j][0] >> 4));
				c[1] = (float)((g_dds_round6[j][1] << 2) | (g_dds_round6[j][1] >> 4));
			}
			else
			{
				if (g_dds_round5[j][0] == -1)
					continue;
				c[0] = (float)((g_dds_round5[j][0] << 3) | (g_dds_round5[j][0] >> 2));
				c[1] = (float)((g_dds_round5[j][1] << 3) | (g_dds_round5[j][1] >> 2));
			}
			if (has_alpha)
			{
				c[2] = (c[0] + c[1]) / 2.0f;
				c[3] = DDS_MAX_INIT_ERROR;
			}
			else
			{
				c[2] = c[0] + (c[1] - c[0]) / 3.0f;
				c[3] = c[0] + 2.0f * (c[1] - c[0]) / 3.0f;
			}
			c[2] = floorf(c[2] + 0.5f);
			c[3] = floorf(c[3] + 0.5f);
			for (k = 0; k < 16; k++)
			{
				float local_error = DDS_MAX_INIT_ERROR;
				for (m = 0; m < 4; m++)
				{
					float dist = (original[k/4][k%4].v[i] - c[m])*(original[k/4][k%4].v[i] - c[m]);
					if (dist < local_error)
						local_error = dist;
				}
				err += local_error;
			}

			if (i == 1)
			{
				if ((err < best_index_err[i]) || ((err == best_index_err[i]) && (g_dds_round6[j][0] == g_dds_round6[j][1])))
				{
					best_index_err[i] = err;
					best_endpoint[i] = j;
				}
			}
			else
			{
				if ((err < best_index_err[i]) || ((err == best_index_err[i]) && (g_dds_round5[j][0] == g_dds_round5[j][1])))
				{
					best_index_err[i] = err;
					best_endpoint[i] = j;
				}
			}
		}
	}

	// TODO: what does this do? it works but how?

	for (i = 0; i < 2; i++)
		for (j = 0; j < 2; j++)
		{
			for (k = 0; k < 2; k++)
			{
				vec3u8_t endpointsu8[2];
				vec3f32_t colour[4];
				uint16_t packed_colour[2];
				float err;

				endpointsu8[0] = Vec3u8_Vec((uint8_t)g_dds_round5[best_endpoint[0]][i], (uint8_t)g_dds_round6[best_endpoint[1]][j], (uint8_t)g_dds_round5[best_endpoint[2]][k]);
				endpointsu8[1] = Vec3u8_Vec((uint8_t)g_dds_round5[best_endpoint[0]][(i + 1) % 2], (uint8_t)g_dds_round6[best_endpoint[1]][(j + 1) % 2], (uint8_t)g_dds_round5[best_endpoint[2]][(k + 1) % 2]);

				colour[0] = DDS_UnpackVec3u8QuantisedToVec3f32(endpointsu8[0]);
				colour[1] = DDS_UnpackVec3u8QuantisedToVec3f32(endpointsu8[1]);

				DDS_BC1GeneratePalette(colour, has_alpha, packed_colour, 0, is_bc23);

				err = DDS_BC1FindBestIndexes(pixel4x4_rgba, original, has_alpha, alpha_cutoff, colour, index);

				if (err < best_err)
				{
					best_err = err;
					best_colour_base[0] = colour[0];
					best_colour_base[1] = colour[1];
					best_endpoints_quantised[0] = endpointsu8[0];
					best_endpoints_quantised[1] = endpointsu8[1];
					*best_force_alpha = has_alpha;
				}
			}
		}
	return best_err;
}

void DDS_ComputeSphereMapping(
	uint8_t *block, 
	vec3f32_t original[4][4],
	float best_err,
	vec3f32_t eigen,
	float mins,
	float maxs,
	vec3f32_t meanf,
	int block_x,
	int block_y)
{
#ifndef EXHAUSTIVE_EXTENDED // MSE: 5.357476 on 256x144halfblurredgradient_constantgreen.bmp
	int i;
	int j;
	vec3f32_t colour[2];
	int sphere_i;
	int best_sphere_index = 0;
	int is_best = 0;
	int index16[16];
	int best_colour_rgb24[3];
	float old_best_err = best_err;
	vec3u8_t path_quantised[128];	// exhaustive searching gives a max count of 126 for 565
	vec3u8_t start_quantised;	
	vec3u8_t end_quantised;
	int line_count;
	vec3f32_t endpoints[2];

	endpoints[0] = Vec3f32_ClampS(Vec3f32_Add(Vec3f32_Scale(eigen, mins), meanf), 0.0f, 255.0f);
	endpoints[1] = Vec3f32_ClampS(Vec3f32_Add(Vec3f32_Scale(eigen, maxs), meanf), 0.0f, 255.0f);

	// TODO: we should actually use variance / quantiles or similar, because there might be a cluster of data with just two extreme points
	// TODO: calculate minimum error that we can achieve like in the previous location where we use Bresenham's algorithm
	if (Vec3f32_LenSq(Vec3f32_Sub(endpoints[0], endpoints[1])) > 32.0f * 32.0f * 3.0f)
		return;

	start_quantised = Vec3u8_Vec(
		(uint8_t)endpoints[0].v[0], 
		(uint8_t)endpoints[0].v[1], 
		(uint8_t)endpoints[0].v[2]);
	end_quantised = Vec3u8_Vec(
		(uint8_t)endpoints[1].v[0], 
		(uint8_t)endpoints[1].v[1], 
		(uint8_t)endpoints[1].v[2]);

	// as long as this has less range than 565, it'll be less than 126 points
	line_count = DDS_BresenhamPath16BitVisitAll(path_quantised, start_quantised, end_quantised);
	//printf("line count: %i\n", line_count);

	if (DDS_DEBUG_BLOCK)
		printf("block %5i %5i, line count %i, from %3u %3u %3u to %3u %3u %3u\n", block_x, block_y, line_count, start_quantised.v[0], start_quantised.v[1], start_quantised.v[2], end_quantised.v[0], end_quantised.v[1], end_quantised.v[2]);


	for (i = 0; i < line_count; i++)
		for (j = i; j < line_count; j++)
		{
			int diff[3];
			int twiddle_mins[2][3];
			int twiddle_maxs[2][3];
			int source[3];
			int target[3];
#ifdef SPHERE_TWIDDLE
			twiddle_mins[0][0] = path_quantised[i].v[0] > 0 ? path_quantised[i].v[0] - 1 : 0;
			twiddle_mins[0][1] = path_quantised[i].v[1] > 0 ? path_quantised[i].v[1] - 1 : 0;
			twiddle_mins[0][2] = path_quantised[i].v[2] > 0 ? path_quantised[i].v[2] - 1 : 0;

			twiddle_mins[1][0] = path_quantised[j].v[0] > 0 ? path_quantised[j].v[0] - 1 : 0;
			twiddle_mins[1][1] = path_quantised[j].v[1] > 0 ? path_quantised[j].v[1] - 1 : 0;
			twiddle_mins[1][2] = path_quantised[j].v[2] > 0 ? path_quantised[j].v[2] - 1 : 0;

			twiddle_maxs[0][0] = path_quantised[i].v[0] < 255 ? path_quantised[i].v[0] + 1 : 0;
			twiddle_maxs[0][1] = path_quantised[i].v[1] < 255 ? path_quantised[i].v[1] + 1 : 0;
			twiddle_maxs[0][2] = path_quantised[i].v[2] < 255 ? path_quantised[i].v[2] + 1 : 0;

			twiddle_maxs[1][0] = path_quantised[j].v[0] < 255 ? path_quantised[j].v[0] + 1 : 0;
			twiddle_maxs[1][1] = path_quantised[j].v[1] < 255 ? path_quantised[j].v[1] + 1 : 0;
			twiddle_maxs[1][2] = path_quantised[j].v[2] < 255 ? path_quantised[j].v[2] + 1 : 0;
#else
			twiddle_mins[0][0] = path_quantised[i].v[0];
			twiddle_mins[0][1] = path_quantised[i].v[1];
			twiddle_mins[0][2] = path_quantised[i].v[2];

			twiddle_mins[1][0] = path_quantised[j].v[0];
			twiddle_mins[1][1] = path_quantised[j].v[1];
			twiddle_mins[1][2] = path_quantised[j].v[2];

			twiddle_maxs[0][0] = path_quantised[i].v[0];
			twiddle_maxs[0][1] = path_quantised[i].v[1];
			twiddle_maxs[0][2] = path_quantised[i].v[2];

			twiddle_maxs[1][0] = path_quantised[j].v[0];
			twiddle_maxs[1][1] = path_quantised[j].v[1];
			twiddle_maxs[1][2] = path_quantised[j].v[2];
#endif
			for (source[0] = twiddle_mins[0][0]; source[0] <= twiddle_maxs[0][0]; source[0]++)
				for (source[1] = twiddle_mins[0][1]; source[1] <= twiddle_maxs[0][1]; source[1]++)
					for (source[2] = twiddle_mins[0][2]; source[2] <= twiddle_maxs[0][2]; source[2]++)
						for (target[0] = twiddle_mins[1][0]; target[0] <= twiddle_maxs[1][0]; target[0]++)
							for (target[1] = twiddle_mins[1][1]; target[1] <= twiddle_maxs[1][1]; target[1]++)
								for (target[2] = twiddle_mins[1][2]; target[2] <= twiddle_maxs[1][2]; target[2]++)
								{
									uint8_t target_local[3];

									diff[0] = target[0] - source[0];
									diff[1] = target[1] - source[1];
									diff[2] = target[2] - source[2];

									target_local[0] = (uint8_t)target[0];
									target_local[1] = (uint8_t)target[1];
									target_local[2] = (uint8_t)target[2];

									// TODO: clamp to the max in the direction of the point instead of just exiting if it's outside the range
									//       can use Bresenham's algorithm to just walk to the correct point within 5 steps

									if ((diff[0]*diff[0] > 25) || (diff[1]*diff[1] > 25) || (diff[2]*diff[2] > 25))
									{
										vec3u8_t closest = DDS_BresenhamPath16BitVisitLastSphere(Vec3u8_Vec((uint8_t)source[0], (uint8_t)source[1], (uint8_t)source[2]), Vec3u8_Vec((uint8_t)target[0], (uint8_t)target[1], (uint8_t)target[2]), g_dds_half_sphere_reverse_map);

										diff[0] = closest.v[0] - source[0];
										diff[1] = closest.v[1] - source[1];
										diff[2] = closest.v[2] - source[2];

										target_local[0] = closest.v[0];
										target_local[1] = closest.v[1];
										target_local[2] = closest.v[2];
									}

									sphere_i = g_dds_half_sphere_reverse_map[(diff[0] + 5)*11*11 + (diff[1] + 5)*11 + diff[2] + 5][0];

									if (sphere_i == -1)
										continue;

									if (g_dds_half_sphere_reverse_map[(diff[0] + 5)*11*11 + (diff[1] + 5)*11 + diff[2] + 5][1] == 0)
									{
										colour[0] = Vec3f32_Vec((float)source[0], (float)source[1], (float)source[2]);
										colour[1] = Vec3f32_Vec(target_local[0], target_local[1], target_local[2]);
									}
									else
									{
										colour[0] = Vec3f32_Vec(target_local[0], target_local[1], target_local[2]);
										colour[1] = Vec3f32_Vec((float)source[0], (float)source[1], (float)source[2]);
									}

									float err = DDS_BC1FindBestIndexesSphere(original, colour, index16);

									//if (DDS_DEBUG_BLOCK)
									//printf("block %5i %5i, sphere err: %f\n", block_x, block_y, err);

									if (err < best_err)
									{
										is_best = 1;
										best_colour_rgb24[0] = (int)colour[0].v[0];
										best_colour_rgb24[1] = (int)colour[0].v[1];
										best_colour_rgb24[2] = (int)colour[0].v[2];
										best_sphere_index = sphere_i;
										best_err = err;
										//printf("block %5i %5i, err: %f\n", block_x, block_y, err);
									}

								}

		}

	if (is_best)
	{
		colour[0].v[0] = (float)best_colour_rgb24[0];
		colour[0].v[1] = (float)best_colour_rgb24[1];
		colour[0].v[2] = (float)best_colour_rgb24[2];

		colour[1].v[0] = (float)Math_Clampi32(best_colour_rgb24[0] + g_dds_half_sphere_map[best_sphere_index][0], 0, 255);
		colour[1].v[1] = (float)Math_Clampi32(best_colour_rgb24[1] + g_dds_half_sphere_map[best_sphere_index][1], 0, 255);
		colour[1].v[2] = (float)Math_Clampi32(best_colour_rgb24[2] + g_dds_half_sphere_map[best_sphere_index][2], 0, 255);

		//DDS_BC1FindBestIndexesSphere(original, colour, index16);
		float err = DDS_BC1FindBestIndexesSphere(original, colour, index16);
		if (DDS_DEBUG_BLOCK)
		{
			printf("block %5i %5i, best err: %f (MSE %f), sphere index %3i\n", block_x, block_y, err, err/16.0f, best_sphere_index);

			printf("%3f %3f %3f\n", colour[0].v[0], colour[0].v[1], colour[0].v[2]);
			printf("%3f %3f %3f\n", colour[1].v[0], colour[1].v[1], colour[1].v[2]);
			printf("%3i %3i %3i\n", g_dds_half_sphere_map[best_sphere_index][0], g_dds_half_sphere_map[best_sphere_index][1], g_dds_half_sphere_map[best_sphere_index][2]);

			for (i = 0; i < 4; i++)
			{
				printf("%3u %3u %3u, ", (uint8_t)colour[index16[i*4 + 0]].v[0], (uint8_t)colour[index16[i*4 + 0]].v[1], (uint8_t)colour[index16[i*4 + 0]].v[2]);
				printf("%3u %3u %3u, ", (uint8_t)colour[index16[i*4 + 1]].v[0], (uint8_t)colour[index16[i*4 + 1]].v[1], (uint8_t)colour[index16[i*4 + 1]].v[2]);
				printf("%3u %3u %3u, ", (uint8_t)colour[index16[i*4 + 2]].v[0], (uint8_t)colour[index16[i*4 + 2]].v[1], (uint8_t)colour[index16[i*4 + 2]].v[2]);
				printf("%3u %3u %3u, %i %i %i %i\n", (uint8_t)colour[index16[i*4 + 3]].v[0], (uint8_t)colour[index16[i*4 + 3]].v[1], (uint8_t)colour[index16[i*4 + 3]].v[2], index16[i*4 + 0], index16[i*4 + 1], index16[i*4 + 2], index16[i*4 + 3]);
			}
		}

		*((uint16_t*)&block[0]) = (uint16_t)(((best_colour_rgb24[0] >> 3) << 11) | ((best_colour_rgb24[1] >> 2) << 5) | ((best_colour_rgb24[2] >> 3)));
		*((uint16_t*)&block[2]) = (uint16_t)(((best_colour_rgb24[0] >> 3) << 11) | ((best_colour_rgb24[1] >> 2) << 5) | ((best_colour_rgb24[2] >> 3)));
		block[4] = ((best_colour_rgb24[0] & 0x07) << 5) | ((best_colour_rgb24[1] & 0x03) << 3) | ((best_colour_rgb24[2] & 0x07));

		block[5] = (uint8_t)best_sphere_index;
		if (DDS_DEBUG_BLOCK)
			printf("block %5i %5i, index %3i (0x%02X)\n", block_x, block_y, block[5], block[5]);
		block[6] = (uint8_t)((index16[0] << 7) | (index16[1] << 6) | (index16[2] << 5) | (index16[3] << 4) | (index16[4] << 3) | (index16[5] << 2) | (index16[6] << 1) | (index16[7] << 0));
		block[7] = (uint8_t)((index16[8] << 7) | (index16[9] << 6) | (index16[10] << 5) | (index16[11] << 4) | (index16[12] << 3) | (index16[13] << 2) | (index16[14] << 1) | (index16[15] << 0));

		if (DDS_DEBUG_BLOCK)
			printf("block: 0x%016"PRIX64"\n", *(uint64_t*)block);

		errsum += old_best_err - best_err;
		if (old_best_err - best_err > g_best_err_diff)
		{
			g_best_err_diff = old_best_err - best_err;
			printf("block %5i %5i best err diff = %f\n", block_x, block_y, old_best_err - best_err);
		}
		//printf("%f vs %f (%f)\n", best_err, old_best_err, old_best_err - best_err);
	}

#else	// MSE: 5.357340 (vs 5.357476, 0.000136 reduction, or 0.0025%) on 256x144halfblurredgradient_constantgreen.bmp
	int k;
	int sphere_i;
	int mins[3];
	int maxs[3];
	int best_sphere_index = 0;
	int is_best = 0;
	int index16[16];
	int best_colour_rgb24[3];
	float old_best_err = best_err;

	mins[0] = Math_Clampi32(floorf(mean[0] + 0.5f) - 10, 0, 255);
	mins[1] = Math_Clampi32(floorf(mean[1] + 0.5f) - 10, 0, 255);
	mins[2] = Math_Clampi32(floorf(mean[2] + 0.5f) - 10, 0, 255);

	maxs[0] = Math_Clampi32(floorf(mean[0] + 0.5f) + 10, 0, 255);
	maxs[1] = Math_Clampi32(floorf(mean[1] + 0.5f) + 10, 0, 255);
	maxs[2] = Math_Clampi32(floorf(mean[2] + 0.5f) + 10, 0, 255);

	for (i = mins[0]; i <= maxs[0]; i++)
		for (j = mins[1]; j <= maxs[1]; j++)
			for (k = mins[2]; k <= maxs[2]; k++)
				for (sphere_i = 0; sphere_i < DDS_HALF_SPHERE_MAP_NUM_INDEXES; sphere_i++)
				{
					colour[0].v[0] = i;
					colour[0].v[1] = j;
					colour[0].v[2] = k;

					colour[1].v[0] = Math_Clampi32(i + g_dds_half_sphere_map[sphere_i][0], 0, 255);
					colour[1].v[1] = Math_Clampi32(j + g_dds_half_sphere_map[sphere_i][1], 0, 255);
					colour[1].v[2] = Math_Clampi32(k + g_dds_half_sphere_map[sphere_i][2], 0, 255);

					float err = DDS_BC1FindBestIndexesSphere(original, colour, index16);

					if (err < best_err)
					{
						is_best = 1;
						best_colour_rgb24[0] = i;
						best_colour_rgb24[1] = j;
						best_colour_rgb24[2] = k;
						best_sphere_index = sphere_i;
						best_err = err;
						//printf("block %5i %5i, err: %f\n", block_x, block_y, err);
					}
				}
	if (is_best)
	{
		colour[0].v[0] = best_colour_rgb24[0];
		colour[0].v[1] = best_colour_rgb24[1];
		colour[0].v[2] = best_colour_rgb24[2];

		colour[1].v[0] = Math_Clampi32(best_colour_rgb24[0] + g_dds_half_sphere_map[best_sphere_index][0], 0, 255);
		colour[1].v[1] = Math_Clampi32(best_colour_rgb24[1] + g_dds_half_sphere_map[best_sphere_index][1], 0, 255);
		colour[1].v[2] = Math_Clampi32(best_colour_rgb24[2] + g_dds_half_sphere_map[best_sphere_index][2], 0, 255);

		//DDS_BC1FindBestIndexesSphere(original, colour, index16);
		float err = DDS_BC1FindBestIndexesSphere(original, colour, index16);
		if (DDS_DEBUG_BLOCK)
		{
			printf("block %5i %5i, best err: %f, sphere index %3i\n", block_x, block_y, err, best_sphere_index);

			printf("%3f %3f %3f\n", colour[0].v[0], colour[0].v[1], colour[0].v[2]);
			printf("%3f %3f %3f\n", colour[1].v[0], colour[1].v[1], colour[1].v[2]);
			printf("%3i %3i %3i\n", g_dds_half_sphere_map[best_sphere_index][0], g_dds_half_sphere_map[best_sphere_index][1], g_dds_half_sphere_map[best_sphere_index][2]);

			for (i = 0; i < 4; i++)
			{
				printf("%3u %3u %3u, ", (uint8_t)colour[index16[i*4 + 0]].v[0], (uint8_t)colour[index16[i*4 + 0]].v[1], (uint8_t)colour[index16[i*4 + 0]].v[2]);
				printf("%3u %3u %3u, ", (uint8_t)colour[index16[i*4 + 1]].v[0], (uint8_t)colour[index16[i*4 + 1]].v[1], (uint8_t)colour[index16[i*4 + 1]].v[2]);
				printf("%3u %3u %3u, ", (uint8_t)colour[index16[i*4 + 2]].v[0], (uint8_t)colour[index16[i*4 + 2]].v[1], (uint8_t)colour[index16[i*4 + 2]].v[2]);
				printf("%3u %3u %3u\n", (uint8_t)colour[index16[i*4 + 3]].v[0], (uint8_t)colour[index16[i*4 + 3]].v[1], (uint8_t)colour[index16[i*4 + 3]].v[2]);
			}
		}

		*((uint16_t*)&block[0]) = ((best_colour_rgb24[0] >> 3) << 11) | ((best_colour_rgb24[1] >> 2) << 5) | ((best_colour_rgb24[2] >> 3));
		*((uint16_t*)&block[2]) = ((best_colour_rgb24[0] >> 3) << 11) | ((best_colour_rgb24[1] >> 2) << 5) | ((best_colour_rgb24[2] >> 3));
		block[4] = ((best_colour_rgb24[0] & 0x07) << 5) | ((best_colour_rgb24[1] & 0x03) << 3) | ((best_colour_rgb24[2] & 0x07));

		block[5] = best_sphere_index;
		if (DDS_DEBUG_BLOCK)
			printf("block %5i %5i, index %3i (0x%02X)\n", block_x, block_y, block[5], block[5]);
		block[6] = (index16[0] << 7) | (index16[1] << 6) | (index16[2] << 5) | (index16[3] << 4) | (index16[4] << 3) | (index16[5] << 2) | (index16[6] << 1) | (index16[7] << 0);
		block[7] = (index16[8] << 7) | (index16[9] << 6) | (index16[10] << 5) | (index16[11] << 4) | (index16[12] << 3) | (index16[13] << 2) | (index16[14] << 1) | (index16[15] << 0);

		if (DDS_DEBUG_BLOCK)
			printf("block: 0x%016"PRIX64"\n", *(uint64_t*)block);

		errsum += old_best_err - best_err;
		//printf("%f vs %f (%f)\n", best_err, old_best_err, old_best_err - best_err);
	}
#endif
}

void DDS_EncodeBC1BlockNormalf32(uint8_t *block, float *pixel4x4_rgba, int is_premultiplied, int is_srgb, int is_signed, int block_x, int block_y, uint8_t alpha_cutoff, int is_bc23)
{
	float mean[3];
	vec3f32_t transformed[4][4];
	vec3f32_t original[4][4];
	mat3x3f32_t cvmat;
	vec3f32_t eigen;
	float mins;
	float maxs;
	int i, j;
	vec3f32_t colour[4];
	uint16_t packed_colour[2];
	vec3f32_t meanf;
	int index[4][4];
	int has_alpha = 0;
	vec3f32_t best_colour_base[2];
	float best_err;
	int best_force_alpha = 0;
	vec3u8_t best_endpoints_quantised[2];
	int local_best_alpha = 0;
	vec3u8_t local_endpoints_quantised[2];
	float err;

	cvmat = DDS_BlockCovariance3Df32(pixel4x4_rgba, mean, (float)alpha_cutoff);
	eigen = DDS_BlockPrincipalEigenVector3Df32(cvmat);

	for (i = 0; i < 16; i++)
	{
		if (pixel4x4_rgba[i*4 + 3] < alpha_cutoff)
		{
			has_alpha = 1;
			break;
		}
	}

	for (i = 0; i < 4; i++)
		for (j = 0; j < 4; j++)
			original[i][j] = Vec3f32_Vec(pixel4x4_rgba[(i*4 + j)*4 + 0], pixel4x4_rgba[(i*4 + j)*4 + 1], pixel4x4_rgba[(i*4 + j)*4 + 2]);

	for (i = 0; i < 4; i++)
		for (j = 0; j < 4; j++)
			transformed[i][j] = Vec3f32_Sub(original[i][j], Vec3f32_Vec(mean[0], mean[1], mean[2]));

	mins = Vec3f32_Dot(eigen, transformed[0][0]);
	maxs = Vec3f32_Dot(eigen, transformed[0][0]);

	meanf = Vec3f32_Vec(mean[0], mean[1], mean[2]);

	for (i = 0; i < 4; i++)
		for (j = 0; j < 4; j++)
		{
			if (pixel4x4_rgba[(i*4 + j)*4 + 3] < alpha_cutoff)
				continue;
			if (Vec3f32_Dot(eigen, transformed[i][j]) < mins)
				mins = Vec3f32_Dot(eigen, transformed[i][j]);
			if (Vec3f32_Dot(eigen, transformed[i][j]) > maxs)
				maxs = Vec3f32_Dot(eigen, transformed[i][j]);
		}

	colour[0] = Vec3f32_ClampS(Vec3f32_Add(Vec3f32_Scale(eigen, mins), meanf), 0.0, 255.0);
	colour[1] = Vec3f32_ClampS(Vec3f32_Add(Vec3f32_Scale(eigen, maxs), meanf), 0.0, 255.0);

	DDS_RoundEndpointsToRGB565(colour);

	best_colour_base[0] = colour[0];
	best_colour_base[1] = colour[1];

	best_endpoints_quantised[0] = Vec3f32_ToVec3u8(colour[0]);
	best_endpoints_quantised[1] = Vec3f32_ToVec3u8(colour[1]);

	best_err = DDS_BC1FindBestIndexesLimited(pixel4x4_rgba, original, alpha_cutoff, has_alpha, eigen, DDS_MAX_INIT_ERROR, 0.0f, 0.0f, 0, 0, 0, 0, best_endpoints_quantised[0], best_endpoints_quantised[1], &best_colour_base[0], &best_colour_base[1], &best_force_alpha, block_x, block_y, is_bc23);

	if (DDS_GROUND_TRUTH)
	{
		local_best_alpha = 0;
		err = DDS_ComputeGlobalMinimum(g_system.opts.dds_quality, alpha_cutoff, is_bc23, has_alpha, pixel4x4_rgba, original, meanf, best_err, colour, &local_best_alpha, block_x, block_y);

		if (err < best_err)
		{
			local_endpoints_quantised[0].v[0] = (uint8_t)(((int)best_colour_base[0].v[0]) >> 3);
			local_endpoints_quantised[0].v[1] = (uint8_t)(((int)best_colour_base[0].v[1]) >> 2);
			local_endpoints_quantised[0].v[2] = (uint8_t)(((int)best_colour_base[0].v[2]) >> 3);
			local_endpoints_quantised[1].v[0] = (uint8_t)(((int)best_colour_base[1].v[0]) >> 3);
			local_endpoints_quantised[1].v[1] = (uint8_t)(((int)best_colour_base[1].v[1]) >> 2);
			local_endpoints_quantised[1].v[2] = (uint8_t)(((int)best_colour_base[1].v[2]) >> 3);

			DDS_UpdateParameters(pixel4x4_rgba, original, alpha_cutoff,is_bc23,has_alpha,"GroundTruth",&best_err, &best_force_alpha, best_colour_base, best_endpoints_quantised, err,colour, local_endpoints_quantised, local_best_alpha,block_x,block_y);
		}
	}

	// TODO: do this at the end as it's the most expensive step, but will be speeded up by having as good an initial "best err" as possible on entry
	if (g_system.opts.dds_quality & DDS_ENCODE_WALK_PATH)
	{
		local_best_alpha = 0;

		err = DDS_WalkPath(g_system.opts.dds_quality, alpha_cutoff, is_bc23, has_alpha, pixel4x4_rgba, original, best_err, eigen, mins, maxs, meanf, colour, local_endpoints_quantised, &local_best_alpha, index, block_x, block_y);

		DDS_UpdateParameters(pixel4x4_rgba, original, alpha_cutoff,is_bc23,has_alpha,"WalkPath",&best_err, &best_force_alpha, best_colour_base, best_endpoints_quantised, err,colour, local_endpoints_quantised, local_best_alpha,block_x,block_y);
		if (DEBUG_BLOCK)
		{
			vec3f32_t p[2];
			p[0] = DDS_UnpackVec3u8QuantisedToVec3f32(local_endpoints_quantised[0]);
			p[1] = DDS_UnpackVec3u8QuantisedToVec3f32(local_endpoints_quantised[1]);
			printf("%3f %3f %3f, %3f %3f %3f\n", p[0].v[0], p[0].v[1], p[0].v[2], p[1].v[0], p[1].v[1], p[1].v[2]);
			printf("%3f %3f %3f, %3f %3f %3f\n", colour[0].v[0], colour[0].v[1], colour[0].v[2], colour[1].v[0], colour[1].v[1], colour[1].v[2]);
			printf("err: %f\n", err);
		}
	}
	if (g_system.opts.dds_quality & DDS_ENCODE_REFINE_ENDPOINTS)
	{
		for (i = 0; i < 2; i++)
		{
			local_best_alpha = 0;

			local_endpoints_quantised[0] = best_endpoints_quantised[0];
			local_endpoints_quantised[1] = best_endpoints_quantised[1];

			err = DDS_RefineEndpoints(g_system.opts.dds_quality, 0, alpha_cutoff, is_bc23, has_alpha, pixel4x4_rgba, original, best_err, eigen, colour, local_endpoints_quantised, &local_best_alpha, index, block_x, block_y);

			if (err < best_err)
			{
				if (DEBUG_BLOCK)
					printf("Updated parameters for err %f\n", err);
				DDS_UpdateParameters(pixel4x4_rgba, original, alpha_cutoff,is_bc23,has_alpha,"RefineEndpoints",&best_err, &best_force_alpha, best_colour_base, best_endpoints_quantised, err,colour, local_endpoints_quantised, local_best_alpha,block_x,block_y);
			}
			else
				break;
		}
	}

	err = DDS_BestFitAxes(alpha_cutoff, is_bc23, has_alpha, pixel4x4_rgba, original, meanf, best_err, colour, &local_best_alpha, local_endpoints_quantised, block_x, block_y);

	DDS_UpdateParameters(pixel4x4_rgba, original, alpha_cutoff,is_bc23,has_alpha,"AxesFit",&best_err, &best_force_alpha, best_colour_base, best_endpoints_quantised, err,colour, local_endpoints_quantised, local_best_alpha,block_x,block_y);

	if (g_system.opts.dds_quality & DDS_ENCODE_REFINE_ENDPOINTS)
	{
		for (i = 0; i < 2; i++)
		{
			local_best_alpha = 0;

			local_endpoints_quantised[0] = best_endpoints_quantised[0];
			local_endpoints_quantised[1] = best_endpoints_quantised[1];

			err = DDS_RefineEndpoints(g_system.opts.dds_quality, 0, alpha_cutoff, is_bc23, has_alpha, pixel4x4_rgba, original, best_err, eigen, colour, local_endpoints_quantised, &local_best_alpha, index, block_x, block_y);

			if (err < best_err)
			{
				if (DEBUG_BLOCK)
					printf("Updated parameters for err %f\n", err);
				DDS_UpdateParameters(pixel4x4_rgba, original, alpha_cutoff, is_bc23, has_alpha, "RefineEndpoints", &best_err, &best_force_alpha, best_colour_base, best_endpoints_quantised, err,colour, local_endpoints_quantised, local_best_alpha, block_x, block_y);
			}
			else
				break;
		}
	}

	err = DDS_BestSolidColour(alpha_cutoff, is_bc23, has_alpha, pixel4x4_rgba, original, meanf, best_err, colour, &local_best_alpha, index, block_x, block_y);

	DDS_UpdateParameters(pixel4x4_rgba, original, alpha_cutoff,is_bc23,has_alpha,"SolidColour",&best_err, &best_force_alpha, best_colour_base, 0, err,colour, 0, local_best_alpha,block_x,block_y);
ENCODE:
	colour[0] = best_colour_base[0];
	colour[1] = best_colour_base[1];

	DDS_BC1GeneratePalette(colour, has_alpha, packed_colour, best_force_alpha, is_bc23);

	DDS_BC1FindBestIndexes(pixel4x4_rgba, original, has_alpha, alpha_cutoff, colour, index);

	*((uint16_t*)&block[0]) = packed_colour[0];
	*((uint16_t*)&block[2]) = packed_colour[1];

	block[4] = (uint8_t)((index[0][0] << 0) | (index[0][1] << 2) | (index[0][2] << 4) | (index[0][3] << 6));
	block[5] = (uint8_t)((index[1][0] << 0) | (index[1][1] << 2) | (index[1][2] << 4) | (index[1][3] << 6));
	block[6] = (uint8_t)((index[2][0] << 0) | (index[2][1] << 2) | (index[2][2] << 4) | (index[2][3] << 6));
	block[7] = (uint8_t)((index[3][0] << 0) | (index[3][1] << 2) | (index[3][2] << 4) | (index[3][3] << 6));

#ifdef NEW_EXTENDED_BC1
	DDS_ComputeSphereMapping(block, original, best_err, eigen, mins, maxs, meanf, block_x, block_y);
#endif
}

void DDS_EncodeBC1Block(uint8_t *block, double *pixel4x4_rgba, int is_premultiplied, int is_srgb, int is_signed, int block_x, int block_y, uint8_t alpha_cutoff, int is_bc23)
{
	float pixel[64] = {225, 0, 172, 255, 225, 0, 172, 255, 225, 0, 172, 255, 223, 0, 169, 255, 225, 0, 172, 255, 225, 0, 172, 255, 225, 0, 172, 255, 223, 0, 169, 255, 225, 0, 172, 255, 225, 0, 172, 255, 223, 0, 169, 255, 223, 0, 169, 255, 224, 0, 172, 255, 223, 0, 172, 255, 223, 0, 169, 255, 223, 0, 169, 255};
	int i;

	for (i = 0; i < 64; i++)
		pixel[i] = (float)pixel4x4_rgba[i];

	for (i = 0; i < 64; i+=4)
	{
		//		pixel[i + 0] += 2;
		//	pixel[i + 1] = (float)65;
	}
	/*
	for (i = 0; i < 16; i++)
	{
	pixel[i*4 + 0] = (i * 15) | ((i * 15) >> 4);
	pixel[i*4 + 1] = (i * 15) | ((i * 15) >> 4);
	pixel[i*4 + 2] = (i * 15) | ((i * 15) >> 4);
	pixel[i*4 + 3] = 255;
	}
	*/	
	/*
	for (i = 0; i < 16; i++)
	{
	pixel[i*4 + 0] = rand()%256;
	pixel[i*4 + 1] = rand()%256;
	pixel[i*4 + 2] = rand()%256;
	pixel[i*4 + 3] = 255;
	}
	*/
	DDS_EncodeBC1BlockNormalf32(block, pixel, is_premultiplied, is_srgb, is_signed, block_x, block_y, alpha_cutoff, is_bc23);


}

void DDS_DecodeBC1Block(uint8_t *block, float *pixel4x4_rgba, int is_premultiplied, int is_srgb, int is_signed, int block_x, int block_y)
{
	uint8_t colour[4][4];
	int i, j;

	colour[0][0] = (uint8_t)((*((uint16_t*)&block[0]) & 0xF800) >> 8);
	colour[0][1] = (uint8_t)((*((uint16_t*)&block[0]) & 0x07E0) >> 3);
	colour[0][2] = (uint8_t)((*((uint16_t*)&block[0]) & 0x001F) << 3);
	colour[0][3] = 255;

	colour[1][0] = (uint8_t)((*((uint16_t*)&block[2]) & 0xF800) >> 8);
	colour[1][1] = (uint8_t)((*((uint16_t*)&block[2]) & 0x07E0) >> 3);
	colour[1][2] = (uint8_t)((*((uint16_t*)&block[2]) & 0x001F) << 3);
	colour[1][3] = 255;

	colour[0][0] |= colour[0][0] >> 5;
	colour[0][1] |= colour[0][1] >> 6;
	colour[0][2] |= colour[0][2] >> 5;

	colour[1][0] |= colour[1][0] >> 5;
	colour[1][1] |= colour[1][1] >> 6;
	colour[1][2] |= colour[1][2] >> 5;

	if (*((uint16_t*)&block[0]) > *((uint16_t*)&block[2]))
	{
		// according to bcdec, r = (2 * r0 + r1 + 1) / 3;
		colour[2][0] = (uint8_t)((colour[0][0] * (2.0/3.0) + colour[1][0] * (1.0 / 3.0)) + 0.5);
		colour[2][1] = (uint8_t)((colour[0][1] * (2.0/3.0) + colour[1][1] * (1.0 / 3.0)) + 0.5);
		colour[2][2] = (uint8_t)((colour[0][2] * (2.0/3.0) + colour[1][2] * (1.0 / 3.0)) + 0.5);
		colour[2][3] = 255;

		// according to bcdec, r = (r0 + 2 * r1 + 1) / 3;
		colour[3][0] = (uint8_t)((colour[0][0] * (1.0/3.0) + colour[1][0] * (2.0 / 3.0)) + 0.5);
		colour[3][1] = (uint8_t)((colour[0][1] * (1.0/3.0) + colour[1][1] * (2.0 / 3.0)) + 0.5);
		colour[3][2] = (uint8_t)((colour[0][2] * (1.0/3.0) + colour[1][2] * (2.0 / 3.0)) + 0.5);
		colour[3][3] = 255;
	}
	else
	{
		colour[2][0] = (uint8_t)((colour[0][0] * (1.0/2.0) + colour[1][0] * (1.0 / 2.0)) + 0.5);
		colour[2][1] = (uint8_t)((colour[0][1] * (1.0/2.0) + colour[1][1] * (1.0 / 2.0)) + 0.5);
		colour[2][2] = (uint8_t)((colour[0][2] * (1.0/2.0) + colour[1][2] * (1.0 / 2.0)) + 0.5);
		colour[2][3] = 255;

		colour[3][0] = 0;
		colour[3][1] = 0;
		colour[3][2] = 0;
		colour[3][3] = 0;
	}

	for (i = 0; i < 4; i++)
	{
		for (j = 0; j < 4; j++)
		{
			int index = (block[4 + i] >> (j * 2)) & 0x03;

			pixel4x4_rgba[i * 16 + j * 4 + 0] = (float)colour[index][0];
			pixel4x4_rgba[i * 16 + j * 4 + 1] = (float)colour[index][1];
			pixel4x4_rgba[i * 16 + j * 4 + 2] = (float)colour[index][2];
			pixel4x4_rgba[i * 16 + j * 4 + 3] = (float)colour[index][3];
		}
	}

	if (DDS_DEBUG_BLOCK)
	{
		printf("c[0] = %3u, %3u, %3u\n", colour[0][0], colour[0][1], colour[0][2]);
		printf("c[1] = %3u, %3u, %3u\n", colour[1][0], colour[1][1], colour[1][2]);
		printf("c[2] = %3u, %3u, %3u\n", colour[2][0], colour[2][1], colour[2][2]);
		printf("c[3] = %3u, %3u, %3u\n", colour[3][0], colour[3][1], colour[3][2]);
		for (i = 0; i < 4; i++)
		{
			printf("%3.0f %3.0f %3.0f, %3.0f %3.0f %3.0f, %3.0f %3.0f %3.0f, %3.0f %3.0f %3.0f\n"
				, pixel4x4_rgba[i * 16 + 0], pixel4x4_rgba[i * 16 + 1], pixel4x4_rgba[i * 16 + 2]
				, pixel4x4_rgba[i * 16 + 4], pixel4x4_rgba[i * 16 + 5], pixel4x4_rgba[i * 16 + 6]
				, pixel4x4_rgba[i * 16 + 8], pixel4x4_rgba[i * 16 + 9], pixel4x4_rgba[i * 16 + 10]
				, pixel4x4_rgba[i * 16 + 12], pixel4x4_rgba[i * 16 + 13], pixel4x4_rgba[i * 16 + 14]);
		}
	}

#ifdef NEW_EXTENDED_BC1
	{
		if (*(uint16_t*)&block[0] == *(uint16_t*)&block[2])
		{
			int sphere_index;
			int index16[16];

			if (DDS_DEBUG_BLOCK)
				printf("block: 0x%016"PRIX64"\n", *(uint64_t*)block);

			colour[0][0] = ((((*(uint16_t*)&block[0]) >> 11) & 0x1F) << 3) | ((block[4] >> 5) & 0x07);
			colour[0][1] = ((((*(uint16_t*)&block[0]) >> 5) & 0x3F) << 2) | ((block[4] >> 3) & 0x03);
			colour[0][2] = ((((*(uint16_t*)&block[0]) >> 0) & 0x1F) << 3) | ((block[4] >> 0) & 0x07);

			sphere_index = block[5];

			colour[1][0] = (uint8_t)Math_Clampi32((int)colour[0][0] + g_dds_half_sphere_map[sphere_index][0], 0, 255);
			colour[1][1] = (uint8_t)Math_Clampi32((int)colour[0][1] + g_dds_half_sphere_map[sphere_index][1], 0, 255);
			colour[1][2] = (uint8_t)Math_Clampi32((int)colour[0][2] + g_dds_half_sphere_map[sphere_index][2], 0, 255);

			index16[0] = (block[6] >> 7) & 1;
			index16[1] = (block[6] >> 6) & 1;
			index16[2] = (block[6] >> 5) & 1;
			index16[3] = (block[6] >> 4) & 1;
			index16[4] = (block[6] >> 3) & 1;
			index16[5] = (block[6] >> 2) & 1;
			index16[6] = (block[6] >> 1) & 1;
			index16[7] = (block[6] >> 0) & 1;
			index16[8] = (block[7] >> 7) & 1;
			index16[9] = (block[7] >> 6) & 1;
			index16[10] = (block[7] >> 5) & 1;
			index16[11] = (block[7] >> 4) & 1;
			index16[12] = (block[7] >> 3) & 1;
			index16[13] = (block[7] >> 2) & 1;
			index16[14] = (block[7] >> 1) & 1;
			index16[15] = (block[7] >> 0) & 1;

			for (i = 0; i < 16; i++)
			{
				pixel4x4_rgba[i*4 + 0] = colour[index16[i]][0];
				pixel4x4_rgba[i*4 + 1] = colour[index16[i]][1];
				pixel4x4_rgba[i*4 + 2] = colour[index16[i]][2];
				pixel4x4_rgba[i*4 + 3] = 255;
			}

			if(DDS_DEBUG_BLOCK)
			{
				printf("index: %3i (0x%02X)\n", sphere_index, block[5]);
				printf("c[0] = %3u, %3u, %3u\n", colour[0][0], colour[0][1], colour[0][2]);
				printf("c[1] = %3u, %3u, %3u\n", colour[1][0], colour[1][1], colour[1][2]);
				printf("sphe = %3i, %3i, %3i\n", g_dds_half_sphere_map[sphere_index][0], g_dds_half_sphere_map[sphere_index][1], g_dds_half_sphere_map[sphere_index][2]);
				if (DDS_DEBUG_BLOCK)
					printf("block: 0x%016"PRIX64"\n", *(uint64_t*)block);
				for (i = 0; i < 4; i++)
				{
					printf("row %i %3.0f %3.0f %3.0f, %3.0f %3.0f %3.0f, %3.0f %3.0f %3.0f, %3.0f %3.0f %3.0f\n", i
						, pixel4x4_rgba[i * 16 + 0], pixel4x4_rgba[i * 16 + 1], pixel4x4_rgba[i * 16 + 2]
						, pixel4x4_rgba[i * 16 + 4], pixel4x4_rgba[i * 16 + 5], pixel4x4_rgba[i * 16 + 6]
						, pixel4x4_rgba[i * 16 + 8], pixel4x4_rgba[i * 16 + 9], pixel4x4_rgba[i * 16 + 10]
						, pixel4x4_rgba[i * 16 + 12], pixel4x4_rgba[i * 16 + 13], pixel4x4_rgba[i * 16 + 14]);
				}
				printf("block4: 0x%02X\n", block[4]);
			}

		}
	}
#endif
}
